/*!CK:1149762897!*//*1446436750,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["pPvW1"]); }

__d('AjaxRequest',['ErrorUtils','Keys','PHPQuerySerializer','TimeSlice','URI','UserAgent_DEPRECATED','getSameOriginTransport','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(t,u,v){this.xhr=n();if(!(u instanceof l))u=new l(u);if(v&&t=='GET'){u.setQueryData(v);}else this._params=v;this.method=t;this.uri=u;this.xhr.open(t,u);}var q=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();p.supportsCORS=function(){return q;};p.ERROR='ar:error';p.TIMEOUT='ar:timeout';p.PROXY_ERROR='ar:proxy error';p.TRANSPORT_ERROR='ar:transport error';p.SERVER_ERROR='ar:http error';p.PARSE_ERROR='ar:parse error';p.SERVICE_UNAVAILABLE='ar:noservice';p._inflight=[];function r(){var t=p._inflight;p._inflight=[];t.forEach(function(u){u.abort();});}function s(t){t.onJSON=t.onError=t.onSuccess=null;clearTimeout(t._timer);if(t.xhr&&t.xhr.readyState<4){t.xhr.abort();t.xhr=null;}p._inflight=p._inflight.filter(function(u){return u&&u!=t&&u.xhr&&u.xhr.readyState<4;});}Object.assign(p.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(t){if(this[t])this[t](this);},_parseStatus:function(){var t;try{this.status=this.xhr.status;t=this.xhr.statusText;}catch(u){if(this.xhr.readyState>=4){this.errorType=p.TRANSPORT_ERROR;this.errorText=u.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=p.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=p.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=p.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=p.SERVER_ERROR;}else if(this.status===503){this.errorType=p.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=p.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=p.TRANSPORT_ERROR;}else{t='unrecognized status code: '+this.status;this.errorType=p.ERROR;}if(!this.errorText)this.errorText=t;},_parseResponse:function(){var t,u=this.xhr.readyState;try{t=this.xhr.responseText||'';}catch(v){if(u>=4){this.errorType=p.ERROR;this.errorText='responseText not available - '+v.message;}return;}while(this.xhr){var w=this._eol+1,x=this.streamMode?t.indexOf('\n',w):t.length;if(x<0&&u==4)x=t.length;if(x<=this._eol)break;var y=t;if(this.streamMode)y=t.substr(w,x-w).replace(/^\s*|\s*$/g,'');if(w===0&&this.prelude)if(this.prelude.test(y))y=y.replace(this.prelude,'');this._eol=x;if(y){try{this.json=JSON.parse(y);}catch(v){var z=/(<body[\S\s]+?<\/body>)/i.test(t)&&RegExp.$1,aa={message:v.message,'char':w,excerpt:(w===0&&z||y).substr(512)};this.errorType=p.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(aa);return;}h.applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var t=this.xhr&&this.xhr.readyState||0;if(this.status==null&&t>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(t==3&&this.streamMode||t==4)this._parseResponse();if(this.errorType||t==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');s(this);}},send:function(t){this.xhr.onreadystatechange=k.guard(this._onReadyState.bind(this),'AjaxRequest xhr.onreadystatechange');var u=this.timeout;if(u)this._timer=o((function(){this.errorType=p.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');s(this);}).bind(this),u);p._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(t?j.serialize(t):'');},abort:function(){s(this);},toString:function(){var t='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)t+=' errorType='+this.errorType+' ('+this.errorText+')';return t+']';},toJSON:function(){var t={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)t.uri=this.uri;for(var u in t)if(t[u]==null)delete t[u];return t;}});if(window.addEventListener&&m.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===i.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',r);f.exports=p;},null);
__d("ChannelClientID",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=(Math.random()*2147483648|0).toString(16),i={getID:function(){return h;}};f.exports=i;},null);
__d('ChannelSubdomain',['Event','JSLogger','Run','setTimeoutAcrossTransitions','LogHistory','WebStorage'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=c('LogHistory').getInstance('channel'),m=c('WebStorage').getLocalStorage(),n=i.create('channel'),o='channel_sub:',p=7,q=100*1000,r=null,s;function t(){if(s){clearTimeout(s);s=null;}if(m&&r!=null)m.removeItem(o+r);r=null;}function u(v,w,x){var y=(v-1)*p;if(x){if(s)clearTimeout(s);r=s=null;}if(w==null)w=Math.floor(Math.random()*y);if(r==null)if(m){var z=[];for(var aa=0;aa<m.length;aa++){var ba=m.key(aa);if(ba.indexOf(o)===0){var ca=parseInt(ba.substr(o.length),10);z[ca]=parseInt(m.getItem(ba),10);}}var da=Date.now()-q;for(aa=0;aa<y;aa++){var ea=(aa+w)%y;if(!z[ea]||z[ea]<da){r=ea;break;}}if(r!=null){var fa=function(){try{m.setItem(o+r,Date.now());}catch(ga){l.warn('subdomain set failed',ga.message);}s=k(fa,q/2);};fa();}else{l.warn('no channel subdomain',z);n.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){h.listen(window,'pagehide',t);}else j.onUnload(t);}else r=w;return r==null?null:r%p;}f.exports={allocate:u,clear:t};},null);
__d('DocRPC',['ErrorUtils'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={_apis:{},_dispatch:function(j){var k;try{j=JSON.parse(j);}catch(l){throw new Error('DocRPC unparsable dispatch: "'+j+'"');}if(i._apis.hasOwnProperty(j.api)){var m=i._apis[j.api];if(m[j.method])k=h.applyWithGuard(m[j.method],m,j.args);}if(k===undefined)k=null;return JSON.stringify(k);},publish:function(j,k){i._apis[k]=j;},proxy:function(j,k,l){var m={};l.forEach(function(n){m[n]=function(){var o={api:k,method:n,args:Array.prototype.slice.call(arguments)},p;try{if(j.closed)throw new Error('DocRPC window closed');p=j.DocRPC._dispatch(JSON.stringify(o));}catch(q){h.reportError(q);return;}if(typeof p=='string')try{p=JSON.parse(p);}catch(q){throw new Error('DocRPC '+k+'.'+n+' unparsable return: "'+p+'"');}return p;};});return m;}};f.exports=b.DocRPC=i;},null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=k.getInstance('channel');function q(){return (1048576*Math.random()|0).toString(36);}function r(ba,ca){var da=ba.subdomain;da=da===null?'':da+'-';var ea=new m(ca).setDomain(da+ba.host+'.'+ba.domain).setPort(ba.port).setSecure(new m(window.location.href).isSecure());return ea;}function s(ba){var ca={partition:ba.partition,cb:q(),failure:ba.pingFailuresOnSubdomain};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;if(ba.sticky_pool)ca.sticky_pool=ba.sticky_pool;var da=r(ba,'/p').setQueryData(ca);p.log('start_p',{uri:da.toString()});var ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;var fa=function(ga){p.log('finish_p',{xhr:ga.toJSON?ga.toJSON():ga,subdomain:ba.subdomain,fullHost:ba.fullHost});};ea.onError=function(ga){fa(ga);if(ba.subdomain===null)return;ba.pingFailuresOnSubdomain++;ba.subdomain++;if(ba.subdomain>6)ba.subdomain=0;};ea.timeout=ba.P_TIMEOUT;ea.onSuccess=fa;ea.send();}function t(ba,ca,da){var ea=new Image(),fa=0,ga=function(ja){ea.abort();return ja?ca():da();};ea.onload=l.guard(function(){p.log('ping_ok',{duration:Date.now()-fa});ga(true);},'ChannelTransport image.onload');ea.onerror=l.guard(function(){s(ba);ga(false);},'ChannelTransport image.onerror');var ha=o(ea.onerror,10000);ea.abort=function(){if(ha){clearTimeout(ha);ha=null;}ea.onload=ea.onerror=null;};var ia={partition:ba.partition,cb:q()};if(ba.sticky_token)ia.sticky_token=ba.sticky_token;if(ba.sticky_pool)ia.sticky_pool=ba.sticky_pool;if(ba.lastRequestErrorReason){ia.reason=ba.lastRequestErrorReason;ba.lastRequestErrorReason=null;}if(ba.uid&&ba.viewerUid){ia.uid=ba.uid;ia.viewer_uid=ba.viewerUid;}if(ba.watchdog&&ba.watchdog.enabled)ia.wtc=ba.watchdog.doSerialize();fa=Date.now();ea.src=r(ba,'/ping').setQueryData(ia);return ea;}function u(ba,ca){var da={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)da.sticky_token=ba.sticky_token;if(ba.sticky_pool)da.sticky_pool=ba.sticky_pool;if(ba.profile)da.profile=ba.profile;if(ba.capabilities)da.cap=ba.capabilities;da.id=ca;var ea=r(ba,'/add_bud').setQueryData(da),fa=new h('GET',ea);if(h.supportsCORS())fa.xhr.withCredentials=true;fa.onError=function(ga){p.warn('add_buddy_error');};fa.onSuccess=function(ga){p.log('add_buddy_ok');};fa.timeout=ba.P_TIMEOUT;fa.send();}function v(ba){var ca={channel:ba.user_channel,partition:ba.partition,clientid:ba.sessionID,cb:q(),cap:0,uid:ba.uid,viewer_uid:ba.viewerUid};if(ba.sticky_token)ca.sticky_token=ba.sticky_token;if(ba.sticky_pool)ca.sticky_pool=ba.sticky_pool;if(ba.is_offline||ba.shouldSuppressPresence){ca.state='offline';}else ca.state='active';if(ca.state===ba.lastPresenceState)return;ba.lastPresenceState=ca.state;if(ba.profile)ca.profile=ba.profile;if(ba.capabilities)ca.cap=ba.capabilities;var da=r(ba,'/active_ping').setQueryData(ca),ea=new h('GET',da);if(h.supportsCORS())ea.xhr.withCredentials=true;ea.onError=function(fa){p.warn('active_ping_error');};ea.onSuccess=function(fa){p.log('active_ping_ok');};ea.timeout=ba.P_TIMEOUT;ea.send();}function w(ba,ca,da,ea){var fa=new Date(),ga=-1;if(ba.userActive>0){ga=(fa-ba.userActive)/1000|0;if(ga<0)p.warn('idle_regression',{idleTime:ga,now:fa.getTime(),userActive:ba.userActive});}var ha={channel:ba.user_channel,seq:ba.seq,partition:ba.partition,clientid:ba.sessionID,cb:q(),idle:ga,qp:'y',cap:0};if(!!ba.watchdog&&ba.watchdog.enabled)ha.wtc=ba.watchdog.doSerialize();if(ba.ready)if(ba.seqTurSentAt==-1||ba.seqTurSentAt==ba.seq){ha.tur=ba.timeUntilReady;ha.qpmade=ba.queueMade;ba.seqTurSentAt=ba.seq;}if(ba.irisSequenceId)ha.isq=ba.irisSequenceId;ha.msgs_recv=ba.estimatedReceived;if(ba.uid&&ba.viewerUid){ha.uid=ba.uid;ha.viewer_uid=ba.viewerUid;}if(ba.stableDeviceId)ha.sdi=1;if(ba.sticky_token){ha.sticky_token=ba.sticky_token;}else if(ba.msgr_region)ha.msgr_region=ba.msgr_region;if(ba.sticky_pool)ha.sticky_pool=ba.sticky_pool;if('trace_id' in ba)ha.traceid=ba.trace_id;if(ba.is_offline||ba.shouldSuppressPresence){ha.state='offline';}else if(ba.userActive>0&&ga<60)ha.state='active';ba.lastPresenceState=ha.state;if(ba.streamingCapable){ha.mode='stream';ha.format='json';}if(ba.profile)ha.profile=ba.profile;if(ba.capabilities)ha.cap=ba.capabilities;var ia=r(ba,'/pull').setQueryData(ha),ja=ba.fantail_enabled?'POST':'GET',ka=new h(ja,ia);if(h.supportsCORS())ka.xhr.withCredentials=true;ka.timeout=ba.streamingCapable?ba.STREAMING_TIMEOUT:ba.LONGPOLL_TIMEOUT;ka.onJSON=ca;ka.onSuccess=da;ka.onError=function(){var na=this.status==12002&&this._time>=ba.MIN_12002_TIMEOUT||this.status==504&&this._time>=ba.MIN_504_TIMEOUT,oa=na?da:ea;return oa&&oa.apply(this,arguments);};if(ba.fantail_logs&&ba.fantail_logs.length>0){var la={};for(var ma=0;ma<ba.fantail_logs.length;ma++)Object.assign(la,ba.fantail_logs[ma]);ka.send(la);ba.fantail_logs=[];}else ka.send();ba.inStreaming=ba.streamingCapable;return ka;}function x(ba){this.manager=ba;this.init&&this.init();}function y(ba){x.apply(this,arguments);}Object.assign(y.prototype,{logName:'CORS',enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='init')o(n(this.manager,'exitState',{status:i.OK,stateId:ca.stateId}),ca.fullReloadAsSuccess?0:3000);if(!/pull|ping/.test(ba))return;var da=this.manager;if(ba=='ping'){this._request=t(ca,n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(da,'_processTransportData',ca.stateId),n(da,'exitState',{status:i.OK,stateId:ca.stateId}),n(da,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});function z(ba){p.log('iframe_init_constructor');x.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);j.publish(this,'outerTransport');}Object.assign(z.prototype,{logName:'iframe',_initIframe:function(ba){p.log('iframe_init_start');window.onchanneliframeready=function(){p.log('iframe_resources');return ba.resources;};window.onchanneliframeloaded=function(){p.log('iframe_loaded');};if(ba){this._iframeURI=r(ba,ba.path);if(ba.resources){var ca=this._iframeURI.getDomain();ba.resources=ba.resources.map(function(fa){var ga=new m(fa);if(ga.getPath().startsWith('/intern/rsrc.php')&&ga.getQueryData().origin!==undefined)return ga.addQueryData('origin',ca).toString();return fa;});}if(ba.bustIframe){var da={partition:ba.partition,cb:q()};this._iframeURI.setQueryData(da);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);p.log('iframe_uri_set');}catch(ea){p.error('iframe_uri_set_error',ea);this.exitState({status:i.ERROR,stateId:ba.stateId},ea+'');}},enterState:function(ba,ca){if(ba=='init'){this._initIframe(ca);}else if(/idle|ping|pull/.test(ba)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(ba!='idle')this.exitState({status:i.ERROR,stateId:ca.stateId},'iframe not yet loaded');}else if(ba=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(ba){if(this.manager.state=='init'&&ba.status==i.OK)this._iframeProxy=j.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function aa(){this.init=this.init.bind(this);x.apply(this,arguments);}Object.assign(aa.prototype,{logName:'iframe(inner)',init:function(){j.publish(this,'innerTransport');try{var ca=j.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,ca);this.exitState({status:i.OK,stateId:1e+06});}catch(ba){p.error('iframe_inner_init_error',ba);}},enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='ping'){this._request=t(ca,n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,n(this,'_processTransportData',ca.stateId),n(this,'exitState',{status:i.OK,stateId:ca.stateId}),n(this,'exitState',{status:i.ERROR,stateId:ca.stateId}));}});f.exports={getURI:r,Transport:x,CORSTransport:y,IframeTransport:z,IframeInnerTransport:aa,sendActivePing:v,sendAdditionalBuddyRequest:u};},null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k,l,m){m=babelHelpers._extends({},i(k),m);var n=new h(k,l,m);n.streamMode=false;var o=n._call;n._call=function(p){if(p=='onJSON'&&this.json){if(this.json.error){this.errorType=h.SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}o.apply(this,arguments);};n.ajaxReqSend=n.send;n.send=function(p){this.ajaxReqSend(babelHelpers._extends({},p,m));};return n;}f.exports=j;},null);
__d("MovingStat",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;},null);
__d('Dcode',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h,i={},j={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var l=[];for(var m in j){i[j[m]]=m;l.push(j[m]);}l.reverse();h=new RegExp(l.join("|"),'g');})();var k={encode:function(l){return encodeURIComponent(l).replace(/([_A-Z])|%../g,function(m,n){return n?'%'+n.charCodeAt(0).toString(16):m;}).toLowerCase().replace(h,function(m){return i[m];});},decode:function(l){return decodeURIComponent(l.replace(/[_A-Z]/g,function(m){return j[m];}));}};f.exports=k;},null);
__d('PresenceCookieManager',['Cookie','CurrentUser','Dcode','ErrorUtils','JSLogger','PresenceInitialData','PresenceUtil','URI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=m.cookieVersion,q=m.dictEncode,r='presence',s={},t=null,u=null,v=l.create('presence_cookie');function w(){try{var aa=h.get(r);if(t!==aa){t=aa;u=null;if(aa&&aa.charAt(0)=='E')aa=j.decode(aa.substring(1));if(aa)u=JSON.parse(aa);}if(u){if(u.user&&u.user!==i.getID())return null;if(u.v!==p)return null;return u;}}catch(z){v.warn('getcookie_error',z);}return null;}function x(){return parseInt(Date.now()/1000,10);}var y={register:function(z,aa){s[z]=aa;},store:function(){var z=w();if(z&&z.v&&p<z.v){v.debug('stale_cookie',p);return;}var aa={v:p,time:x(),user:i.getID()};for(var ba in s)aa[ba]=k.applyWithGuard(s[ba],s,[z&&z[ba]],function(fa){fa.presence_subcookie=ba;});var ca=JSON.stringify(aa);if(q)ca='E'+j.encode(ca);if(n.hasUserCookie()){var da=ca.length;if(da>1024)v.warn('big_cookie',da);var ea=o.getRequestURI(false).isSecure()&&!!h.get('csm');h.set(r,ca,null,null,ea);}},clear:function(){h.clear(r);},getSubCookie:function(z){var aa=w();if(!aa)return null;return aa[z];}};f.exports=y;},null);
__d('PresenceState',['Arbiter','ErrorUtils','JSLogger','PresenceCookieManager','debounceAcrossTransitions','setIntervalAcrossTransitions','PresenceInitialData'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=n.cookiePollInterval||2000,p=n.shouldSuppress||false,q=[],r=[],s=null,t=null,u=0,v=null,w=0,x=['sb2','t2','lm2','uct2','tr','tw','at','wml'],y=j.create('presence_state');function z(){return k.getSubCookie('state');}function aa(){u=Date.now();k.store();ea(t);}var ba=l(aa,0);function ca(ja){if(typeof ja=='undefined'||isNaN(ja)||ja==Number.POSITIVE_INFINITY||ja==Number.NEGATIVE_INFINITY)ja=0;return ja;}function da(ja){var ka={};if(ja){x.forEach(function(na){ka[na]=ja[na];});if(u<ja.ut)y.error('new_cookie',{cookie_time:ja.ut,local_time:u});}ka.ut=u;for(var la=0,ma=q.length;la<ma;la++)i.applyWithGuard(q[la],null,[ka]);t=ka;return t;}function ea(ja){w++;u=ca(ja.ut);if(!s)s=m(ha,o);t=ja;if(v===null)v=ja;for(var ka=0,la=r.length;ka<la;ka++)i.applyWithGuard(r[ka],null,[ja]);w--;}function fa(ja){if(ja&&ja.ut)if(u<ja.ut){return true;}else if(ja.ut<u)y.error('old_cookie',{cookie_time:ja.ut,local_time:u});return false;}function ga(){var ja=z();if(fa(ja))t=ja;return t;}function ha(){var ja=z();if(fa(ja))ea(ja);}k.register('state',da);h.subscribe(j.DUMP_EVENT,function(ja,ka){ka.presence_state={initial:babelHelpers._extends({},v),state:babelHelpers._extends({},t),update_time:u,sync_paused:w,poll_time:o};});(function(){var ja=ga();if(ja){ea(ja);}else{y.debug('no_cookie_initial');ea(da());return;}})();var ia={doSync:function(ja){if(w)return;if(ja){aa();}else ba();},registerStateStorer:function(ja){q.push(ja);},registerStateLoader:function(ja){r.push(ja);},get:function(){return ga();},getInitial:function(){return v;},shouldSuppress:function(){return p;},verifyNumber:ca};f.exports=ia;},null);
__d('RTISession',['URI','AjaxRequest','invariant','ErrorUtils'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l='.facebook.com';function m(n,o,p,q,r,s,t,u,v){!n?j(0):undefined;!q?j(0):undefined;!r?j(0):undefined;this.domain=n;this.port=o;this.edgePoolName=p;this.stickyToken=q;this.loggedInId=r;this.accountId=s;this.clientProfile=t||'desktop';this.clientId=u;this.capabilities=v;}m.prototype.issueRequest=function(n,o,p,q,r){!n?j(0):undefined;!o?j(0):undefined;!q?j(0):undefined;var s=this.domain.length-l.length,t=s>0&&this.domain.indexOf(l,s)!==-1,u=t?this.domain:this.domain+l,v=(1048576*Math.random()|0).toString(36),w={cb:v,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var x in w)!!o[x]?j(0):undefined;Object.assign(w,o);var y=new h(n).setDomain(u).setPort(this.port).setSecure(new h(window.location.href).isSecure()).setQueryData(w),z=p?'POST':'GET',aa=new i(z,y);aa.timeout=r?r*1000:30000;if(aa.xhr)aa.xhr.withCredentials=true;var ba={};aa.onSuccess=function(){};aa.onJSON=(function(){ba.data=aa.json;ba.error=null;k.applyWithGuard(q,this,[ba]);}).bind(this);aa.onError=(function(){ba.data=null;ba.error=aa.errorType||'error';k.applyWithGuard(q,this,[ba]);}).bind(this);aa.send(JSON.stringify(p));};f.exports=m;},null);
__d('ChannelManager',['AjaxRequest','Arbiter','AsyncRequest','ChannelClientID','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChatVisibility','DTSG','Env','FBAjaxRequest','ISB','JSLogger','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','Run','SystemEvents','URI','UserActivity','FBRTCSupport','RTISession','createArrayFromMixed','errorCode','setIntervalAcrossTransitions','setTimeoutAcrossTransitions','WebStorage'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja){if(c.__markCompiled)c.__markCompiled();var ka=c('WebStorage').getSessionStorage(),la='chproxy_base_sess',ma,na=u.create('channel'),oa=null;function pa(fb){oa=fb;}var qa={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ra={reconnectOverrideTimeMillis:Date.now(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',irisSequenceId:m.sequenceId,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,estimatedReceived:0,fantail_logs:[],sessionID:k.getID(),stableDeviceId:false,capabilities:ea.getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:y.shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false,FANTAIL_QUEUE_CAPACITY:50},sa={MAX_CONTINUOUS_PULL_FAILS:3,enabled:false,uptimeMillis:Date.now(),timeInGoodStatesStartMillis:Date.now(),timeInGoodStatesMillis:0,initialized:false,firstPullSentTimeMillis:Date.now(),accumulatedPullTimeMillis:0,pullStartTimeMillis:0,pingCount:0,pullCount:0,continuousPullFails:0,getTimeSinceFirstPullSentSeconds:function(){return (Date.now()-this.firstPullSentTimeMillis)/1000;},getUptimeSeconds:function(){return (Date.now()-this.uptimeMillis)/1000;},getAccumulatedPullTimeSeconds:function(){var fb=this.accumulatedPullTimeMillis,gb=Date.now();if(this.pullStartTimeMillis>0&&gb-this.pullStartTimeMillis<=ra.LONGPOLL_TIMEOUT)fb+=gb-this.pullStartTimeMillis;var hb=fb/1000;if(hb>=this.getTimeSinceFirstPullSentSeconds())this.initialize();return hb;},getPingToPullRatio:function(){return this.pullCount===0?0:this.pingCount/this.pullCount;},reportPullSent:function(){if(!this.enabled)return;if(!this.initialized)this.initialize();this.pullStartTimeMillis=Date.now();},initialize:function(){this.initialized=true;this.firstPullSentTimeMillis=Date.now();this.pullStartTimeMillis=0;this.accumulatedPullTimeMillis=0;this.pingCount=0;this.pullCount=0;this.timeInGoodStatesStartMillis=Date.now();this.timeInGoodStatesMillis=0;this.uptimeMillis=Date.now();},reportPullReturned:function(fb,gb){if(!this.enabled)return;if(this.pullStartTimeMillis>0){this.accumulatedPullTimeMillis+=Date.now()-this.pullStartTimeMillis;if(fb){this.pullCount++;this.continuousPullFails=0;}else this.continuousPullFails++;}this.pullStartTimeMillis=0;},reportPingSent:function(){if(!this.enabled)return;this.pingCount++;},isGoodState:function(fb){return fb.indexOf('pull')===0||fb.indexOf('init')===0||fb.indexOf('idle')===0;},getTotalTimeInGoodStatesSeconds:function(){var fb=this.timeInGoodStatesMillis;if(this.timeInGoodStatesStartMillis>0)fb+=Date.now()-this.timeInGoodStatesStartMillis;return fb/1000;},clientEnteredState:function(fb){if(!this.enabled)return;var gb=this.isGoodState(fb);if(gb&&this.timeInGoodStatesStartMillis===0){this.timeInGoodStatesStartMillis=Date.now();}else if(!gb&&this.timeInGoodStatesStartMillis>0){this.timeInGoodStatesMillis=Date.now()-this.timeInGoodStatesStartMillis;this.timeInGoodStatesStartMillis=0;}},transportEnteredState:function(fb){if(!this.enabled)return;if(fb.indexOf('pull')===0){this.reportPullSent();}else if(fb.indexOf('ping')===0&&ra.lastRequestErrorReason!==l.SYS_TIMETRAVEL&&ra.lastRequestErrorReason!==l.SYS_ONLINE&&ra.lastRequestErrorReason!==l.SYS_OWNER&&ra.lastRequestErrorReason!==l.SYS_NONOWNER)this.reportPingSent();},doSerialize:function(){if(!this.enabled)return '';return this.getTimeSinceFirstPullSentSeconds().toFixed(0)+','+this.getAccumulatedPullTimeSeconds().toFixed(0)+','+this.getPingToPullRatio().toFixed(3)+','+this.getUptimeSeconds().toFixed(0)+','+this.getTotalTimeInGoodStatesSeconds().toFixed(0);}},ta=1,ua={},va=0;function wa(){return j.lastSuccessTime?Math.round((Date.now()-j.lastSuccessTime)/1000):-1;}function xa(){var fb={};if(ma.getConfig('host'))fb[ma.getConfig('user_channel')]=ma.getConfig('seq',0);return fb;}function ya(){var fb=Date.now(),gb=Date.now(),hb={total:0},ib='idle',jb=false;ba.subscribe([ba.USER,ba.ONLINE,ba.TIME_TRAVEL],function(mb,nb){ab(true);gb=null;ma.lastPullTime=Date.now();var ob;switch(mb){case ba.USER:ob=ba.isPageOwner()?l.SYS_OWNER:l.SYS_NONOWNER;break;case ba.ONLINE:ob=nb?l.SYS_ONLINE:l.SYS_OFFLINE;break;case ba.TIME_TRAVEL:ob=l.SYS_TIMETRAVEL;break;}ma.exitState({status:ob,stateId:ta});});var kb=function(mb,nb){var ob=Date.now(),pb=null;if(nb){fb=ob;pb=nb.nextState||nb.state;}else pb=ib;ba.checkTimeTravel();if(gb){var qb=Math.round((ob-gb)/1000);if(qb>0){hb[ib]=(hb[ib]||0)+qb;hb.total+=qb;}}ib=pb;gb=ob;if(!mb){hb.lastSuccessTime=wa();hb.online=ba.isOnline();na.log('rollup',hb);}};i.subscribe(l.ON_ENTER_STATE,kb);ia(kb,60000);i.subscribe(u.DUMP_EVENT,function(mb,nb){nb.channelRollup=hb;});var lb=function(){if(ma.isShutdown()||ma.shouldIdle())return;ba.checkTimeTravel();var mb=Date.now()-(ma.lastPullTime||r.start);if(!jb&&mb>ra.STALL_THRESHOLD){var nb=wa();na.error('stall',{lastSuccessTime:nb,rollupState:ib});jb=true;}var ob=Date.now()-fb;if(ma.state=='pull'&&ob>ra.JUMPSTART_THRESHOLD){fb=null;na.warn('jumpstart',{state:ma.state,dormant:ob});ma.enterState('init');}};ia(lb,10000);}function za(){var fb=Date.now(),gb=1;function hb(){ja(hb,gb*1000);var mb=ma.state;if(mb=='idle'&&ma.shouldIdle())return;na.bump('conn_t',gb);if(mb=='pull')na.bump('conn_t_pull',gb);}hb();var ib=[15,30,60,120,240],jb=false,kb=false;function lb(mb){ja(function(){na.rate('pullenter_'+mb,jb);na.rate('pullexit_'+mb,kb);},mb*1000);}while(ib.length)lb(ib.shift());i.subscribe(l.ON_ENTER_STATE,function(mb,nb){if(nb.state=='pull')jb=true;fb=Date.now();});i.subscribe(l.ON_EXIT_STATE,function(mb,nb){if(nb.state!='pull'||!fb)return;var ob='other';if(nb.status==l.OK){kb=true;ob='ok';}else if(nb.xhr&&nb.xhr.errorType){ob=/ar:(\w+)/.test(nb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(nb.status))return;var pb=(Date.now()-fb)/1000;if(pb<0){return;}else if(pb>3600)pb=3600;na.bump('conn_num');na.bump('conn_exit',pb);na.bump('conn_num_'+ob);na.bump('conn_exit_'+ob,pb);});}function ab(fb){if(fb){va=0;ua={};}else va++;}function bb(){if(!ra.stableDeviceId)return;var fb={},gb=function(hb){if(typeof ra[hb]=='string')fb[hb]=ra[hb];};gb('sticky_token');gb('sticky_pool');gb('host');gb('fullHost');ka.setItem(la,JSON.stringify(fb));}function cb(){var fb=!h.supportsCORS()||ra.forceIframe;if(ra.subdomain===null||fb){ra.fullHost=ra.host;}else ra.fullHost=ra.subdomain+'-'+ra.host;bb();}function db(fb){if(!fb)return false;fb=fb.trim();if(fb.length===0)return false;try{var hb=JSON.parse(fb),ib=function(jb){if(typeof hb[jb]=='string')ra[jb]=hb[jb];};ib('sticky_token');ib('sticky_pool');ib('host');ib('fullHost');return true;}catch(gb){na.error('unable to parse state: '+fb);return false;}}ma={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:pa,backoff:false,sessionRegistered:false,init:function(fb){this.init=function(){};i.subscribe(l.GET_RTI_SESSION_REQUEST,(function(event,ob){this.informCurrentSession();}).bind(this));this._logFantail('client initialized',l.FANTAIL_INFO);var gb=!!ra.use_sticky_session,hb=false;ra.stableDeviceId=false;if(gb&&ka){ra.stableDeviceId=true;var ib=true;for(var jb=0;jb<ka.length;jb++){var kb=ka.key(jb);if(kb.indexOf(la)===0){hb=db(ka.getItem(kb));ib=!hb;break;}}if(ib)bb();}this._logFantail('using session id: '+ra.sessionID+(hb?' [restored]':' [new]')+' with sticky:'+ra.sticky_token+'/'+ra.sticky_pool,l.FANTAIL_INFO);sa.enabled=!!ra.watchdog_enabled;ra.watchdog=sa;if(typeof da!='undefined'){da.subscribe(function(){ra.userActive=Date.now();o.sendActivePing(ra);});}else na.error('user_activity_undefined');x.register('ch',xa);var lb=this.getConfig('max_conn',2);ra.subdomain=n.allocate(lb);this._transportRate=new w(30000);var mb=h.supportsCORS()&&!ra.forceIframe?'CORSTransport':'IframeTransport';this.transport=new o[mb](this);if(fb)this.enterState.apply(this,arguments);i.subscribe(u.DUMP_EVENT,(function(event,ob){ob.transportRate=this._transportRate.tally();ob.transportType=mb;ob.transportVersion=2;}).bind(this));ya();za();if(ma.getConfig('tryStreaming')&&ma.getConfig('host')&&h.supportsCORS()&&!ra.forceIframe){var nb=ra.MIN_INIT_PROBE_DELAY+Math.random()*ra.INIT_PROBE_DELAY_RANDOMIZE_RANGE;ja(this._probeTest,nb);}},configure:function(){var fb=ga(arguments);na.log('configure',fb);fb.forEach(function(gb){return Object.assign(ra,gb);});cb();i.inform(l.ON_CONFIG,this);},getConfig:function(fb,gb){return fb in ra?ra[fb]:gb;},getCompleteConfig:function(){return ra;},informCurrentSession:function(){var fb=null;if(this.sessionRegistered&&ra&&ra.fullHost&&ra.sticky_token&&ra.uid)fb=new fa(ra.fullHost,ra.port,ra.sticky_pool,ra.sticky_token,ra.uid,ra.viewer_uid,ra.profile,ra.sessionID,ra.capabilities);i.inform(l.RTI_SESSION,fb);},getWatchdog:function(){return sa;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(ba.isPageOwner()&&ba.isOnline());},_sendIframeError:function(fb){var gb=new j().setURI('/ajax/presence/reconnect.php').setData({reason:fb,fb_dtsg:q.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);gb.specifiesWriteRequiredParams()&&gb.send();},_getDelay:function(){var fb=Math.min(ra.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,va-1)),ra.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in ra)fb=ra.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(fb*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)na.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(fb){this._inEnterState=false;throw fb;}},_enterState:function(fb){if((fb.indexOf('pull')===0||fb.indexOf('ping')===0||fb.indexOf('shutdown')===0)&&!!ra.active_config_refresh){var gb=Date.now(),hb=(gb-ra.reconnectOverrideTimeMillis)/1000;if('config_refresh_seconds' in ra&&ra.config_refresh_seconds>0&&hb>ra.config_refresh_seconds){fb='reconnect';this._logFantail('forcing reconnect to refresh config'+' - this is normal behavior',l.FANTAIL_DEBUG);}}if(fb.indexOf('reconnect')===0)ra.reconnectOverrideTimeMillis=Date.now();var ib=this.backoff?this._getDelay():0;this.backoff=false;var jb=ga(arguments);if(this.isShutdown()){this._logFantail('not executing state due to shutdown mode: '+fb,l.FANTAIL_WARN);return;}if(fb!='idle!'&&this.shouldIdle()){this._logFantail('forced idleness',l.FANTAIL_WARN);return;}ta++;ra.stateId=ta;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(fb)){var kb=this._transportRate.tally().timeAverage,lb=ma.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(kb>=lb){if(!this._throttled){this._throttled=true;na.warn('throttled');}na.bump('throttle');ib=1000/lb;}}else if(!(/#$/.test(fb)))ib=this._getDelay();fb=fb.replace(/\W*$/,'');if(!qa[fb]){this._logFantail('invalid state: '+fb,l.FANTAIL_ERROR);throw new Error('invalid state:'+fb);}var mb;if(ib<=0){mb={state:fb};this._transportRate.add(1);this.state=fb;var nb=this['_enter_'+this.state];if(nb){jb.shift();nb.apply(this,jb);}if(/init|idle|pull|ping/.test(this.state)){if(ra.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];sa.transportEnteredState(fb);sa.clientEnteredState(fb);ra.is_offline=!p.isOnline();ra.capabilities=ea.getCapabilities();this._logFantail('entering transport state: '+this.state,l.FANTAIL_INFO);this.transport.enterState(this.state,ra);if(this.state=='ping'){mb.url=o.getURI(ra).toString();mb.port=ra.port||'undefined';}}}else{this.state='idle';this.nextState=fb;mb={state:this.state,delay:ib,nextState:fb};jb[0]=fb+'#';this._deferredTransition=ja((function(){this._deferredTransition=null;this.enterState.apply(this,jb);}).bind(this),ib);}if(/pull/.test(fb)){mb.client_id=ra.sessionID;mb.streaming=ra.inStreaming;}na.log('enter_'+this.state,mb);i.inform(l.ON_ENTER_STATE,mb);},exitState:function(fb,gb){var hb=fb.stateId,ib=fb.status;if((ib==l.SYS_TIMETRAVEL||ib==l.SYS_ONLINE||ib==l.SYS_NONOWNER||ib==l.SYS_OWNER)&&sa)sa.initialize();if(this.isShutdown()||hb<ta)return;var jb=ga(arguments),kb=this.state;jb[0]=fb.status;var lb={state:kb,status:ib};if(/pull/.test(kb)){lb.client_id=ra.sessionID;lb.streaming=ra.inStreaming;}if(/ping/.test(kb)&&ib!=l.OK)lb.url=o.getURI(ra).toString();if(this.nextState)lb.nextState=this.nextState;if(gb&&gb.errorType){ra.lastRequestErrorReason=gb.errorType;lb.xhr=gb.toJSON?gb.toJSON():gb;if(gb.errorType==h.SERVICE_UNAVAILABLE){this._logFantail('got 5xx http status code, setting long delay',l.FANTAIL_ERROR);this.proxyDown=true;}delete lb.xhr.json;}else if(ib!=l.OK)ra.lastRequestErrorReason=ib;if(gb&&gb.json){if(gb.json.t)lb.t=gb.json.t;if(gb.json.reason)lb.reason=gb.json.reason;if(gb.json.seq)lb.seq=gb.json.seq;}na.log('exit_'+kb,lb);i.inform(l.ON_EXIT_STATE,lb);var mb=this['_exit_'+kb];if(mb)ib=mb.apply(this,jb)||ib;if(ib!=l.OK){ab();ua[kb]=(ua[kb]||0)+1;}var nb=qa[this.nextState||kb][ib]||qa._all[ib],ob=nb&&nb.replace(/!*$/,'');if(!ob){na.error('terminal_transition',lb);this._shutdownHint=l.HINT_INVALID_STATE;nb='shutdown!';this._logFantail('entering shutdown state',l.FANTAIL_ERROR);}this._lastState=kb;this._lastStatus=ib;this.enterState(nb);},_processTransportData:function(fb,gb){var hb=gb.json,ib=hb.t;if('s' in hb){hb.seq=hb.s;delete hb.s;}if(hb.u&&ra.user&&hb.u!=ra.user){na.warn('misguided_msg',{user:ra.user,target:hb.u});this._reportProxyMisguidedMsg(hb.u,ra.user);return;}var jb=ra.seq;if('seq' in hb){ra.seq=hb.seq;y.doSync();}switch(ib){case 'continue':if(ra.inStreaming&&this.heartbeats.length<1){ra.streamingCapable=false;na.log('switch_to_longpoll');ja(this._probeTest,ra.PROBE_DELAY);}ab(true);if(!ra.inStreaming||ra.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:l.OK,stateId:fb});break;case 'refresh':case 'refreshDelay':this._logFantail('got refresh with reason: '+hb.reason,l.FANTAIL_INFO);this.exitState({status:'refresh_'+(hb.reason||0),stateId:fb},gb);break;case 'backoff':this._logFantail('server told client to back off',l.FANTAIL_WARN);ab();this.backoff=true;break;case 'lb':var kb=hb.lb_info;if(kb){ra.sticky_token=kb.sticky;if('pool' in kb)ra.sticky_pool=kb.pool;if('vip' in kb)ra.host=kb.vip;cb();}else na.error('bad lb info');break;case 'test_streaming':ja(this._probeTest,500);break;case 'fullReload':x.clear();na.log('invalid_history');this.sessionRegistered=true;this.informCurrentSession();i.inform(l.ON_INVALID_HISTORY);ab(true);this._logFantail('full reload incurred',l.FANTAIL_INFO);var lb=l.ERROR_MISSING;if(ra.fullReloadAsSuccess)lb=l.OK;this.exitState({status:lb,stateId:fb},gb);if('ms' in hb)this._processMessages(hb,jb);break;case 'msg':ab(true);this._processMessages(hb,jb);break;case 'heartbeat':if(ra.inStreaming){var mb=Date.now();if(this.heartbeats.length>0){var nb=mb-this.heartbeats[this.heartbeats.length-1];na.log('heartbeat_interval',{client_id:ra.sessionID,interval:nb});}this.heartbeats.push(mb);}break;default:this._logFantail('got an unknown protocol message: '+ib,l.FANTAIL_ERROR);na.error('unknown_msg_type',{type:ib});break;}},_processMessages:function(fb,gb){var hb,ib,jb,kb;if('tr' in fb)ra.trace_id=fb.tr;ib=fb.ms;jb=ra.seq-ib.length;for(hb=0;hb<ib.length;hb++,jb++){ra.estimatedReceived++;if(jb>=gb){kb=ib[hb];if(kb.type){var lb=l.getArbiterType(kb.type);if(kb.type==='messaging'){var mb={type:'messaging',event:kb.event};if(kb.message){mb.inbox_unread=kb.unread_counts&&kb.unread_counts.inbox;mb.tid=kb.message.tid;mb.mid=kb.message.mid;this._logFantail('got message with id: '+kb.message.mid,l.FANTAIL_INFO);}na.debug('message',mb);}else if(kb.type==='pages_messaging'){if(kb.unread_counts&&kb.unread_counts.inbox)i.inform(l.getArbiterType('pages_inbox_count_update'),{page_id:kb[v.VIEWER_FBID],inbox_unread:kb.unread_counts.inbox});}else if(kb.type==='skywalker'){lb=l.SKYWALKER;}else if(kb.type==='qprimer'){kb.first=!ra.ready;if(kb.first){ra.ready=true;ra.timeUntilReady=Date.now()-ra.created;ra.queueMade=kb.made;}lb=l.CHANNEL_ESTABLISHED;}else if(kb.type==='delta'){ra.irisSequenceId=kb.iseq;}else na.debug('message',{type:kb.type});i.inform(lb,{obj:kb});}}else na.warn('seq_regression',{seq:jb,last_seq:gb,messages:ib.length});}},_enter_init:function(){if(ua.init>=ma.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:l.ERROR_MAX,stateId:ta}),0);this._initTimer=ja(this.exitState.bind(this,{status:l.ERROR,stateId:ta},'timeout'),ra.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(fb){this._logFantail('entered reconnect with reason: '+fb,l.FANTAIL_INFO);var gb=ta;if(!z.hasUserCookie()){this._logFantail('user has no cookie???',l.FANTAIL_WARN);na.warn('no_user_cookie');setTimeout(function(){ma._shutdownHint=l.HINT_AUTH;ma.exitState({status:l.ERROR_SHUTDOWN,stateId:gb});},0);return;}var hb={reason:fb,fb_dtsg:q.getToken()};if(t.token)hb.fb_isb=t.token;if(oa)oa(hb);var ib=new s('GET','/ajax/presence/reconnect.php',hb);ib.onSuccess=(function(){ma.configure(ib.json);x.store();this.exitState({status:l.OK,stateId:gb});}).bind(this);ib.onError=(function(){var jb=ib.json&&ib.json.error;this._logFantail('reconnect error: '+ib.errorType,l.FANTAIL_ERROR);if(ib.errorType==h.TRANSPORT_ERROR||ib.errorType==h.PROXY_ERROR||ib.errorType==h.SERVICE_UNAVAILABLE)this._shutdownHint=l.HINT_CONN;if(jb&&jb==1356007){this._shutdownHint=l.HINT_MAINT;}else if(jb==1357001||jb==1357004||jb==1348009){this._shutdownHint=l.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?l.ERROR_SHUTDOWN:l.ERROR,stateId:gb},ib);}).bind(this);ib.send();},_enter_shutdown:function(){i.inform(l.ON_SHUTDOWN,{reason:this._shutdownHint});if(!!ra.shutdown_recovery_enabled&&'shutdown_recovery_interval_seconds' in ra&&ra.shutdown_recovery_interval_seconds>0){var fb=ra.shutdown_recovery_interval_seconds*1000;ja((function(){i.inform(l.ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}).bind(this),fb);}},_exit_init:function(fb){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(fb==l.ERROR_MAX)this._sendIframeError(l.reason_IFrameLoadGiveUp);},_exit_pull:function(fb,gb){var hb=fb==l.OK;sa.reportPullReturned(hb,this);if(hb){this.lastPullTime=Date.now();}else{var ib='exit status: '+fb;if(gb&&gb.errorType)ib+=' ajax request error: '+gb.errorType;this._logFantail('pull failed with status: '+ib,l.FANTAIL_ERROR);}},_exit_ping:function(fb){if(fb==l.OK){var gb=Date.now()-(this.lastPullTime||r.start);if(gb>ra.STALL_THRESHOLD){this._logFantail('didnt complete a successful pull for too long',l.FANTAIL_ERROR);return l.ERROR_STALE;}}else this._logFantail('ping failed with status: '+fb,l.FANTAIL_ERROR);},_reportProxyMisguidedMsg:function(fb,gb){this._logFantail('misguided message to '+gb+' meant for '+fb,l.FANTAIL_ERROR);var hb=Date.now();if(hb-this.lastReportOnMisguidedMsgTime<=ra.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=hb;var ib={received_uid:fb,expected_uid:gb};if(ra.sticky_token)ib.sticky_token=ra.sticky_token;var jb=new ca('/err_misguided_msg').setDomain(ra.host+'.'+ra.domain).setPort(ra.port).setSecure(new ca(window.location.href).isSecure()).setQueryData(ib),kb=new h('GET',jb);if(h.supportsCORS())kb.xhr.withCredentials=true;kb.onSuccess=function(lb){};kb.onError=function(lb){};kb.onJSON=function(lb,mb){};kb.send();},_probeTest:function(){ra.streamingCapable=false;var fb=[],gb={mode:'stream',format:'json'};if(ra.sticky_token)gb.sticky_token=ra.sticky_token;var hb=new ca('/probe').setDomain(ra.host+'.'+ra.domain).setPort(ra.port).setSecure(new ca(window.location.href).isSecure()).setQueryData(gb),ib=new h('GET',hb);ib.onJSON=function(jb,kb){if(jb&&jb.json&&jb.json.t==='heartbeat'){fb.push(Date.now());if(fb.length>=2){var lb=fb[1]-fb[0];if(lb>=ra.PROBE_HEARTBEATS_INTERVAL_LOW&&lb<=ra.PROBE_HEARTBEATS_INTERVAL_HIGH){ra.streamingCapable=true;na.log('switch_to_streaming');}na.log('probe_ok',{time:lb});}}};ib.onSuccess=function(jb){if(fb.length!=2){ra.streamingCapable=false;na.error('probe_error',{error:'beats.length = '+fb.length});}};ib.onError=function(jb){ra.streamingCapable=false;na.error('probe_error',jb);};na.log('probe_request');ib.send();},_logFantail:function(fb,gb){var hb=ra.fantail_queue_capacity||ra.FANTAIL_QUEUE_CAPACITY;if(!ra.fantail_enabled||ra.fantail_logs.length>hb)return;var ib='fantail queue size exceeded',jb=l.FANTAIL_WARN;if(ra.fantail_logs.length<hb){ib=fb;jb=gb;}var kb=ra.fantail_logs.length,lb={};lb['time'+kb]=Date.now();lb['log'+kb]=ib;lb['severity'+kb]=jb;ra.fantail_logs.push(lb);}};f.exports=ma;function eb(){if(m.channelConfig){ma.configure(m.channelConfig);if(/shutdown/.test(m.state))ma._shutdownHint=l[m.reason];ma.init(m.state,m.reason);}}aa.onAfterLoad(eb);},null);
__d('ChannelConnection',['Arbiter','Run','SystemEvents','ChannelConstants','ChannelManager','JSLogger','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=m.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=Object.assign(new h(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});i.onBeforeUnload(function(){});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ca){v();q=n(w,ca);o.log('mute_warning',{time:ca});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ca,da){y();if(ca===k.ON_ENTER_STATE&&(da.nextState||da.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var ea=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:ea});}}else if(ca===k.ON_ENTER_STATE&&((da.nextState||da.state)==='ping'||!da.nextState&&da.state==='idle')){r=n(function(){var fa=null;if(!(da.state==='idle'&&!da.nextState))fa=da.delay||0;o.log('reconnecting',{delay:fa});if(u.disconnected())o.log('reconnecting_ui',{delay:fa});s=u.RECONNECTING;da.state==='idle'&&t++;if(t>1){u.inform(u.RECONNECTING,fa);}else if(!da.nextState&&da.state==='idle')z(ca,da);},500);}else if(ca===k.ON_SHUTDOWN){o.log('shutdown',{reason:da.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,da.reason);}}function aa(){if(l.isShutdown()){z(k.ON_SHUTDOWN,l._shutdownHint);}else z(k.ON_ENTER_STATE,{state:l.state,nextState:l.nextState,delay:0});}i.onAfterLoad(aa);Object.assign(u,{disconnected:function(){return s===u.SHUTDOWN||s===u.RECONNECTING&&!q&&t>1;},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:function(ca){if(l.state==='ping'||l.isShutdown())return;o.log('reconnect',{now:ca});u.inform(u.RECONNECTING,0);if(!!ca){if(p!==null){clearTimeout(p);p=null;}l.enterState('ping!');}else if(!p)p=n(function(){l.enterState('ping!');p=null;},k.CHANNEL_MANUAL_RECONNECT_DEFER_MSEC);},unmuteWarning:w});function ba(){h.subscribe([k.ON_ENTER_STATE,k.ON_SHUTDOWN],z);h.subscribe(k.ATTEMPT_RECONNECT,function(){if(u.disconnected())u.reconnect();});j.subscribe(j.TIME_TRAVEL,function(){u.reconnect();x(k.MUTE_WARNING_TIME_MSEC);});i.onBeforeUnload(y,false);}i.onAfterLoad(ba);u.mockAfterLoad=function(){aa();ba();};f.exports=u;},null);
__d('ChatproxyLastMobileActiveTimes',['ServerTime','fbt'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={};function k(o){if(!o||o<0)return '';var p=h.get()/1000-o,q=Math.floor(p/60),r=Math.floor(q/60),s=Math.floor(r/24);if(q<=1){return i._("{count}m",[i.param('count',1)]);}else if(q<60){return i._("{count}m",[i.param('count',q)]);}else if(r<24){return i._("{count}h",[i.param('count',r)]);}else if(s<3){return i._("{count}d",[i.param('count',s)]);}else return '';}function l(o,p){if(!(o in j)||j[o]<p)j[o]=p;}function m(o){if(o in j){return j[o];}else return 0;}var n={update:function(o){for(var p in o)l(p,o[p]);},getShortDisplay:function(o){return k(m(o));},get:function(o){return m(o);},getDebugData:function(){return j;}};f.exports=n;},null);
__d('ChatproxyPresenceStatus',['ArbiterMixin','AvailableListConstants','BanzaiODS','ChatVisibility','CurrentUser','ChatproxyLastMobileActiveTimes','LogHistory','PresencePrivacy','ServerTime','createObjectFrom','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();j.setEntitySample('presence',.0001);var s=n.getInstance('presence_status'),t={},u={},v={},w={},x={},y={},z=Object.assign({},h),aa=r(function(){return z.inform('change');},0);Object.assign(z,{resetPresenceData:function(){u={};v={};y={};x={};},reset:function(){z.resetPresenceData();w={};},get:function(ba){if(ba==l.getID())return k.isOnline()?i.ACTIVE:i.OFFLINE;var ca=i.OFFLINE;if(ba in u)ca=u[ba];if(ca===i.OFFLINE||ca===i.IDLE)if(w[ba])ca=i.MOBILE;if(!o.allows(ba))ca=i.OFFLINE;return ca;},getCapabilities:function(ba){var ca=z.get(ba);if(ca==i.OFFLINE)return 0;var da=v[ba];return da?da:0;},isMobileUser:function(ba){return w[ba];},getGroup:function(ba){return ba.some(function(ca){if(ca==l.getID())return false;return z.get(ca)===i.ACTIVE;})?i.ACTIVE:i.OFFLINE;},set:function(ba,ca,da,ea,fa){if(ba==l.getID())return false;switch(ca){case i.OFFLINE:case i.IDLE:case i.ACTIVE:case i.MOBILE:break;default:return false;}var ga=z.get(ba),ha=ga!=ca;if(ha&&ga==i.ACTIVE||ca==i.ACTIVE){var ia={};ia[ba]=p.get()/1000;m.update(ia);}var ja=false;if(!ha&&fa)ja=z.getCapabilities(ba)!=fa;if(da){x[ba]=p.get();y[ba]=ea;}u[ba]=ca;if(fa)v[ba]=fa;var ka=ha||ja;if(ka)aa();return ka;},setMobileFriends:function(ba){w=q(ba);},getOnlineIDs:function(){var ba,ca=[];for(ba in u)if(z.get(ba)===i.ACTIVE)ca.push(ba);return ca;},getAvailableIDs:function(){var ba=z.getOnlineIDs(),ca;for(ca in w){if(u[ca])continue;ba.push(ca);}return ba;},getOnlineCount:function(){return z.getOnlineIDs().length;},getPresenceStats:function(){var ba=0,ca=0,da=0,ea=0,fa=0;for(var ga in u){ba+=1;switch(z.get(ga)){case i.OFFLINE:ca+=1;break;case i.IDLE:da+=1;break;case i.ACTIVE:ea+=1;break;case i.MOBILE:fa+=1;break;default:break;}}return {total:ba,offline:ca,idle:da,active:ea,mobile:fa};},getDebugInfo:function(ba){return {id:ba,presence:u[ba],overlaySource:y[ba],overlayTime:x[ba],mobile:w[ba]};},getAllDebugInfo:function(){return {presence:u,overlaySource:y,overlayTime:x,mobile:w};}});f.exports=z;},null);
__d('ComparePresence',['ChatproxyPresenceStatus','PresenceStatus','LastMobileActiveTimes','ChatproxyLastMobileActiveTimes','BanzaiODS'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m={compareCpWithPp:function(){var n=i.getAllDebugInfo(),o=h.getAllDebugInfo(),p=0,q=0,r=0;for(var s in o.presence){if(n.presence[s]!==o.presence[s]&&o.presence[s]!==0){p++;l.bumpEntityKey('diff_presence_data','diff');}else l.bumpEntityKey('diff_presence_data','same');if(i.getCapabilities(s)!==h.getCapabilities(s)){r++;l.bumpEntityKey('diff_capability','diff');}else l.bumpEntityKey('diff_capability','same');}this._compareLastActiveTime();},_compareLastActiveTime:function(){var n=j.getDebugData(),o=k.getDebugData(),p=0,q=0,r=0;for(var s in o)if(s in n){var t=Math.abs(o[s]-n[s]);p+=t;q++;var u=o[s]-n[s];r+=u;if(t>60){l.bumpEntityKey('diff_last_active_time','diff');}else l.bumpEntityKey('diff_last_active_time','same');}else l.bumpEntityKey('diff_last_active_time','diff');l.bumpEntityKey('diff_last_active_time','sum_diff',p);l.bumpEntityKey('diff_last_active_time','sum_diff_cp_pp',r);l.bumpEntityKey('diff_last_active_time','num_of_id',q);l.bumpEntityKey('diff_last_active_time','num_of_push');}};f.exports=m;},null);
__d('ChatproxyPresence',['Arbiter','AvailableListConstants','ChannelConstants','CurrentUser','ComparePresence','AvailableListInitialData','PresenceStatus','LastMobileActiveTimes','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();function q(r){'use strict';this.$ChatproxyPresence1=r;this.$ChatproxyPresence2=m.chatNotif;}q.prototype.subscribe=function(){'use strict';h.subscribe(j.getArbiterType('chatproxy-presence'),this.updatePresenceInfo.bind(this));h.subscribe(j.ON_INVALID_HISTORY,this.onFullReloadReceived.bind(this));};q.prototype.onFullReloadReceived=function(){'use strict';n.resetPresenceData();};q.prototype.getAvailableListConstant=function(r){'use strict';switch(r){case 0:case 3:return i.OFFLINE;case 1:return i.IDLE;case 2:return i.ACTIVE;}return undefined;};q.prototype.updatePresenceInfo=function(r,s){'use strict';var t={};s=s.obj;var u=s.buddyList;for(var v in u){if(v===k.getID()||v==='type')continue;var w=this.getAvailableListConstant(u[v].p),x=0;if(u[v].vc)x=u[v].vc;if(u[v].lat)t[v]=u[v].lat;if(w!==undefined||x!==undefined)if(m.gk_replace_available_list_chatproxy)n.set(v,w,false,'chatproxy',x);}var y=false;if(s.chatNotif!==undefined)y=this.$ChatproxyPresence2!==s.chatNotif;if(y)this.$ChatproxyPresence2=s.chatNotif;if(m.gk_replace_available_list_chatproxy){o.update(t);if(!!s.mobileFriends)n.setMobileFriends(s.mobileFriends);if(y)this.$ChatproxyPresence1(i.ON_CHAT_NOTIFICATION_CHANGED,this.$ChatproxyPresence2);p((function(){this.$ChatproxyPresence1(i.ON_AVAILABILITY_CHANGED);}).bind(this),0)();}};q.prototype.getIsUserIdle=function(){'use strict';return this.$ChatproxyPresence3;};q.prototype.getWebChatNotification=function(){'use strict';return this.$ChatproxyPresence2;};f.exports=q;},null);
__d('ChatConfig',['ChatConfigInitialData'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={},j={get:function(k,l){return k in i?i[k]:l;},set:function(k){if(arguments.length>1){var l={};l[k]=arguments[1];k=l;}Object.assign(i,k);},getDebugInfo:function(){return i;}};j.set(h);f.exports=j;},null);
__d('ChatContexts',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};function i(l){var m=l?l.subtext:'';return m;}function j(l,m){h[l]=m;}var k={get:function(l){if(l in h){return h[l];}else return null;},update:function(l){for(var m in l)j(m,l[m]);},getShortDisplay:function(l){return i(k.get(l));}};f.exports=k;},null);
__d('Poller',['ArbiterMixin','AsyncRequest','CurrentUser','emptyFunction','mixin','setTimeoutAcrossTransitions','setTimeout'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o,p;o=babelHelpers.inherits(q,l(h));p=o&&o.prototype;function q(t){'use strict';p.constructor.call(this);this._config=babelHelpers._extends({clearOnQuicklingEvents:true,setupRequest:k,interval:null,maxRequests:Infinity,dontStart:false},t);this._handle=null;if(!this._config.dontStart)this.start();}q.prototype.start=function(){'use strict';if(this._polling)return this;this._requests=0;this.request();return this;};q.prototype.stop=function(){'use strict';this._cancelRequest();return this;};q.prototype.mute=function(){'use strict';this._muted=true;return this;};q.prototype.resume=function(){'use strict';if(this._muted){this._muted=false;if(this._handle===null&&this._polling)return this.request();}return this;};q.prototype.skip=function(){'use strict';this._skip=true;return this;};q.prototype.reset=function(){'use strict';return this.stop().start();};q.prototype.request=function(){'use strict';this._cancelRequest();this._polling=true;if(!s())return this._done();if(this._muted)return this;if(++this._requests>this._config.maxRequests)return this._done();var t=new i();t.setIsBackgroundRequest(true);var u=false;t.setInitialHandler(function(){return !u;});this._cancelRequest=(function(){u=true;this._cleanup();}).bind(this);t.setFinallyHandler(r.bind(this));t.setInitialHandler=k;t.setFinallyHandler=k;this._config.setupRequest(t,this);if(this._skip){this._skip=false;m(r.bind(this),0);}else t.send();return this;};q.prototype.isPolling=function(){'use strict';return this._polling;};q.prototype.isMuted=function(){'use strict';return this._muted;};q.prototype.setInterval=function(t){'use strict';if(t){this._config.interval=t;this.start();}};q.prototype.getInterval=function(){'use strict';return this._config.interval;};q.prototype._cleanup=function(){'use strict';if(this._handle!==null)clearTimeout(this._handle);this._handle=null;this._cancelRequest=k;this._polling=false;};q.prototype._done=function(){'use strict';this._cleanup();this.inform('done',{sender:this});return this;};q.MIN_INTERVAL=2000;Object.assign(q.prototype,{_config:null,_requests:0,_muted:false,_polling:false,_skip:false,_cancelRequest:k});function r(){if(!this._polling)return;if(this._requests<this._config.maxRequests){var t=this._config.interval;t=typeof t==='function'?t(this._requests):t;t=t>q.MIN_INTERVAL?t:q.MIN_INTERVAL;if(this._config.clearOnQuicklingEvents){this._handle=n(this.request.bind(this),t);}else this._handle=m(this.request.bind(this),t);}else this._done();}function s(){return j.isLoggedInNow();}f.exports=q;},null);
__d('PresencePoller',['AvailableListConstants','AvailableListInitialData','BanzaiODS','ChannelConnection','ChatContexts','ChatVisibility','CurrentUser','JSLogger','LastMobileActiveTimes','Poller','PresencePrivacy','PresenceStatus','ServerTime','ShortProfiles','UserActivity','debounceAcrossTransitions','errorCode'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();var y=5,z='/ajax/chat/buddy_list.php',aa=1800000,ba=i.pollInterval,ca=i.lazyPollInterval,da=i.lazyThreshold,ea=o.create('available_list'),fa='presence_poller';j.setEntitySample(fa,.01);function ga(ha){'use strict';this.$PresencePoller1=ha;this.$PresencePoller2=false;this.$PresencePoller3=i.chatNotif;this.$PresencePoller4=false;this.$PresencePoller5=[];this.$PresencePoller6=new q({interval:ba,setupRequest:this.$PresencePoller7.bind(this),clearOnQuicklingEvents:false,dontStart:true});if(m.isOnline()){this.$PresencePoller8=Date.now();this.$PresencePoller9=Date.now();this.$PresencePoller10=Date.now();this.$PresencePoller11=i.updateTime;}else{this.$PresencePoller8=0;this.$PresencePoller11=0;this.$PresencePoller9=0;this.$PresencePoller10=0;}this.$PresencePoller12=0;this.$PresencePoller13('available_initial_data',i.updateTime,i.availableList,i.lastActiveTimes,i.mobileFriends,i.perpetuallyMobileBuddies);v.subscribe((function(ia,ja){if(ja.idleness>ba)this.forceUpdate();}).bind(this));r.subscribe('privacy-user-presence-changed',(function(){this.forceUpdate();}).bind(this));}ga.prototype.start=function(){'use strict';setTimeout(this.$PresencePoller6.start.bind(this.$PresencePoller6),0);};ga.prototype.restart=function(){'use strict';if(this.$PresencePoller6.isMuted()){this.$PresencePoller6.resume();this.forceUpdate();}};ga.prototype.stop=function(){'use strict';this.$PresencePoller6.mute();};ga.prototype.forceUpdate=function(){'use strict';this.$PresencePoller4=true;this.$PresencePoller6.request();};ga.prototype.getIsUserIdle=function(){'use strict';return this.$PresencePoller2;};ga.prototype.getWebChatNotification=function(){'use strict';return this.$PresencePoller3;};ga.prototype.getCallback=function(){'use strict';return this.$PresencePoller1;};ga.prototype.addExtraBuddy=function(ha){'use strict';if(this.$PresencePoller5.indexOf(ha)!==-1)return;this.$PresencePoller5.push(ha);};ga.prototype.$PresencePoller14=function(){'use strict';return w((function(){this.$PresencePoller1(h.ON_AVAILABILITY_CHANGED);}).bind(this),0)();};ga.prototype.$PresencePoller13=function(ha,ia,ja,ka,la,ma){'use strict';this.$PresencePoller11=ia;if(!i.gk_replace_available_list_chatproxy||Object.keys(ja).length!=0)if(!Array.isArray(ja)){s.resetPresenceData();for(var na in ja)s.set(na,ja[na].a,false,ha,ja[na].c);}if(ka&&!Array.isArray(ka))p.update(ka);if(la)s.setMobileFriends(la);if(ma)s.setPerpetuallyMobileBuddies(ma);this.$PresencePoller14();};ga.prototype.$PresencePoller7=function(ha){'use strict';if(k.isShutdown()||!m.isOnline()){this.$PresencePoller6.skip();j.bumpEntityKey(fa,'skip.offline');return;}if(Date.now()-this.$PresencePoller8<ba){this.$PresencePoller6.skip();j.bumpEntityKey(fa,'skip.recent');return;}j.bumpEntityKey(fa,'request');this.$PresencePoller8=Date.now();var ia=Date.now()-this.$PresencePoller10,ja=u.getCachedProfileIDs().join(","),ka=true;if(i.gk_replace_available_list_chatproxy&&!this.$PresencePoller4&&this.$PresencePoller5.length===0)ka=false;this.$PresencePoller4=false;ha.setHandler(this.$PresencePoller15.bind(this)).setErrorHandler(this.$PresencePoller16.bind(this)).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:n.getID(),cached_user_info_ids:ja,fetch_mobile:ia>aa,additional_buddies:this.$PresencePoller5,get_now_available_list:ka}).setURI(z).setAllowCrossPageTransition(true);};ga.prototype.$PresencePoller15=function(ha){'use strict';var ia=ha.getPayload(),ja=ia.buddy_list;if(!ja){this.$PresencePoller16(ha);return;}j.bumpEntityKey(fa,'response');this.$PresencePoller17();this.$PresencePoller9=Date.now();t.update(ia.time);if(ja.mobile_friends)this.$PresencePoller10=Date.now();this.$PresencePoller12=0;this.$PresencePoller18();var ka=ja.userInfos;if(ka)u.setMulti(ka);var la=ja.chatContexts;la&&l.update(la);this.$PresencePoller2=ja.userIsIdle;if(ja.chatNotif!==undefined&&ja.chatNotif!==this.$PresencePoller3){this.$PresencePoller3=ja.chatNotif;this.$PresencePoller1(h.ON_CHAT_NOTIFICATION_CHANGED,this.$PresencePoller3);}this.$PresencePoller13('buddy_list_poller',ia.time,ja.nowAvailableList,ja.last_active_times,ja.mobile_friends,ja.perpetually_mobile_buddies);};ga.prototype.$PresencePoller16=function(ha){'use strict';j.bumpEntityKey(fa,'error');if(ha.getError()==1356007)return;this.$PresencePoller12++;if(this.$PresencePoller12>=y)this.$PresencePoller1(h.ON_UPDATE_ERROR);};ga.prototype.$PresencePoller18=function(){'use strict';var ha=v.isActive(da)?ba:ca;j.bumpEntityKey(fa,'period.'+ha);this.$PresencePoller6.setInterval(ha);};ga.prototype.$PresencePoller17=function(){'use strict';var ha=Date.now(),ia=ha-this.$PresencePoller9;ea.log('buddylist_presence_stats',babelHelpers._extends({duration:ia},s.getPresenceStats()));};f.exports=ga;},null);
__d("TypingStates",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={INACTIVE:0,TYPING:1,QUITTING:2};f.exports=h;},null);
__d('AvailableList',['Arbiter','ArbiterMixin','AsyncRequest','AvailableListConstants','BanzaiODS','ChannelConnection','ChannelConstants','ChatConfig','ChatVisibility','ErrorUtils','JSLogger','LastMobileActiveTimes','PresencePoller','PresencePrivacy','PresenceStatus','ServerTime','ShortProfiles','TypingStates','debounceAcrossTransitions','emptyFunction','AvailableListInitialData','ChatproxyPresence','ChatproxyPresenceStatus','ChatproxyLastMobileActiveTimes','ChannelTransport','ChannelManager'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){'use strict';if(c.__markCompiled)c.__markCompiled();l.setEntitySample('presence',.0001);var ha=babelHelpers._extends({},k,i);ha.subscribe([k.ON_AVAILABILITY_CHANGED,k.ON_UPDATE_ERROR],function(sa,ta){h.inform(sa,ta);});var ia=z(function(){return ha.inform(k.ON_AVAILABILITY_CHANGED);},0);function ja(sa,ta,ua,va,wa){var xa=v.set(sa,ta,ua,va,wa);da.set(sa,ta,ua,va,wa);if(xa){var ya=z(function(){return ha.inform(k.ON_AVAILABILITY_CHANGED,sa);},0);ya();}}function ka(sa){var ta=sa.payload.availability||{};for(var ua in ta)ja(ua&&ua.toString(),ta[ua].a,true,'mercury_tabs',ta[ua].c,ta[ua].p);}function la(){if(!ba.gk_replace_available_list_chatproxy)pa&&pa.restart();}function ma(){if(!ba.gk_replace_available_list_chatproxy)pa&&pa.stop();}function na(sa){var ta=ha.getDebugInfo(sa),ua=ta.presence==k.ACTIVE;new j('/ajax/mercury/tabs_presence.php').setData({target_id:sa,to_online:ua,presence_source:ta.overlaySource,presence_time:ta.overlayTime}).setHandler(ka).setErrorHandler(aa).setAllowCrossPageTransition(true).send();}function oa(sa,ta){ta.chat_config=o.getDebugInfo();ta.available_list_debug_info={};v.getAvailableIDs().forEach(function(ua){ta.available_list_debug_info[ua]=ha.getDebugInfo(ua);});ta.available_list_poll_interval=ha._poller&&ha._poller.getInterval();}var pa=undefined,qa=undefined;if(ba.gk_replace_available_list_chatproxy){try{qa=new ca(function(event){ha.inform(event);});qa.subscribe();}catch(ra){q.reportError&&q.reportError(ra,false);}}else try{pa=new t(function(event){ha.inform(event);});}catch(ra){q.reportError&&q.reportError(ra,false);}Object.assign(ha,{getChatproxyPresenceObject:function(){return qa;},getPresencePollerObject:function(){return pa;},get:function(sa){return v.get(sa);},updateForID:function(sa){na(sa);if(ba.gk_replace_available_list_chatproxy){if(u.getVisibility()==u.ONLINE)fa.sendAdditionalBuddyRequest(ga.getCompleteConfig(),sa);}else pa&&pa.addExtraBuddy(sa);},getWebChatNotification:function(){if(ba.gk_replace_available_list_chatproxy){return qa&&qa.getWebChatNotification&&qa.getWebChatNotification();}else return pa&&pa.getWebChatNotification&&pa.getWebChatNotification();},isUserIdle:function(){if(!ba.gk_replace_available_list_chatproxy)return pa&&pa.getIsUserIdle();},isReady:function(){if(!ba.gk_replace_available_list_chatproxy)return !!pa;return !!qa;},set:function(sa,ta,ua,va){ja(sa,ta,true,ua,va);},update:function(){if(!ba.gk_replace_available_list_chatproxy)pa&&pa.forceUpdate();},isIdle:function(sa){return ha.get(sa)==k.IDLE;},getDebugInfo:function(sa){var ta=v.getDebugInfo(sa),ua=x.getNow(sa);if(ua)ta.name=ua.name;return ta;}});if(!ba.gk_replace_available_list_chatproxy)pa&&pa.start();h.subscribe(r.DUMP_EVENT,oa);h.subscribe('chat-visibility/go-online',la);h.subscribe('chat-visibility/go-offline',ma);u.subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],ia);m.subscribe([m.CONNECTED,m.RECONNECTING,m.SHUTDOWN,m.MUTE_WARNING,m.UNMUTE_WARNING],ia);h.subscribe(n.getArbiterType('buddylist_overlay'),function(sa,ta){var ua={},va=ta.obj.overlay;for(var wa in va){ha.set(wa,va[wa].a,va[wa].s||'channel',va[wa].vc);if(va[wa].la)ua[wa]=va[wa].la;}s.update(ua);ea.update(ua);});h.subscribe([n.getArbiterType('typ'),n.getArbiterType('ttyp')],function(sa,ta){var ua=ta.obj;if(ua.st===y.TYPING){var va=ua.from;if(p.isOnline()){l.bumpEntityKey('presence','stale_presence_check_typing');var wa=v.get(va);if(wa!=k.ACTIVE){var xa=s.get(va)*1000,ya=w.get();if(!xa){l.bumpEntityKey('presence','no_detailed_presence_typing');}else if(ya-xa>5*60*1000){var za='stale_presence_typing',ab=ya-xa;if(ab<10*60*1000){za+='600';}else if(ab<60*60*1000)za+='3600';l.bumpEntityKey('presence',za);}}}ha.set(va&&va.toString(),k.ACTIVE,'channel-typing');}});h.subscribe(n.getArbiterType('messaging'),function(sa,ta){if(!p.isOnline())return;var ua=ta.obj;if(ua.message&&ua.message.timestamp&&ua.message.sender_fbid){var va=w.get(),wa=ua.message.timestamp;if(va-wa<2*60*1000){l.bumpEntityKey('presence','stale_presence_check');var xa=ua.message.sender_fbid,ya=v.get(xa);if(ya==k.ACTIVE)return;var za=s.get(xa)*1000;if(!za){l.bumpEntityKey('presence','no_detailed_presence');}else if(wa-za>5*60*1000){var ab='stale_presence',bb=wa-za;if(bb<10*60*1000){ab+='600';}else if(bb<60*60*1000)ab+='3600';l.bumpEntityKey('presence',ab);}}}});b.AvailableList=f.exports=ha;},null);