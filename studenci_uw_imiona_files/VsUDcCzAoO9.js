/*!CK:3007959953!*//*1446063550,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["\/Mh7E"]); }

__d("XMessagingPhotoDownloadController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/attachments\/photo\/",{photo_id:{type:"String",required:true}});},null,{});
__d('SpotlightMessagesViewer',['ActorURI','ArbiterMixin','CurrentEnvironment','MercuryConfig','MessagingForwardAttachmentDialog.react','MessagingForwardingButtonNUX.react','MessengerForwardAttachmentDialog.react','PageTransitionsRegistrar','React','ReactLayeredComponentMixin','SpotlightViewer','SpotlightViewerAutoResize','SpotlightViewerBehaviorsMixin','SpotlightViewerBottomBar','SpotlightViewerBottomBarGroup','SpotlightViewerBottomBarLink','SpotlightViewerClose','SpotlightViewerCoreMixin','SpotlightViewerDimensionMixin','SpotlightViewerPagers','SpotlightViewerPageWithKeys','SpotlightViewerThumbnailMixin','SpotlightViewport','SubscriptionsHandler','XMessagingPhotoDownloadController','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){if(c.__markCompiled)c.__markCompiled();var ha=p.createClass({displayName:'SpotlightMessagesViewer',mixins:[i,q,t,y,ca,z],behaviors:[ba,s],componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;},getViewerID:function(){return this.props.setid;},getInitialState:function(){this._subscriptions=new ea();return {photoData:this._getInitialPhotoData(),open:true,showForward:false};},_enableSubscriptions:function(){this.props.useloadingindicator&&this._subscriptions.addSubscriptions(this.viewState.subscribe('photo_fetch',(function(){return this.setState({photoData:null});}).bind(this)));},_showForwardDialog:function(){this.setState({showForward:true});},_hideForwardDialog:function(){this.setState({showForward:false});},renderLayers:function(){if(!k.ForwardingEnabled||this.props.disableForward)return {};var ia=ga._("Forward in separate messages"),ja=j.messengerdotcom?n:l;return {forwardDialog:p.createElement(ja,{attachmentID:String(this.state.photoData.id),onClose:this._hideForwardDialog,shown:this.state.showForward,title:ia}),forwardButtonNUX:p.createElement(m,{contextRef:(function(){return this.refs.forwardButton;}).bind(this)},ga._("Send this image to other people in separate messages."))};},render:function(){var ia=this.getMedia(),ja=this.props.snapToPhoto?this.getImageDimensions():this.getStageDimensions(),ka=this.props.useloadingindicator&&!this.state.photoData;o.registerCompletionCallback((function(){if(this.state.open)this.close();return true;}).bind(this));return (p.createElement(r,{rootClassName:this.props.rootClassName,open:this.state.open,onHide:this.close},p.createElement(da,{active:false,onClick:this._onClickViewport,stageDimensions:ja,media:ia,showLoadingIndicator:ka},p.createElement(x,{onClick:this.close}),this.props.disablepaging?null:p.createElement(aa,null),this._renderBottomBar())));},_renderBottomBar:function(){var ia;if(k.ForwardingEnabled&&!this.props.disableForward)ia=p.createElement(w,{onClick:this._showForwardDialog,ref:'forwardButton'},ga._("Forward"));var ja=fa.getURIBuilder().setString('photo_id',String(this.state.photoData.id)).getURI();if(this.props.actorid)ja=h.create(ja,this.props.actorid);return (p.createElement(u,null,p.createElement(v,null),p.createElement(v,null,ia,p.createElement(w,{rel:'async',ajaxify:ja},ga._("Download")))));}});f.exports=ha;},null);