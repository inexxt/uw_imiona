/*!CK:1212666368!*//*1446444294,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["lHvXL"]); }

__d("ChatTypeaheadEvent",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ABANDONED_QUERY:"abandoned_query",NEW_QUERY:"new_query",RESULT_SELECTED:"result_selected"};},null,{});
__d("GenderConst",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NOT_A_PERSON:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11,UNKNOWN:0};},null,{});
__d("IrisProtocolMessageLifetime",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:30000,TTL_1MINUTE:60000,TTL_3MINUTES:180000,TTL_5MINUTES:300000,TTL_10MINUTES:600000,TTL_15MINUTES:900000,TTL_30MINUTES:1800000,TTL_1HOUR:3600000,TTL_2HOURS:7200000,TTL_4HOURS:14400000,TTL_8HOURS:28800000,TTL_12HOURS:43200000,TTL_24HOURS:86400000};},null,{});
__d("MercurySendMessageFields",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};},null,{});
__d("PhotoResizeModeConst",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CONTAIN:"s",COVER:"p"};},null,{});
__d("StickerConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MOBILE_LIKE_STICKER_PACK_ID:"227877430692340",GRAVEYARD_PACK_ID:"604597256247273",LIKE_STICKER_ID:"227878347358915",HOT_LIKE_SMALL_STICKER_ID:"369239263222822",HOT_LIKE_MEDIUM_STICKER_ID:"369239343222814",HOT_LIKE_LARGE_STICKER_ID:"369239383222810",MRU_STICKER_PACK:"599061016853145",SEARCH_PACK_ID:"680229632032514",SPRITE_PADDING:"24",PayloadSource:{VIEW_ACTION:"view-action"},EMOTICON_PACK_ID:"1471127876485636",DEFAULT_FRAME_RATE:83,TRAY_SIZE:64,THREAD_SIZE:120};},null,{});
__d('ChatImpressionLogger',['AsyncSignal','ChatConfig','ChatVisibility','immutable','Poller','PresencePrivacy','PresenceStatus','requireWeak','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=null;o('AvailableList',function(w){return q=w;});var r=null;function s(){if(!r)return '';return k.List(r.getSortedList()).toArray().toString();}function t(){if(!r||!q)return '';var w=[],x=k.List(r.getSortedList()).toArray();for(var y=0;y<x.length;y++)w[y]=q.get(x[y]);return w.toString();}function u(w){w.setURI('/ajax/chat/imps_logging.php').setData({list_availability:t(),sorted_list:s(),source:'periodical_imps'});}var v={init:function(w){r=w;var x=i.get('chat_impression_logging_periodical',0);if(x){var y=i.get('periodical_impression_logging_config.interval'),z=new l({interval:y,setupRequest:u,clearOnQuicklingEvents:false,dontStart:true});m.subscribe('privacy-user-presence-changed',p(function(){if(j.isOnline()){z.start();}else z.stop();}));}this.init=function(){};},logImpression:function(w,x,y){var z=i.get('chat_impression_logging_with_click'),aa={list_availability:z?t():'',sorted_list:z?s():'',source:w,target:x,target_presence:n.get(x),viewport_width:document.body.clientWidth};new h('/ajax/chat/ct.php',Object.assign(aa,y)).send();}};f.exports=v;},null);
__d('ChatOpenTabEventLogger',['Banzai','ChatImpressionLogger','MercuryIDs'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k='messaging_tracking',l={log:function(m,n,o,p){var q={referrer:m||'',message_thread_id:n,message_view:'chat',timestamp_send:Date.now(),message_target_ids:null};if(o!==undefined)q.message_target_ids=[o];i.logImpression(m,o,p);h.post(k,q,{delay:0,retry:true});var r=j.getUserIDFromThreadID(String(n));h.post('page_message_button_click',{page_id:r,ref:m});}};f.exports=l;},null);
__d('ChatWelcomeMessage',['ImmutableObject'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(){this.$ChatWelcomeMessage1={};}i.prototype.setWelcomeMessage=function(k,l,m){this.$ChatWelcomeMessage1[k]=new h({timestamp:Date.now(),thread_id:k,author:l,body:m});};i.prototype.getWelcomeMessage=function(k){return this.$ChatWelcomeMessage1[k];};var j=new i();f.exports=j;},null);
__d('ImageSourceType',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};f.exports=h;},null);
__d('ImageSourceRequest',['CurrentUser','ImageSourceType','KeyedCallbackManager','PhotoResizeModeConst','MercuryServerDispatcher','arrayContains'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();function n(){'use strict';this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}n.prototype.setFBID=function(r){'use strict';this._request.fbid=r;return this;};n.prototype.setType=function(r){'use strict';if(!m([i.PROFILE_PICTURE,i.IMAGE],r))throw new TypeError('ImageSourceRequest.setType: invalid type '+r);this._request.type=r;return this;};n.prototype.setDimensions=function(r,s){'use strict';this._request.width=r;this._request.height=s;return this;};n.prototype.setResizeMode=function(r){'use strict';if(!m([k.COVER,k.CONTAIN],r))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+r);this._request.resize_mode=r;return this;};n.prototype.setCallback=function(r){'use strict';this._callback=r;return this;};n.prototype.send=function(){'use strict';if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var r=p(),s=q(this._request);r.executeOrEnqueue(s,this._callback);if(r.getUnavailableResourcesFromRequest(s).length===1){l.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var o=null;function p(){if(o)return o;var r=new j();o=r;l.registerEndpoints({'/ajax/image_source.php':{request_user_id:h.getID(),mode:l.BATCH_DEFERRED_MULTI,batch_function:function(s,t){var u;(u=s.requests).push.apply(u,t.requests);return s;},handler:function(s,t){var u=t.getData().requests;for(var v=0;v<u.length;++v)r.setResource(q(u[v]),s[v]);}}});return r;}function q(r){return [r.fbid,r.type,r.width,r.height,r.resize_mode].join('|');}f.exports=n;},null);
__d('MercuryParticipantFetcher',['LogHistory','MercuryIDs','MercuryPayloadSource','MercuryServerPayloadPreprocessor','Set','ShortProfiles','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=h.getInstance('short_profiles');function p(r){this.$MercuryParticipantFetcher1=k.getForFBID(r);this.$MercuryParticipantFetcher2=false;this.$MercuryParticipantFetcher3=new l();this.$MercuryParticipantFetcher4=new l();}p.prototype.fetch=function(r){this.$MercuryParticipantFetcher5(r);this.$MercuryParticipantFetcher6();};p.prototype.fetchMulti=function(r){r.forEach((function(s){return this.$MercuryParticipantFetcher5(s);}).bind(this));this.$MercuryParticipantFetcher6();};p.prototype.$MercuryParticipantFetcher5=function(r){if(!this.$MercuryParticipantFetcher4.has(r))this.$MercuryParticipantFetcher3.add(r);};p.prototype.$MercuryParticipantFetcher6=function(){if(this.$MercuryParticipantFetcher2||this.$MercuryParticipantFetcher3.size===0)return;this.$MercuryParticipantFetcher2=true;n((function(){this.$MercuryParticipantFetcher2=false;this.$MercuryParticipantFetcher3.forEach((function(r){return this.$MercuryParticipantFetcher4.add(r);}).bind(this));this.$MercuryParticipantFetcher7(this.$MercuryParticipantFetcher3,(function(r){r.forEach((function(s){return this.$MercuryParticipantFetcher4['delete'](s.id);}).bind(this));this.$MercuryParticipantFetcher8(r);}).bind(this));this.$MercuryParticipantFetcher3.clear();}).bind(this));};p.prototype.$MercuryParticipantFetcher7=function(r,s){var t=[];r.forEach(function(u){var v=i.tokenize(u),w=v.type,x=v.value;w==='fbid'&&t.push(x);});if(t.length>0){m.getMulti(t,function(u){var v=[];for(var w in u)v.push(q(u[w],w));s(v);if(v.length!==t.length)o.error('server_fetch_participant_count_error',{expectedIDs:t,receivedIDs:Object.keys(u)});});o.debug('client_fetch_participants',{userIDs:t});}};p.prototype.$MercuryParticipantFetcher8=function(r){this.$MercuryParticipantFetcher1.handleUpdate({participants:r,from_client:false,payload_source:j.SERVER_FETCH_PARTICIPANTS});};function q(r,s){var t=babelHelpers._extends({gender:r.gender,fbid:r.id||s,href:r.uri,id:i.getParticipantIDFromUserID(r.id||s),image_src:r.thumbSrc,name:r.name,short_name:r.firstName,employee:r.employee,is_employee_away:r.is_employee_away,type:r.type,vanity:r.vanity,is_friend:r.is_friend,is_messenger_user:r.is_messenger_user,social_snippets:r.social_snippets},{});if(r.officeStatus){t.officeStatus=r.officeStatus;t.officeStatusStartDate=r.officeStatusStartDate;t.officeStatusEndDate=r.officeStatusEndDate;t.officeStatusComment=r.officeStatusComment;t.officeStatusLocation=r.officeStatusLocation;}return t;}f.exports=p;},null);
__d('MercuryVanityIDMap',['Map','MercuryAssert'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=new h(),k=new h(),l={getID:function(m){return j.get(m);},getVanity:function(m){return k.get(m);},hasID:function(m){return k.has(m);},hasVanity:function(m){return j.has(m);},set:function(m,n){i.isParticipantID(n);j.set(m,n);k.set(n,m);}};f.exports=l;},null);
__d('MercuryParticipants',['CurrentUser','EventEmitter','ImageSourceRequest','ImageSourceType','ImmutableObject','KeyedCallbackManager','MercuryAssert','MercuryIDs','MercuryParticipantFetcher','MercuryParticipantTypes','MercuryParticipantsConstants','MercuryDispatcher','MercuryVanityIDMap','PhotoResizeModeConst','Set','createObjectFrom','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){'use strict';if(c.__markCompiled)c.__markCompiled();var y='change';function z(ba){this.$MercuryParticipants1=ba;this.$MercuryParticipants2=new i();this.$MercuryParticipants3=new m();this.$MercuryParticipants4=new p(this.$MercuryParticipants1);this.$MercuryParticipants5=s.getForFBID(this.$MercuryParticipants1);this.$MercuryParticipants5.subscribe('update-participants',(function(ca,da){if(da.participants&&da.participants.length>0)this.$MercuryParticipants6(da.participants);}).bind(this));}z.prototype.addListener=function(ba,ca){return this.$MercuryParticipants2.addListener(ba,ca);};z.prototype.getIDFromVanityOrFBID=function(ba){if(!ba)return null;if(t.hasVanity(ba))return t.getID(ba);if(/^\d+$/.test(ba))return o.getParticipantIDFromUserID(ba);};z.prototype.getNow=function(ba){return this.$MercuryParticipants7(ba);};z.prototype.getOrFetch=function(ba){var ca=this.$MercuryParticipants7(ba);if(!ca)this.$MercuryParticipants4.fetch(ba);return ca;};z.prototype.get=function(ba,ca){n.isParticipantID(ba);return this.$MercuryParticipants8([ba],function(da){ca(da[ba]);});};z.prototype.getMulti=function(ba,ca){return this.$MercuryParticipants8(ba,ca);};z.prototype.getBigImageMulti=function(ba,ca){n.allParticipantIDs(ba);var da=r.BIG_IMAGE_SIZE;return this.$MercuryParticipants8(ba,(function(ea){var fa={},ga=0,ha=new v(),ia=(function(ma,na){ga++;fa[ma]=na;if(ga===ba.length){ca(fa);if(ha.size>0)this.$MercuryParticipants9(ha);}}).bind(this),ja=(function(ma,na){this.$MercuryParticipants3.setResource(ma,l.set(this.$MercuryParticipants3.getResource(ma),{big_image_src:na.uri}));ha.add(ma);ia(ma,na.uri);}).bind(this);for(var ka in ea){var la=ea[ka];if(!la.big_image_src){new j().setFBID(o.getUserIDFromParticipantID(ka)).setType(k.PROFILE_PICTURE).setDimensions(da,da).setResizeMode(u.COVER).setCallback(ja.bind(null,ka)).send();}else ia(la.id,la.big_image_src);}}).bind(this));};z.prototype.getOrderedBigImageMulti=function(ba,ca){return this.getBigImageMulti(ba,function(da){ca(ba.map(function(ea){return da[ea];}));});};z.prototype.$MercuryParticipants8=function(ba,ca){n.allParticipantIDs(ba);var da=this.$MercuryParticipants3.executeOrEnqueue(ba,ca),ea=this.$MercuryParticipants3.getUnavailableResources(da).filter((function(fa){var ga=o.tokenize(fa),ha=ga.type,ia=ga.value;if(ha==='email'){this.$MercuryParticipants10(fa,ia);return false;}if(ha==='name'){this.$MercuryParticipants11(fa,ia);return false;}return true;}).bind(this));this.$MercuryParticipants4.fetchMulti(ea);return this.$MercuryParticipants12(da);};z.prototype.$MercuryParticipants7=function(ba){var ca=this.$MercuryParticipants3.getResource(ba);if(!ca){var da=o.tokenize(ba),ea=da.type,fa=da.value;if(ea==='email')ca=this.$MercuryParticipants10(ba,fa);if(ea==='name')ca=this.$MercuryParticipants11(ba,fa);}return ca;};z.prototype.$MercuryParticipants10=function(ba,ca){var da=new l(aa(ba,ca));this.$MercuryParticipants3.setResource(ba,da);return da;};z.prototype.$MercuryParticipants11=function(ba,ca){var da=new l({gender:r.UNKNOWN_GENDER,href:null,id:ba,image_src:r.EMAIL_IMAGE,big_image_src:r.EMAIL_IMAGE,name:ca,short_name:ca,employee:false});this.$MercuryParticipants3.setResource(ba,da);return da;};z.prototype.$MercuryParticipants9=function(ba){this.$MercuryParticipants2.emit(y,ba);};z.prototype.$MercuryParticipants6=function(ba){var ca=ba.map(function(da){return da.id;});ba=ba.map((function(da){if(da.vanity)t.set(da.vanity,da.id);var ea=this.$MercuryParticipants3.getResource(da.id);return ea?l.set(ea,da):new l(this.$MercuryParticipants13(da));}).bind(this));this.$MercuryParticipants3.addResourcesAndExecute(w(ca,ba));this.$MercuryParticipants9(new v(ca));};z.prototype.$MercuryParticipants13=function(ba){var ca=ba.type===q.USER||ba.type===q.FRIEND;if(!ca)return ba;if(!ba.name&&!ba.href&&!ba.vanity){var da=x._("Facebook User");ba.name=da;ba.short_name=da;}return ba;};z.prototype.$MercuryParticipants12=function(ba){return {remove:(function(){this.$MercuryParticipants3.unsubscribe(ba);}).bind(this)};};function aa(ba,ca){return {gender:r.UNKNOWN_GENDER,href:null,id:ba,image_src:r.EMAIL_IMAGE,big_image_src:r.EMAIL_IMAGE,name:ca,short_name:ca,employee:false};}f.exports=new z(h.getID());},null);
__d('GroupChatMessageBlockAlert',['DialogX','GenderConst','MercuryParticipants','React','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react','XUIDialogTitle.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q={show:function(r,s,t){var u=new h({width:445},k.createElement('div',null,k.createElement(o,null,p._("See Conversations?")),k.createElement(l,null,this.dialogBodyText(r)),k.createElement(n,null,k.createElement(m,{action:'cancel',label:this.leaveGroupButton(),onClick:function(){return t();}}),k.createElement(m,{use:'confirm',action:'cancel',label:this.openChatButton(),onClick:function(){return s();}}))));u.show();},openChatButton:function(){return p._("See Conversation");},leaveGroupButton:function(){return p._("Leave Group");},dialogBodyText:function(r){if(r.length!==1){return p._("People you've blocked are in this conversation. If you can see this conversation, you'll receive each other's messages to the group.");}else{var s='';j.get(r.pop(),function(t){switch(t.gender){case i.FEMALE_SINGULAR:s=p._("{name} is in this group conversation, but you've blocked her. If you can see this conversation, you'll see her messages to the group and she'll see yours.",[p.param('name',t.short_name)]);break;case i.MALE_SINGULAR:s=p._("{name} is in this group conversation, but you've blocked him. If you can see this conversation, you'll see his messages to the group and he'll see yours.",[p.param('name',t.short_name)]);break;default:s=p._("{name} is in this group conversation, but you've blocked them. If you can see this conversation, you'll see their messages to the group and they'll see yours.",[p.param('name',t.short_name)]);}});return s;}}};f.exports=q;},null);
__d('MercuryBlockedParticipants',['MercuryIDs','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','Set'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();m.getForFBID=function(o){return n.getForFBID(o);};m.get=function(){return n.get();};function m(o){this.$MercuryBlockedParticipants1=o;this.$MercuryBlockedParticipants2=new l();this.$MercuryBlockedParticipants3=j.getForFBID(this.$MercuryBlockedParticipants1);this.$MercuryBlockedParticipants3.subscribe('update-blocked-users',(function(p,q){if(q.message_blocked_ids)this.$MercuryBlockedParticipants2=new l(q.message_blocked_ids);var r=q.actions||q.global_actions;for(var s=r,t=Array.isArray(s),u=0,s=t?s:s[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var v;if(t){if(u>=s.length)break;v=s[u++];}else{u=s.next();if(u.done)break;v=u.value;}var w=v;if(w.action_type!==i.UPDATE_BLOCKER_STATUS)continue;if(w.message_blocked){this.$MercuryBlockedParticipants4(w.thread_fbid);}else this.$MercuryBlockedParticipants5(w.thread_fbid);}}).bind(this));}m.prototype.getFBID=function(){return this.$MercuryBlockedParticipants1;};m.prototype.setIDs=function(o){this.$MercuryBlockedParticipants2=o;};m.prototype.getIDs=function(){return this.$MercuryBlockedParticipants6();};m.prototype.$MercuryBlockedParticipants6=function(){return this.$MercuryBlockedParticipants2;};m.prototype.$MercuryBlockedParticipants4=function(o){this.$MercuryBlockedParticipants2.add(h.getParticipantIDFromUserID(o));};m.prototype.$MercuryBlockedParticipants5=function(o){this.$MercuryBlockedParticipants2['delete'](h.getParticipantIDFromUserID(o));};m.prototype.isMessageBlocked=function(o){if(!o.is_canonical)return false;var p=o.participants.filter((function(q){return q!=h.getParticipantIDFromUserID(this.getFBID());}).bind(this));return !p.every((function(q){return !this.$MercuryBlockedParticipants2.has(q);}).bind(this));};m.prototype.isPresentInGroupThread=function(o){if(!o.is_canonical&&this.$MercuryBlockedParticipants7(o).length>0)return true;return false;};m.prototype.inGroupThread=function(o){if(o.is_canonical)return [];return this.$MercuryBlockedParticipants7(o);};m.prototype.$MercuryBlockedParticipants7=function(o){var p=o.participants.filter((function(r){return r!=h.getParticipantIDFromUserID(this.getFBID());}).bind(this)),q=p.filter((function(r){return this.$MercuryBlockedParticipants2.has(r)!==false;}).bind(this));return q;};var n=new k(m);f.exports=m;},null);
__d('MercuryLocalIDs',['PresenceUtil','randomInt'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j={generateMessageID:function(l){var m=l||Date.now(),n=i(0,4294967295),o=h.getSessionID();return '<'+m+':'+n+'-'+o+'@mail.projektitan.com>';},generateThreadID:function(l){return 'root:'+j.generateOfflineThreadingID(l);},generateOfflineThreadingID:function(l){var m=l||Date.now(),n=i(0,4294967295),o=('0000000000000000000000'+n.toString(2)).slice(-22),p=m.toString(2)+o;return k(p);}};function k(l){var m='';while(l!='0'){var n=0,o='';for(var p=0;p<l.length;p++){n=2*n+parseInt(l[p],10);if(n>=10){o+='1';n-=10;}else o+='0';}m=n.toString()+m;l=o.slice(o.indexOf('1'));}return m;}f.exports=j;},null);
__d('MercuryMessageObject',['BanzaiODS','MercuryActionStatus','MercuryActionType','MercuryIDs','MercuryLocalIDs','MercuryMessageClientState','MercuryMessageSourceTags','MercurySingletonProvider','MercurySourceType','MercuryThreads','MercuryTimePassed','MercurySendMessageFields','fbt','formatDate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();v.getForFBID=function(z){'use strict';return y.getForFBID(z);};v.get=function(){'use strict';return y.get();};function v(z){'use strict';this.$MercuryMessageObject1=z;this.$MercuryMessageObject2=q.getForFBID(z);}v.prototype.constructUserGeneratedMessageObject=function(z,aa,ba,ca,da){'use strict';var ea=w(this.$MercuryMessageObject1,j.USER_GENERATED_MESSAGE,aa,ba);if(typeof z=='string')z=z.replace(/^\s+/,'').replace(/\s+$/,'');ea.body=z;ea.has_attachment=false;ea.html_body=false;ea.attachments=[];ea.specific_to_list=ca||[];ea.creator_info=da;return ea;};v.prototype.constructStickerMessageObject=function(z,aa,ba){'use strict';var ca=w(this.$MercuryMessageObject1,j.USER_GENERATED_MESSAGE,aa,ba);ca.has_attachment=true;ca.html_body=false;ca.attachments=[];ca.sticker_id=z;ca.specific_to_list=[];return ca;};v.prototype.constructAttachmentMessageObject=function(z,aa){'use strict';var ba=w(this.$MercuryMessageObject1,j.USER_GENERATED_MESSAGE,z,aa);ba.attachments=[];ba.specific_to_list=[];return ba;};v.prototype.constructLogMessageObject=function(z,aa,ba,ca){'use strict';var da=w(this.$MercuryMessageObject1,j.LOG_MESSAGE,z,aa);da.log_message_type=ba;da.log_message_data=ca;if(ca&&ca.untypedData&&ca.untypedData.ttl)da.ephemeral_ttl_mode=ca.untypedData.ttl;return da;};v.prototype.normalizeNewMessage=function(z){'use strict';if(z.status===undefined)z.status=i.UNSENT;z.timestamp_absolute=t._("Today").toString();z.offline_threading_id=z.offline_threading_id||l.generateOfflineThreadingID(z.timestamp);if(!z.offline_threading_id)h.bumpEntityKey('chat.web','invalid_otid_generated');z.message_id=z.message_id||z.offline_threading_id;var aa=k.getParticipantIDFromUserID(this.$MercuryMessageObject1);z.specific_to_list=z.specific_to_list||[];if(z.specific_to_list.length&&z.specific_to_list.indexOf(aa)===-1)z.specific_to_list.push(aa);if(!z.thread_id){z.thread_id='root:'+z.offline_threading_id;}else{var ba=this.$MercuryMessageObject2.getThreadMetaNow(z.thread_id);if(ba&&ba.ephemeral_ttl_mode!==null&&z.ephemeral_ttl_mode===undefined)z.ephemeral_ttl_mode=ba.ephemeral_ttl_mode;}if(z.specific_to_list.length==1){z.thread_id='user:'+this.$MercuryMessageObject1;}else if(z.specific_to_list.length==2){var ca=z.specific_to_list[0]==aa?z.specific_to_list[1]:z.specific_to_list[0];z.thread_id=k.getThreadIDFromParticipantID(ca);}if(!z.specific_to_list.length){var da=k.tokenize(z.thread_id),ea=da.type,fa=da.value;if(ea=='user')z.specific_to_list=['fbid:'+fa,aa];}if(!z[s.MANUAL_RETRY_CNT])z[s.MANUAL_RETRY_CNT]=0;};v.prototype.normalizeResendMessage=function(z){'use strict';z.status=i.RESENDING;z.timestamp=Date.now();z[s.MANUAL_RETRY_CNT]+=1;};v.prototype.normalizeAddAttachmentPlaceholder=function(z,aa,ba){'use strict';if(ba.preview_attachments.length>0){z.has_attachment=true;z.preview_attachments=ba.preview_attachments;}z.client_state=m.DO_NOT_SEND_TO_SERVER;z.status=i.RESENDING;z.upload_id=aa;};function w(z,aa,ba,ca){var da=x(ba)?[n.CHAT]:[],ea=Date.now(),fa=u(new Date(ea),'g:ia'),ga={action_type:aa,thread_id:ca,author:k.getParticipantIDFromUserID(z),author_email:null,timestamp:ea,timestamp_absolute:new Date(ea).toLocaleDateString(),timestamp_relative:fa,timestamp_time_passed:r.TODAY,is_unread:false,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,is_spoof_warning:false,source:ba,source_tags:da};return ga;}function x(z){switch(z){case p.CHAT_WEB:case p.CHAT_JABBER:case p.CHAT_IPHONE:case p.CHAT_MEEBO:case p.CHAT_ORCA:case p.CHAT_TEST:case p.CHAT:case p.DESKTOP:return true;default:return false;}}var y=new o(v);f.exports=v;},null);
__d('MercuryMessageActions',['MercuryActionType','MercuryDispatcher','MercuryMessageObject','MercuryPayloadSource','MercuryServerRequests','MercurySingletonMixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();function n(o){this.$MercuryMessageActions1=o;this.$MercuryMessageActions2=j.getForFBID(this.$MercuryMessageActions1);this.__serverRequests=l.getForFBID(this.$MercuryMessageActions1);this.__dispatcher=i.getForFBID(this.$MercuryMessageActions1);}n.prototype.send=function(o,p,q){p=p||Function.prototype;this.$MercuryMessageActions2.normalizeNewMessage(o);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers._extends({},o),k.CLIENT_SEND_MESSAGE));this.__serverRequests.sendNewMessage(o,q);p(o.thread_id);};n.prototype.resend=function(o,p){var q=babelHelpers._extends({},o);this.$MercuryMessageActions2.normalizeResendMessage(q);this.send(q,undefined,p);};n.prototype.addAttachmentPlaceholder=function(o,p,q){this.$MercuryMessageActions2.normalizeAddAttachmentPlaceholder(o,p,q);this.$MercuryMessageActions2.normalizeNewMessage(o);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers._extends({},o),k.CLIENT_SEND_MESSAGE));};n.prototype.cancelAttachmentPlaceholder=function(o,p){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:o,upload_data:p,action_type:h.CANCEL_ATTACHMENT_PLACEHOLDER},k.CLIENT_SEND_MESSAGE));};n.prototype.confirmAttachmentPlaceholder=function(o,p){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:o,upload_data:p,action_type:h.CONFIRM_ATTACHMENT_PLACEHOLDER},k.CLIENT_SEND_MESSAGE));};n.prototype['delete']=function(o,p,q){this.__dispatcher.handleUpdate(this.$MercuryMessageActions3(o,p,h.DELETE_MESSAGES,q||k.CLIENT_DELETE_MESSAGES));};n.prototype.__constructClientSingleMessagePayload=function(o,p){return {actions:[o],from_client:true,payload_source:p};};n.prototype.$MercuryMessageActions4=function(o,p){return {actions:[o],from_client:false,payload_source:p};};n.prototype.$MercuryMessageActions3=function(o,p,q,r){return {actions:[{action_type:q,action_id:null,thread_id:o,message_ids:p}],from_client:true,payload_source:r};};Object.assign(n,m);f.exports=n;},null);
__d('MercuryViewer',['CurrentUser','MercuryAssert'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j='fbid:'+h.getID(),k={getID:function(){return j;},isViewer:function(l){i.isParticipantID(l);return l===j;}};f.exports=k;},null);
__d("XNFXMessengerBlockActionController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/nfx\/block_messages\/",{thread_fbid:{type:"Int",required:true},av:{type:"Int"},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}});},null,{});
__d("XMessengerNotificationsSettingsDialogController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/notifications\/settings\/dialog\/",{thread_key_id:{type:"String",required:true},modify:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}});},null,{});
__d('MercuryThreadActions',['AsyncDialog','AsyncRequest','IrisProtocolMessageLifetime','MercuryActionType','MercuryAPIArgsSource','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryPayloadSource','MercuryServerRequests','MercurySingletonMixin','MercurySourceType','MercuryViewer','MessagingTag','XNFXMessengerBlockActionController','URI','MercuryAssert','XMessengerNotificationsSettingsDialogController','MercuryMessageActions','MercuryMessageObject','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){'use strict';if(c.__markCompiled)c.__markCompiled();var aa=c('MercuryMessageActions').get(),ba=c('MercuryMessageObject').get(),ca=c('MercuryThreads').get();function da(ea){this.$MercuryThreadActions1=ea;this.__serverRequests=r.getForFBID(this.$MercuryThreadActions1);this.__dispatcher=m.getForFBID(this.$MercuryThreadActions1);}da.prototype.markRead=function(ea,fa){this.batchMarkRead([ea],fa);};da.prototype.batchMarkRead=function(ea,fa){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(ea,true,fa));};da.prototype.markUnread=function(ea,fa){this.batchMarkUnread([ea],fa);};da.prototype.batchMarkUnread=function(ea,fa){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(ea,false,fa));};da.prototype.markSeen=function(ea,fa){this.__dispatcher.handleUpdate(this.__constructClientPayload([ea],k.MARK_THREAD_SEEN,q.CLIENT_MARK_THREAD_SEEN,{persistent:fa}));};da.prototype.archive=function(ea,fa){this.batchArchive([ea],fa);};da.prototype.batchArchive=function(ea,fa){ea.forEach((function(ga){this.__serverRequests.changeThreadArchivedStatus(ga,true,fa);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(ea,true));};da.prototype.unarchive=function(ea,fa){this.batchUnarchive([ea],fa);};da.prototype.batchUnarchive=function(ea,fa){ea.forEach((function(ga){this.__serverRequests.changeThreadArchivedStatus(ga,false,fa);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(ea,false));};da.prototype.markSpam=function(ea,fa){this.batchMarkSpam([ea],fa);};da.prototype.batchMarkSpam=function(ea,fa){ea.forEach((function(ga){this.__serverRequests.markThreadSpam(ga,fa);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(ea,v.SPAM));};da.prototype.unmarkSpam=function(ea,fa){this.batchUnmarkSpam([ea],fa);};da.prototype.batchUnmarkSpam=function(ea,fa){ea.forEach((function(ga){this.__serverRequests.unmarkThreadSpam(ga,fa);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(ea,v.INBOX));};da.prototype.changeFolder=function(ea,fa){this.batchChangeFolder([ea],fa);};da.prototype.batchChangeFolder=function(ea,fa){ea.forEach((function(ga){this.__serverRequests.changeThreadFolder(ga,fa);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(ea,fa));};da.prototype['delete']=function(ea,fa){this.batchDelete([ea],fa);};da.prototype.batchDelete=function(ea,fa){ea.forEach((function(ga){this.__serverRequests.deleteThread(ga,fa);}).bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(ea,k.DELETE_THREAD,q.CLIENT_DELETE_THREAD));};da.prototype.openNotificationSettings=function(ea){y.isThreadID(ea);this.__serverRequests.__threadIDMap.getServerIDFromClientID(ea,function(fa){var ga=z.getURIBuilder().setString('thread_key_id',fa).setBool('modify',false).getURI();new i().setURI(ga).send();});};da.prototype.unmute=function(ea){this.updateMuteSetting(ea,0);};da.prototype.updateMuteSetting=function(ea,fa){this.__serverRequests.changeMutingOnThread(ea,fa);this.__dispatcher.handleUpdate(this.__constructClientPayload([ea],k.CHANGE_MUTE_SETTINGS,q.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:fa}));};da.prototype.blockMessages=function(ea){var fa=w.getURIBuilder().setInt('thread_fbid',n.getUserIDFromThreadID(ea)).setEnum('location','www_chat_head').getURI();h.send(new i(fa));};da.prototype.unblockMessages=function(ea){var fa=JSON.stringify({reportable_ent_token:n.getUserIDFromThreadID(ea),initial_action_name:p.block_messages});new i(new x('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:fa})).send();};da.prototype.turnOffSecretMode=function(ea){if(ca.isEmptyLocalThread(ea))return;aa.send(ba.constructLogMessageObject(t.TITAN_WEB,ea,o.GENERIC_ADMIN_TEXT,{untypedData:{ttl:j.TTL_OFF}}),null,l.WEBMESSENGER);};da.prototype.turnOnSecretMode=function(ea){if(ca.isEmptyLocalThread(ea))return;aa.send(ba.constructLogMessageObject(t.TITAN_WEB,ea,o.GENERIC_ADMIN_TEXT,{untypedData:{ttl:j.TTL_1HOUR}}),null,l.WEBMESSENGER);};da.prototype.leaveGroup=function(ea){if(!ca.isEmptyLocalThread(ea))aa.send(ba.constructLogMessageObject(t.TITAN_WEB,ea,o.UNSUBSCRIBE,{removed_participants:[u.getID()]}),null,l.WEBMESSENGER);};da.prototype.addParticipants=function(ea,fa){this.__dispatcher.handleUpdate(this.__constructClientPayload([ea],k.ADD_PARTICIPANTS,q.CLIENT_ADD_PARTICIPANTS,{participants:fa}));};da.prototype.unpinThread=function(ea){this.__serverRequests.unpinThread(ea);this.__dispatcher.handleUpdate(this.__constructClientPayload([ea],k.UNPIN_THREAD,q.CLIENT_UNPIN_THREAD));};da.prototype.movePendingToInbox=function(ea){this.__dispatcher.handleUpdate(this.__constructClientPayload([ea],k.MOVE_PENDING_TO_INBOX,q.CLIENT_MOVE_PENDING_TO_INBOX));};da.prototype.updateSnippet=function(ea,fa){this.__dispatcher.handleUpdate(this.__constructClientPayload([ea],k.UPDATE_SNIPPET,q.CLIENT_UPDATE_SNIPPET,{deleted_ids:fa}));};da.prototype.$MercuryThreadActions2=function(ea,fa,ga){return this.__constructClientPayload(ea,k.CHANGE_READ_STATUS,q.CLIENT_CHANGE_READ_STATUS,{mark_as_read:fa,source:ga});};da.prototype.$MercuryThreadActions3=function(ea,fa){return this.__constructClientPayload(ea,k.CHANGE_ARCHIVED_STATUS,q.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:fa});};da.prototype.$MercuryThreadActions4=function(ea,fa){return this.__constructClientPayload(ea,k.CHANGE_FOLDER,q.CLIENT_CHANGE_FOLDER,{new_folder:fa});};da.prototype.__constructClientPayload=function(ea,fa,ga,ha){return {actions:ea.map(function(ia){return babelHelpers._extends({action_type:fa,action_id:null,thread_id:ia},ha);}),from_client:true,payload_source:ga};};Object.assign(da,s);f.exports=da;},null);
__d('ChatOpenTabImpl',['ChatApp','ChatOpenTabEventLogger','ChatWelcomeMessage','DOM','GroupChatMessageBlockAlert','LogHistory','MercuryIDs','Toggler','csx','requireWeak','MercuryBlockedParticipants','MercuryThreadActions','MercuryThreadIDMap','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=c('MercuryBlockedParticipants').get(),s=c('MercuryThreadActions').get(),t=c('MercuryThreadIDMap').get(),u=c('MercuryThreads').get(),v=null;q('ChatTabModel',function(x){return v=x;});var w={canOpenTab:function(){return !!(h&&!h.isHidden());},openEmptyTab:function(x,y,z){if(this.canOpenTab()&&v){var aa=v.getEmptyTab();this._openClientTab(aa,null);this._logChatOpenTabEvent(y,aa,null,z);this._closeJewelFlyout();}},openThreadTab:function(x,y,z,aa,ba){if(!n.isValid(x)){t.getClientIDFromServerID(x,function(ca){w.openThreadTabImpl(ca,y,z,aa,ba);});}else w.openThreadTabImpl(x,y,z,aa,ba);},openThreadTabImpl:function(x,y,z,aa,ba){u.getThreadMeta(x,(function(ca){if(r.isPresentInGroupThread(ca)){l.show(r.inGroupThread(ca),(function(){this.openClientTab(x,y,z,aa,ba);}).bind(this),function(){s.leaveGroup(x);});}else this.openClientTab(x,y,z,aa,ba);}).bind(this));},openClientTab:function(x,y,z,aa,ba){this._openClientTab(x,aa,ba);this._logChatOpenTabEvent(y,x,null,z);this._closeJewelFlyout();},openUserTab:function(x,y,z){var aa=n.getThreadIDFromUserID(x);this._openClientTab(aa);this._logChatOpenTabEvent(y,aa,x,z);},openPageTab:function(x,y,z){var aa=n.getThreadIDFromUserID(y);u.getThreadMeta(aa,function(ba){if(x&&x.length>0){var ca=(Date.now()-ba.timestamp)/1000,da=ca/3600;if(ba.message_count===0||da>24)j.setWelcomeMessage(aa,n.getParticipantIDFromUserID(y),x);}});this._openClientTab(aa);this._logChatOpenTabEvent(z,aa,y);},_closeJewelFlyout:function(){var x=k.scry(document,"div._1z4y")[0],y=o.getInstance(x);if(y&&y.getActive()&&y.getActive()===x)y.hide();},_openClientTab:function(x,y,z){u.getThreadMeta(x,(function(aa){if(!this.canOpenTab())m.getInstance('mercury').error('Unable to open chat tab',aa);h.tabController.openTab(x,h.tabsViewport,y,!!z);}).bind(this));},_logChatOpenTabEvent:function(x,y,z,aa){i.log(x,y,z,aa);}};f.exports=w;},null);
__d('ChatPerfInstrumentation',['BanzaiLogger','ChatPerfEvent','Promise','emptyFunction','performanceAbsoluteNow'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m={_startTime:(Number),init:function(){this._startTime=l();return new j(function(n){return n();});},_log:function(event){h.log('ChatPerfLoggerConfig',{event:event,duration:l()-this._startTime});},logTTI:function(){this.logTTI=k;this._log(i.TTI);},logCHAT_CONVERSATION_TTI:function(){this.logCHAT_CONVERSATION_TTI=k;this._log(i.CHAT_CONVERSATION_TTI);}};f.exports=m;},null);
__d('ChatQuietLinks',['Event','DOM','UserAgent_DEPRECATED','DataStore','Parent'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m={},n={silenceLinks:function(r){o(r,this.removeEmptyHrefs.bind(this));},nukeLinks:function(r){o(r,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(r){p(r,function(s){return !s||s==='#';});},removeAllHrefs:function(r){p(r);}};function o(r,s){var t=!!j.chrome(),u=!!j.chrome()||j.ie()>=9||j.firefox()>=4;if(m[i.getID(r)])return;m[i.getID(r)]=true;if(!u)return;if(!t){s&&s(r);return;}h.listen(r,'mouseover',function v(w){var x=l.byTag(w.getTarget(),'a');if(x){var y=x.getAttribute('href');if(q(y)){k.set(x,'stashedHref',x.getAttribute('href'));x.removeAttribute('href');}}});h.listen(r,'mouseout',function v(w){var x=l.byTag(w.getTarget(),'a'),y=x&&k.remove(x,'stashedHref');if(q(y))x.setAttribute('href',y);});h.listen(r,'mousedown',function(v){if(!v.isDefaultRequested())return true;var w=l.byTag(v.getTarget(),'a'),x=w&&k.get(w,'stashedHref');if(q(x))w.setAttribute('href',x);});}function p(r,s){var t=i.scry(r,'a');if(s)t=t.filter(function(u){return s(u.getAttribute('href'));});t.forEach(function(u){u.removeAttribute('href');u.setAttribute('tabindex',0);});}function q(r){return r&&r!=='#';}f.exports=n;},null);
__d('Dock',['Event','shield','Arbiter','ArbiterMixin','BlueBar','ChatQuietLinks','CSS','DataStore','DOM','Parent','Scroll','Style','Toggler','Vector','csx','emptyFunction','WebMessengerWidthControl'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();c('WebMessengerWidthControl');function x(){}Object.assign(x,k,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(y){this.init=w;this.rootEl=y;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();m.removeEmptyHrefs(this.rootEl);h.listen(y,'click',this._onClick.bind(this));h.listen(window,'resize',this._onWindowResize.bind(this));t.subscribe(['show','hide'],(function(z,aa){var ba=aa.getActive();if(!p.contains(y,ba))return;if(n.hasClass(ba,'fbNub')){this.notifyNub(ba,z);if(z==='show')this._resizeNubFlyout(ba);}else{var ca=q.byClass(ba,'fbNubFlyout');if(ca)n.conditionClass(ca,'menuOpened',z==='show');}}).bind(this));this.inform('init',{},j.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return this.viewportDimensions=u.getViewportDimensions();},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+u.getElementDimensions(this.rootEl).y;var y=l.getBar();if(y){var z=s.isFixed(y)?'viewport':'document';this.flyoutHeightOffset+=u.getElementPosition(y,z).y+u.getElementDimensions(y).y;}},toggle:function(y){var z=this._findFlyout(y);if(!z)return;this.subscribe('init',function(){t.toggle(y);});},show:function(y){this.subscribe('init',function(){t.show(y);});},showNub:function(y){n.show(y);},hide:function(y){this.subscribe('init',function(){var z=t.getInstance(y);p.contains(y,z.getActive())&&z.hide();});},hideNub:function(y){n.hide(y);this.hide(y);},setUseMaxHeight:function(y,z){n.conditionClass(y,'maxHeight',z!==false);this._resizeNubFlyout(y);},_resizeNubFlyout:function(y){var z=this._findFlyout(y);if(!z||n.hasClass(y,'placeholder')||!(n.hasClass(y,'openToggler')||n.hasClass(y,'opened')))return;var aa=p.find(z,'div.fbNubFlyoutOuter'),ba=p.find(aa,'div.fbNubFlyoutInner'),ca=p.find(ba,'div.fbNubFlyoutBody'),da=r.getTop(ca),ea=ca.offsetHeight;s.set(ca,'height','auto');var fa=u.getElementDimensions(z),ga=u.getElementDimensions(ca),ha=this.getMaxFlyoutHeight(y);s.set(z,'max-height',ha+'px');s.set(aa,'max-height',ha+'px');fa=u.getElementDimensions(z);var ia=u.getElementDimensions(ba),ja=ia.y-ga.y,ka=fa.y-ja,la=parseInt(ca.style.height||ca.clientHeight,10),ma=ka!==la;if(fa.y>ja&&ma)s.set(ca,'height',ka+'px');n.removeClass(z,'swapDirection');var na=u.getElementPosition(z).x;n.conditionClass(z,'swapDirection',(function(){if(na<0)return true;return na+fa.x>this.viewportDimensions.x;}).bind(this)());if(ma&&da+ea>=ga.y){r.setTop(ca,ca.scrollHeight);}else r.setTop(ca,da);this.notifyNub(y,'resize');},getMaxFlyoutHeight:function(y){var z=this._findFlyout(y),aa=u.getElementPosition(z,'viewport'),ba=u.getElementDimensions(z),ca=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-aa.y-ba.y);return Math.max(ca,0);},resizeAllFlyouts:function(){var y=this._getAllNubs(),z=y.length;while(z--)this._resizeNubFlyout(y[z]);},hideAllFlyouts:function(){var y=this._getAllNubs(),z=y.length;while(z--)this.hide(y[z]);},_getAllNubs:function(){var y=p.scry(this.rootEl,"div._50-v.openToggler");return y.concat(p.scry(this.rootEl,"div._50-v.opened"));},_onClick:function(event){var y=event.getTarget(),z=q.byClass(y,'fbNub');if(z){if(q.byClass(y,'fbNubFlyoutTitlebar')){var aa=q.byTag(y,'a'),ba=y.nodeName=='INPUT'&&y.getAttribute('type')=='submit';if(!aa&&!ba){this.hide(z);return false;}}this.notifyNub(z,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(y){return n.hasClass(y,'fbNubFlyout')?y:p.scry(y,'div.fbNubFlyout')[0]||null;},registerNubController:function(y,z){o.set(y,'dock:nub:controller',z);z.subscribe('nub/button/content-changed',i(this.inform,this,'resize',y));z.subscribe('nub/flyout/content-changed',i(this._resizeNubFlyout,this,y));},unregisterNubController:function(y){o.remove(y,'dock:nub:controller');},notifyNub:function(y,z,aa){var ba=o.get(y,'dock:nub:controller');ba&&ba.inform(z,aa);}});f.exports=b.Dock||x;},null);
__d('MercuryDelayedDispatcher',['MercuryDispatcher','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();function m(o){this.$MercuryDelayedDispatcher1=o;this.$MercuryDelayedDispatcher2=[];this.$MercuryDelayedDispatcher3=l.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4=h.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher5=j.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher6=i.getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4.subscribe('model-update-completed',(function(p,q){return this.$MercuryDelayedDispatcher7();}).bind(this));}m.getForFBID=function(o){return n.getForFBID(o);};m.get=function(){return n.get();};m.prototype.handleUpdateWaitForThread=function(o,p){var q=this.$MercuryDelayedDispatcher3.getClientIDFromServerIDNow(p);if(q){this.$MercuryDelayedDispatcher8(o);return;}this.$MercuryDelayedDispatcher3.getClientIDFromServerID(p,(function(){return this.$MercuryDelayedDispatcher2.push(o);}).bind(this));this.$MercuryDelayedDispatcher5.ensureThreadIsFetched(p);};m.prototype.$MercuryDelayedDispatcher7=function(){if(this.$MercuryDelayedDispatcher2&&this.$MercuryDelayedDispatcher2.length){var o=this.$MercuryDelayedDispatcher2[0];this.$MercuryDelayedDispatcher2=this.$MercuryDelayedDispatcher2.slice(1);this.$MercuryDelayedDispatcher8(o);}};m.prototype.$MercuryDelayedDispatcher8=function(o){if(o.from_client){this.$MercuryDelayedDispatcher4.handleUpdate(o);}else this.$MercuryDelayedDispatcher6.handleUpdate(o);};var n=new k(m);f.exports=m;},null);
__d('MercuryMessages',['BanzaiODS','EventEmitter','ImmutableObject','LogHistory','Map','MercuryActionStatus','MercuryActionType','MercuryAssert','MercuryDispatcher','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySingletonMixin','MercuryMessageActions','MercuryMessageIDs','RangedCallbackManager','MercurySendMessageFields','MercuryServerRequests','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','URI','invariant','isMessengerDotComURI','mergeDeep','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){'use strict';if(c.__markCompiled)c.__markCompiled();var ha=new i(),ia=k.getInstance('mercury_messages');function ja(sa,ta){var ua=ta;if(sa._localIdsMap[ta])ua=sa._localIdsMap[ta];return sa._messages.get(ua);}function ka(sa){switch(sa){case s.UNKNOWN:case s.SERVER_INITIAL_DATA:case s.SERVER_FETCH_THREAD_INFO:case s.SERVER_THREAD_SYNC:return true;}return false;}function la(sa,ta){if(!sa._threadsToMessages[ta])sa._threadsToMessages[ta]=new w(function(ua){return ja(sa,ua).timestamp;},function(ua,va){return va-ua;});return sa._threadsToMessages[ta];}function ma(sa,ta,ua){ta.forEach(function(va){var wa=la(sa,va);wa.setReachedEndOfArray();sa._emitReorderedChange(va,ua);});}function na(sa){this._fbid=sa;this._messageActions=u.getForFBID(this._fbid);this._serverRequests=y.getForFBID(this._fbid);this._threadInformer=aa.getForFBID(this._fbid);this._threads=ba.getForFBID(this._fbid);this._threadActions=z.getForFBID(this._fbid);this._dispatcher=p.getForFBID(this._fbid);this._didChange=false;this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new l();this._localIdsMap={};this._dispatcher.subscribe('update-messages',(function(ta,ua){var va=(ua.actions||[]).filter(function(xa){var ya=xa.action_type,za=(xa.is_forward||xa.thread_id)&&(ya==n.LOG_MESSAGE||ya==n.USER_GENERATED_MESSAGE||ya==n.SEND_MESSAGE||ya==n.DELETE_THREAD||ya==n.DELETE_MESSAGES||ya==n.MARK_MESSAGES_SPAM),ab=xa.upload_id&&xa.upload_data&&(ya==n.CANCEL_ATTACHMENT_PLACEHOLDER||ya==n.CONFIRM_ATTACHMENT_PLACEHOLDER),bb=xa.note&&ya==n.CREATE_PAGE_ADMIN_NOTE,cb=xa.replaced_message_id&&ya==n.REPLACE_MESSAGE;return za||ab||bb||cb;}),wa=ka(ua.payload_source);this.handleUpdates(va,wa,ua.payload_source,ua.from_client);if(ua.end_of_history)ma(this,ua.end_of_history,ua.payload_source);if(this._didChange){this._didChange=false;ha.emit('change');}}).bind(this));ia.debug('constructed',{fbid:this._fbid});}Object.assign(na.prototype,{getMessagesFromIDs:function(sa){return (sa||[]).map(ja.bind(null,this)).filter(function(ta){return ta;});},getServerMessageID:function(sa){var ta=sa;if(this._localIdsMap[sa])ta=this._localIdsMap[sa];return ta;},hasLoadedNMessages:function(sa,ta){var ua=la(this,sa);return ua.hasReachedEndOfArray()||ua.getCurrentArraySize()>=ta;},hasLoadedExactlyNMessages:function(sa,ta){var ua=la(this,sa);return ua.getCurrentArraySize()==ta;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new l();this._localIdsMap={};},getThreadMessagesRange:function(sa,ta,ua,va,wa,xa){var ya=la(this,sa),za=(function(jb){va(oa(this,jb));}).bind(this),ab=ya.executeOrEnqueue(ta,ua,za),bb=ya.getUnavailableResources(ab),cb=this._failedHistoryFetchThreads[sa];if(bb.length&&!cb){var db=ya.getCurrentArraySize(),eb=this._localTitanMessagesCount[sa]||0,fb=db-eb,gb=bb.length+eb,hb=this.getCurrentlyLoadedMessages(sa),ib=hb.length?hb[0].timestamp:null;ia.debug('fetch_missing_messages',{threadID:sa,offset:ta,limit:ua,timestamp:ib,missingIndices:bb,messageCount:db,localMessageCount:eb});this._serverRequests.fetchThreadMessages(sa,fb,gb,ib,wa,xa);}else this._failedHistoryFetchThreads[sa]=false;return ab;},getThreadMessagesRangeNow:function(sa,ta,ua){var va=la(this,sa),wa=[];for(var xa=ta;xa<ta+ua;xa++){var ya=va.getResourceAtIndex(xa),za=ja(this,ya);za&&wa.push(za);}return wa;},getThreadMessagesSinceTimestamp:function(sa,ta){var ua=la(this,sa),va=ua.getElementsUntil(ta);return oa(this,va);},hasLoadedAllMessages:function(sa){return la(this,sa).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(sa){var ta=la(this,sa).getAllResources();return oa(this,ta);},unsubscribe:function(sa,ta){o.isThreadID(ta);var ua=la(this,ta);ua.unsubscribe(sa);},_addNewMessage:function(sa,ta){ra(ta);this._messages.set(sa,new j(ta));},_addNewPageAdminNote:function(sa,ta){var ua=this._messages.get(sa);if(ua){var va=ua.page_admin_notes?ua.page_admin_notes.slice():[],wa=false,xa=true;for(var ya=0;ya<va.length;++ya)if(va[ya].id===ta.id){wa=true;xa=false;break;}else if((va[ya].id===null||va[ya].id===undefined)&&va[ya].body===ta.body){wa=true;va[ya]=ta;}if(!wa)va.push(ta);if(xa){var za={};za.page_admin_notes=va;this._updateMessage(sa,ua,za);}}},_updateMessage:function(sa,ta,ua){var va=j.set(ta,ua);this._messages.set(sa,va);return va;},_shouldSortOutOfOrderMessages:function(sa,ta,ua){if(sa==s.CLIENT_CHANNEL_MESSAGE){var va=this.getThreadMessagesSinceTimestamp(ta,ua);if(va.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},_preprocessIncomingAction:function(sa,ta){var ua=sa.action_type;if(ta==s.CLIENT_CHANNEL_MESSAGE&&ua==n.USER_GENERATED_MESSAGE&&sa.offline_threading_id&&this._localIdsMap[sa.offline_threading_id]===sa.offline_threading_id){sa.client_message_id=sa.offline_threading_id;sa.status=m.SUCCESS;sa.action_type=n.SEND_MESSAGE;ua=sa.action_type;}if(ta===s.CLIENT_CHANNEL_MESSAGE&&ua==n.USER_GENERATED_MESSAGE){var va=this._threads.getThreadMetaNow(sa.thread_id);if(va&&va.folder)sa.folder=va.folder;}return sa;},handleUpdates:function(sa,ta,ua,va){var wa,xa={};for(var ya=0;ya<sa.length;ya++){var za=this._preprocessIncomingAction(sa[ya],ua),ab=za.action_type,bb=ja(this,za.message_id);if(ab==n.LOG_MESSAGE)if(this.isLocalMessage(za))continue;if(za.is_forward||ua==s.SERVER_SEARCH){if(!this._messages.has(za.message_id))this._addNewMessage(za.message_id,za);continue;}else if(za.client_state===r.SEND_TO_SERVER){this._addNewMessage(za.message_id,za);continue;}else if(ab==n.SEND_MESSAGE){var cb=za.client_message_id;if(cb&&this._localIdsMap[cb]&&za.status){var db=ja(this,cb),eb=db.status;if(db.status==m.SUCCESS)continue;if(!xa[za.thread_id])xa[za.thread_id]=[];this._updateLocalMessage(za);if(typeof eb!==undefined||za.status==m.FAILED_UNKNOWN_REASON||za.status==m.UNABLE_TO_CONFIRM||za.status==m.SUCCESS||za.status==m.ERROR)this._emitUpdatedChange(za.thread_id,ja(this,cb).message_id,ua);}continue;}else if(ab==n.DELETE_THREAD){la(this,za.thread_id).removeAllResources();continue;}else if(ab==n.DELETE_MESSAGES){this._deleteMessages(za.thread_id,za.message_ids,ua);ga((function(){this._threadActions.updateSnippet(za.thread_id,za.message_ids);}).bind(this));continue;}else if(ab==n.CREATE_PAGE_ADMIN_NOTE){this._addNewPageAdminNote(za.message_id,za.note);this._emitUpdatedChange(za.thread_id,za.message_id,'link_shim');continue;}else if(za.offline_threading_id&&this._localIdsMap[za.offline_threading_id]||bb&&!bb.is_forward){if(bb&&za.ranges&&za.ranges.length>0){var fb=bb.message_id;this._updateMessage(this._localIdsMap[fb]||fb,bb,{ranges:sa.ranges});this._emitUpdatedChange(bb.thread_id,bb.message_id,'link_shim');}continue;}else if(ab===n.CONFIRM_ATTACHMENT_PLACEHOLDER){this._confirmAttachmentPlaceholder(za.upload_id,za.upload_data);continue;}else if(ab===n.CANCEL_ATTACHMENT_PLACEHOLDER){this._cancelAttachmentPlaceholder(za.upload_id,za.upload_data);continue;}else if(ab==n.REPLACE_MESSAGE){if(this._replaceMessage(za)){if(!xa[za.thread_id])xa[za.thread_id]=[];xa[za.thread_id].push(za.message_id);this._emitUpdatedChange(za.thread_id,za.replaced_message_id,ua);this._emitUpdatedChange(za.thread_id,za.message_id,ua);ta=true;}continue;}else{if(ua===s.CLIENT_SEND_MESSAGE){this._localIdsMap[za.message_id]=za.message_id;if(za.thread_id=='root:'+za.offline_threading_id)la(this,za.thread_id).setReachedEndOfArray();}if(ab==n.LOG_MESSAGE&&za.log_message_type==q.SERVER_ERROR)this._failedHistoryFetchThreads[za.thread_id]=true;if(za.client_state===r.DO_NOT_SEND_TO_SERVER&&za.upload_id)this._uploadMessages[za.upload_id]=za;if(!xa[za.thread_id])xa[za.thread_id]=[];xa[za.thread_id].push(za.message_id);this._addNewMessage(za.message_id,za);if(za.offline_threading_id&&za.offline_threading_id!=za.message_id){this._localIdsMap[za.offline_threading_id]=za.message_id;v.addServerID(za.offline_threading_id,za.message_id);if(za.threading_id)v.addServerID(za.threading_id,za.message_id);}if(za[x.MANUAL_RETRY_CNT]>0){wa=la(this,za.thread_id);wa.resortResources([za.message_id]);this._emitReorderedChange(za.thread_id,s.CLIENT_SEND_MESSAGE);}ta=ta||this._shouldSortOutOfOrderMessages(ua,za.thread_id,za.timestamp);if(!ta)this._emitReceivedChange(ja(this,za.message_id));continue;}}for(var gb in xa){wa=la(this,gb);var hb=wa.getAllResources(),ib=hb.filter((function(jb){var kb=this._messages.get(jb);if(!kb)return true;return kb.action_type==n.LOG_MESSAGE&&kb.log_message_type==q.SERVER_ERROR;}).bind(this));wa.removeResources(ib);if(va)pa(this,gb,xa[gb]);if(ta){wa.addResources(xa[gb]);this._emitReorderedChange(gb,ua);}else wa.addResourcesWithoutSorting(xa[gb].reverse(),0);this._threadInformer.updatedThread(gb);}this._didChange&&ia.debug('handle_updates',{localMessageCounts:fa(this._localTitanMessagesCount)});},isFirstMessage:function(sa){var ta=la(this,sa.thread_id);if(ta.getCurrentArraySize()===0)return false;var ua=ta.getResourceAtIndex(ta.getCurrentArraySize()-1),va=ja(this,ua).message_id,wa=ja(this,sa.message_id).message_id;return ta.hasReachedEndOfArray()&&va==wa;},isLocalMessage:function(sa){if(sa.offline_threading_id!==null&&sa.offline_threading_id===sa.message_id)return true;if(sa.threading_id!==null&&sa.threading_id===sa.message_id)return true;return false;},_deleteMessages:function(sa,ta,ua){if(!ta.length)return;this._deleteIndividualMessages(sa,ta,ua);if(ua!==s.CLIENT_CHANNEL_MESSAGE)this._serverRequests.deleteMessages(sa,ta);},_deleteIndividualMessages:function(sa,ta,ua){var va=ta.map(function(xa){return ja(this,xa).message_id;},this),wa=la(this,sa);wa.removeResources(va);this._emitReorderedChange(sa,ua);},_updateLocalMessage:function(sa){var ta=ja(this,sa.client_message_id),ua={};ua.status=sa.status;if(sa.status===m.SUCCESS||sa.error_data)ua.error_data=sa.error_data;var va=sa.message_id,wa=sa.client_message_id;if(this._messages.has(va)){this._updateMessage(va,ta,ua);return false;}if(sa.threading_id)ua.threading_id=sa.threading_id;if(sa.timestamp)ua.timestamp=sa.timestamp;if(sa.log_message_data)ua.log_message_data=sa.log_message_data;if(sa.ranges&&sa.ranges.length){ra(sa);ua.ranges=sa.ranges;}if(sa.attachments&&sa.attachments.length){ua.raw_attachments=null;ua.attachments=sa.attachments;}this._localIdsMap[wa]=va;v.addServerID(wa,va);var xa=this._updateMessage(va,ta,ua);this._messages.set(wa,new j());if(qa(xa))this._localTitanMessagesCount[xa.thread_id]--;return true;},_replaceMessage:function(sa){var ta=sa.replaced_message_id,ua=ja(this,ta);if(!ua)return false;var va={};va.status=sa.status;if(sa.timestamp)va.timestamp=sa.timestamp;if(sa.log_message_data)va.log_message_data=sa.log_message_data;if(sa.ranges&&sa.ranges.length){ra(sa);va.ranges=sa.ranges;}if(sa.attachments&&sa.attachments.length){va.raw_attachments=null;va.attachments=sa.attachments;}if(sa.body)va.body=sa.body;var wa=sa.message_id;v.addServerID(wa,wa);this._updateMessage(wa,ua,va);this._messages['delete'](ta);return true;},getNumberLocalMessages:function(sa){return this._localTitanMessagesCount[sa]||0;},_uploadMessages:{},_confirmAttachmentPlaceholder:function(sa,ta){var ua=this._popPendingAttachmentMessage(sa,ta);delete ua.preview_attachments;this._serverRequests.sendNewMessage(ua);},_cancelAttachmentPlaceholder:function(sa,ta){var ua=this._popPendingAttachmentMessage(sa,ta);this._deleteIndividualMessages(ua.thread_id,[ua.message_id]);if(this._localTitanMessagesCount[ua.thread_id])this._localTitanMessagesCount[ua.thread_id]--;},_popPendingAttachmentMessage:function(sa,ta){var ua=this._uploadMessages[sa];!ua?da(0):undefined;ua.image_ids=ta.image_ids;ua.file_ids=ta.file_ids;ua.audio_ids=ta.audio_ids;ua.gif_ids=ta.gif_ids;ua.video_ids=ta.video_ids;ua.client_state=r.SEND_TO_SERVER;delete this._uploadMessages[sa];return ua;},_emitUpdatedChange:function(sa,ta,ua){this._didChange=true;this._threadInformer.updatedMessage(sa,ta,ua);},_emitReceivedChange:function(sa){this._didChange=true;this._threadInformer.receivedMessage(sa);},_emitReorderedChange:function(sa,ta){this._didChange=true;this._threadInformer.reorderedMessages(sa,ta);}});Object.assign(na,t,{addListener:function(sa,ta){return ha.addListener(sa,ta);}});function oa(sa,ta){var ua=ta.map(ja.bind(null,sa));return ua.reverse();}function pa(sa,ta,ua){var va=ua.filter(function(wa){return qa(ja(sa,wa));});if(!sa._localTitanMessagesCount[ta])sa._localTitanMessagesCount[ta]=0;sa._localTitanMessagesCount[ta]+=va.length;}function qa(sa){var ta=sa.action_type;if(ta==n.USER_GENERATED_MESSAGE)return true;switch(sa.log_message_type){case q.SUBSCRIBE:case q.UNSUBSCRIBE:case q.SERVER_ERROR:case q.LIVE_LISTEN:return false;default:return true;}}function ra(sa){if(!sa.ranges)return;sa.ranges.forEach(function(ta){if(!ta.entity||ta.entity.external||!ta.entity.url)return;var ua=new ca(ta.entity.url);if(ea(ca.getRequestURI())&&!ua.getDomain()){ua.setProtocol('https').setDomain('www.facebook.com');ta.entity.url=ua.toString();}});}f.exports=na;},null);
__d('MercuryChannelHandler',['Arbiter','ChannelConstants','MercuryActionType','MercuryConfig','MercuryDelayedDispatcher','MercuryGlobalActionType','MercuryLogMessageType','MercuryMessages','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySingletonMixin','MercuryThreadInformer','MercuryViewer','MessagingEvent','MessagingReliabilityLogger','MessagingTag','PresenceUtil','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();var z,aa;z=babelHelpers.inherits(ba,y(r));aa=z&&z.prototype;function ba(ca){'use strict';aa.constructor.call(this);this.$MercuryChannelHandler1=ca;this.__payloadPreprocessor=q.getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler2=s.getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler3=o.getForFBID(this.$MercuryChannelHandler1);this.__delayedDispatcher=l.getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler4=[];}ba.prototype.getInstanceFBID=function(){'use strict';return this.$MercuryChannelHandler1;};ba.prototype.$MercuryChannelHandler5=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.message){v.addEntry('channel_receive','invalid_data');return;}var ea=da.obj.message,fa=ea.other_user_fbid?ea.other_user_fbid:ea.thread_fbid;fa=fa.toString();var ga={author:ea.mercury_author_id,author_email:ea.mercury_author_email,body:ea.body,subject:ea.subject,has_attachment:ea.has_attachment,attachments:ea.attachments,ephemeral_ttl_mode:ea.ephemeral_ttl_mode,html_body:ea.html_body,thread_id:ea.tid,thread_fbid:ea.thread_fbid&&ea.thread_fbid.toString(),other_user_fbid:ea.other_user_fbid&&ea.other_user_fbid.toString(),offline_threading_id:ea.offline_threading_id,message_id:ea.mid,is_spoof_warning:ea.is_spoof_warning,ranges:ea.ranges,source:ea.mercury_source,source_tags:ea.mercury_source_tags,threading_id:ea.threading_id,timestamp:ea.timestamp,timestamp_absolute:ea.timestamp_absolute,timestamp_relative:ea.timestamp_relative,timestamp_datetime:ea.timestamp_datetime,timestamp_time_passed:ea.timestamp_time_passed,action_type:j.USER_GENERATED_MESSAGE,is_unread:ea.is_unread,is_forward:false,forward_count:ea.forward_count||ea.forward,forward_message_ids:ea.forward_msg_ids,folder:da.obj.folder};if("sync_id" in ea){ga.sync_id=ea.sync_id;}else ga.action_id=ea.action_id;if(this.__shouldDropMessageBecauseOfSync(ea))return;var ha=[babelHelpers._extends({},ga)];ha=ha.concat(ea.forward_actions||[]);var ia=p.CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:ha,payload_source:ia},fa);v.addEntry('channel_receive','success',[fa,ga.message_id,x.getSessionID()]);};ba.prototype.$MercuryChannelHandler7=function(ca,da){'use strict';if(k.WWWSyncDeliveryReceipt)return;var ea=da.obj.other_user_fbid,fa=da.obj.thread_fbid;if(!this.$MercuryChannelHandler6(ca)||!ea&&!fa)return;this.__payloadPreprocessor.handleUpdate({delivery_receipts:[{other_user_fbid:ea?ea.toString():'',thread_fbid:fa?fa.toString():'',time:da.obj.timestamp}]});};ba.prototype.$MercuryChannelHandler8=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.thread_fbids&&!da.obj.other_user_fbids)return;var ea=[],fa=da.obj.event==u.READ;if(fa&&k.WWWSyncMarkRead)return;(da.obj.thread_fbids||[]).forEach(function(ga){ea.push({action_type:j.CHANGE_READ_STATUS,action_id:null,thread_fbid:ga,mark_as_read:fa,timestamp:da.obj.timestamp||0,folder:da.obj.folder_info[ga]});});(da.obj.other_user_fbids||[]).forEach(function(ga){ea.push({action_type:j.CHANGE_READ_STATUS,action_id:null,other_user_fbid:ga,mark_as_read:fa,timestamp:da.obj.timestamp||0,folder:da.obj.folder_info[ga]});});this.__payloadPreprocessor.handleUpdate({actions:ea,payload_source:p.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler9=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||!(da.obj.thread_fbids||da.obj.other_user_fbids))return;var ea=[];(da.obj.thread_fbids||[]).forEach(function(fa){ea.push({action_type:j.DELETE_THREAD,action_id:null,thread_fbid:fa});});(da.obj.other_user_fbids||[]).forEach(function(fa){ea.push({action_type:j.DELETE_THREAD,action_id:null,other_user_fbid:fa});});this.__payloadPreprocessor.handleUpdate({actions:ea,payload_source:p.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler10=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.thread_fbids&&!da.obj.other_user_fbids||!da.obj.mids)return;var ea=da.obj.thread_fbids.length?da.obj.thread_fbids[0]:null,fa=da.obj.other_user_fbids.length?da.obj.other_user_fbids[0]:null,ga={action_type:j.DELETE_MESSAGES,action_id:null,thread_fbid:ea,other_user_fbid:fa,message_ids:da.obj.mids};if(k.MessengerGlobalDeleteGK){if(da.obj.updated_thread)return;this.__payloadPreprocessor.handleUpdate({actions:[ga],payload_source:p.CLIENT_CHANNEL_MESSAGE});return;}this.__payloadPreprocessor.handleUpdate({actions:[ga],threads:[da.obj.updated_thread],payload_source:p.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler11=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||!da.obj.folder)return;var ea={action_type:m.MARK_ALL_READ,action_id:da.obj.action_id,folder:da.obj.folder};this.__payloadPreprocessor.handleUpdate({global_actions:[ea]});};ba.prototype.$MercuryChannelHandler12=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj.thread_fbids&&!da.obj.other_user_fbids)return;var ea=p.CLIENT_CHANNEL_MESSAGE;(da.obj.thread_fbids||[]).forEach(function(fa){var ga={action_type:j.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:fa.toString(),other_user_fbid:null,archived:da.obj.state};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers._extends({},ga)],payload_source:ea},fa.toString());},this);(da.obj.other_user_fbids||[]).forEach(function(fa){var ga={action_type:j.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:fa.toString(),archived:da.obj.state};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers._extends({},ga)],payload_source:ea},fa.toString());},this);};ba.prototype.$MercuryChannelHandler13=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj.thread_fbids&&!da.obj.other_user_fbids)return;var ea=p.CLIENT_CHANNEL_MESSAGE,fa;(da.obj.thread_fbids||[]).forEach(function(ga){if(da.obj.event==u.TAG){fa=da.obj.tag;}else fa=da.obj.marked_as_spam?w.SPAM:w.INBOX;var ha={action_type:j.CHANGE_FOLDER,action_id:null,thread_fbid:ga.toString(),other_user_fbid:null,new_folder:fa};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers._extends({},ha)],payload_source:ea},ga.toString());},this);(da.obj.other_user_fbids||[]).forEach(function(ga){if(da.obj.event==u.TAG){fa=da.obj.tag;}else fa=da.obj.marked_as_spam?w.SPAM:w.INBOX;var ha={action_type:j.CHANGE_FOLDER,action_id:null,other_user_fbid:ga.toString(),thread_fbid:null,new_folder:fa};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers._extends({},ha)],payload_source:ea},ga.toString());},this);};ba.prototype.$MercuryChannelHandler14=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj.tag)return;switch(da.obj.tag){case w.ACTION_ARCHIVED:this.$MercuryChannelHandler12(ca,da);break;case w.INBOX:case w.OTHER:this.$MercuryChannelHandler13(ca,da);break;}};ba.prototype.__markAsSeen=function(ca,da){'use strict';if(!this.$MercuryChannelHandler15(ca)||!da.obj||!da.obj.seen_timestamp)return;this.__payloadPreprocessor.handleUpdate({message_counts:[{seen_timestamp:da.obj.seen_timestamp,folder:w.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:w.INBOX}],payload_source:p.CLIENT_CHANNEL_MESSAGE});};ba.prototype.__updateModelsFromMercuryPayload=function(ca,da){'use strict';if(!this.$MercuryChannelHandler16(ca)||!da.obj)return;this.$MercuryChannelHandler2.synchronizeInforms((function(){var ea=da.obj,fa=[];(ea.actions||[]).forEach(function(ga){var ha=j.USER_GENERATED_MESSAGE;if(ga.action_type==j.LOG_MESSAGE){if(this.__shouldDropLogMessageBecauseOfSync(ga))return;var ia=p.CLIENT_CHANNEL_MESSAGE,ja;ja=ga.other_user_fbid||ga.thread_fbid;this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers._extends({},ga)],payload_source:ia},ja);}else if(ga.action_type!=ha)fa.push(ga);},this);ea.actions=fa;ea.payload_source=p.CLIENT_CHANNEL_MESSAGE;this.__payloadPreprocessor.handleUpdate(ea);}).bind(this));};ba.prototype.$MercuryChannelHandler17=function(ca,da){'use strict';var ea,fa;if(k.WWWSyncReadReceipt)return;var ga=da.obj.time,ha=da.obj.reader,ia=da.obj.thread_fbid||'';this.__payloadPreprocessor.handleUpdate({roger:(fa={},fa[ia]=(ea={},ea[ha]=ga,ea),fa)});};ba.prototype.$MercuryChannelHandler18=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||da.obj.message_blocked===undefined||!da.obj.thread_fbid)return;var ea=j.UPDATE_BLOCKER_STATUS,fa=[{action_type:ea,action_id:null,thread_fbid:da.obj.thread_fbid,message_blocked:da.obj.message_blocked,is_blocked_by_recipient:da.obj.is_blocked_by_recipient}];this.__payloadPreprocessor.handleUpdate({actions:fa,payload_source:p.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler19=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||da.obj.got_blocked===undefined||!da.obj.thread_fbid)return;var ea=j.UPDATE_BLOCKEE_STATUS,fa=[{action_type:ea,action_id:null,thread_fbid:da.obj.thread_fbid,got_blocked:da.obj.got_blocked}];this.__payloadPreprocessor.handleUpdate({actions:fa,payload_source:p.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler20=function(ca,da){'use strict';if(!this.$MercuryChannelHandler6(ca)||!da.obj||da.obj.mute_settings===undefined||!da.obj.thread_fbid&&!da.obj.other_user_fbid)return;var ea=j.CHANGE_MUTE_SETTINGS,fa=[{action_type:ea,action_id:null,thread_fbid:da.obj.thread_fbid,other_user_fbid:da.obj.other_user_fbid,mute_settings:da.obj.mute_settings}];this.__payloadPreprocessor.handleUpdate({actions:fa,payload_source:p.CLIENT_CHANNEL_MESSAGE});};ba.prototype.__handleMessagingPayload=function(ca,da){'use strict';switch(da.obj.event){case u.DELIVER:this.$MercuryChannelHandler5(ca,da);break;case u.DELIVERY_RECEIPT:this.$MercuryChannelHandler7(ca,da);break;case u.READ:case u.UNREAD:this.$MercuryChannelHandler8(ca,da);break;case u.READ_ALL:this.$MercuryChannelHandler11(ca,da);break;case u.DELETE:this.$MercuryChannelHandler9(ca,da);break;case u.DELETE_MESSAGES:this.$MercuryChannelHandler10(ca,da);break;case u.TAG:this.$MercuryChannelHandler14(ca,da);break;case u.REPORT_SPAM:this.$MercuryChannelHandler13(ca,da);break;case u.READ_RECEIPT:this.$MercuryChannelHandler17(ca,da);break;case u.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandler20(ca,da);break;case u.UPDATE_BLOCKER_STATUS:this.$MercuryChannelHandler18(ca,da);break;case u.UPDATE_BLOCKEE_STATUS:this.$MercuryChannelHandler19(ca,da);break;}};ba.prototype.getRouting=function(){'use strict';return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};ba.prototype.__getMessagingPayloadType=function(){'use strict';return i.getArbiterType('messaging');};ba.prototype.__getMercuryPayloadType=function(){'use strict';return i.getArbiterType('mercury');};ba.prototype.__getInboxPayloadType=function(){'use strict';return i.getArbiterType('inbox');};ba.prototype.$MercuryChannelHandler6=function(ca){'use strict';return ca==this.__getMessagingPayloadType();};ba.prototype.$MercuryChannelHandler16=function(ca){'use strict';return ca==this.__getMercuryPayloadType();};ba.prototype.$MercuryChannelHandler15=function(ca){'use strict';return ca==this.__getInboxPayloadType();};ba.prototype.turnOn=function(){'use strict';if(!this.$MercuryChannelHandler4.length){var ca=this.getRouting();for(var da in ca)this.$MercuryChannelHandler4.push(h.subscribe(i.getArbiterType(da),ca[da].bind(this)));}return this;};ba.prototype.turnOff=function(){'use strict';if(this.$MercuryChannelHandler4.length){this.$MercuryChannelHandler4.forEach(h.unsubscribe);this.$MercuryChannelHandler4=[];}return this;};ba.prototype.__shouldDropMessageBecauseOfSync=function(ca){'use strict';if(!ca.has_attachment&&k.WWWSyncMsgText){return true;}else if(ca.has_attachment&&k.WWWSyncMsgAttach)return true;return false;};ba.prototype.__shouldDropLogMessageBecauseOfSync=function(ca){'use strict';if(k.WWWSyncMsgLog)switch(ca.log_message_type){case n.UNSUBSCRIBE:case n.SUBSCRIBE:case n.THREAD_NAME:return true;default:break;}return false;};Object.assign(ba,r);f.exports=ba;},null);
__d('MercuryRoger',['Arbiter','ArbiterMixin','immutable','JSLogger','MercuryActionStatus','MercuryDispatcher','MercurySingletonProvider','MercuryThreads','mixin','mapObject'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r,s,t=l.SUCCESS;r=babelHelpers.inherits(u,p(i));s=r&&r.prototype;u.getForFBID=function(y){'use strict';return v.getForFBID(y);};u.get=function(){'use strict';return v.get();};function u(y){'use strict';s.constructor.call(this);this.$MercuryRoger1={};this.$MercuryRoger2=[];this.$MercuryRoger3=y;this.$MercuryRoger4=m.getForFBID(this.$MercuryRoger3);this.$MercuryRoger5=o.getForFBID(this.$MercuryRoger3);this.$MercuryRoger4.subscribe('update-roger',(function(z,aa){for(var ba in aa){var ca=this.$MercuryRoger1[ba]||j.OrderedMap();ca=ca.withMutations((function(da){for(var ea in aa[ba]){var fa=this.$MercuryRoger5.getThreadMetaNow(ba);if(fa&&fa.participants)if(fa.participants.indexOf(ea)==-1){this.$MercuryRoger2.push(x(this.$MercuryRoger1));continue;}var ga=da.get(ea),ha=aa[ba][ea];if(!ga||ha>ga)da.set(ea,ha);}}).bind(this));this.$MercuryRoger1[ba]=ca.sort();}aa&&this.inform('change',aa);}).bind(this));h.subscribe(k.DUMP_EVENT,(function(z,aa){aa.bad_read_receipts={receipts:this.$MercuryRoger2};}).bind(this));}u.prototype.getSeenBy=function(y,z){'use strict';if(!y)return [];var aa=[],ba=this.$MercuryRoger1[y.thread_id];if(!ba)return aa;ba.forEach(function(ca,da){if(w(y,ca,da,z))aa.push(da);});return aa;};u.prototype.wasSeenByAll=function(y){'use strict';if(!y)return false;var z=this.$MercuryRoger1[y.thread_id];if(!z)return false;return z.every(function(aa,ba){return w(y,aa,ba);});};u.prototype.getSeenTimestamps=function(y){'use strict';var z=this.$MercuryRoger1[y];if(!z){z=j.OrderedMap();this.$MercuryRoger1[y]=z;}return z;};u.prototype.getSeenTimestamp=function(y,z){'use strict';var aa=this.$MercuryRoger1[y];return aa?aa.get(z):null;};var v=new n(u);function w(y,z,aa,ba){return !!(z>=y.timestamp&&(y.status===undefined||y.status===t)&&(!ba||aa!=y.author));}function x(y){return q(y,function(z){return z.toJS();});}f.exports=u;},null);
__d('MercuryDelayedRoger',['ArbiterMixin','LiveTimer','MercuryActionStatus','MercuryConfig','setTimeoutAcrossTransitions','MercuryMessages','MercuryRoger','MercuryThreadInformer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=c('MercuryMessages').get(),n=c('MercuryRoger').get(),o=c('MercuryThreadInformer').get(),p=c('MercuryThreads').get(),q={},r={},s=k['roger.seen_delay'],t={getSeenBy:function(z,aa){if(r[z])return [];return n.getSeenBy(u(z),aa);},wasSeenByAll:function(z){if(r[z])return false;return n.wasSeenByAll(u(z));}};Object.assign(t,h);function u(z){if(!q[z]){var aa=p.getThreadMetaNow(z);if(aa)q[z]={thread_id:z,author:aa.participants[0],timestamp:aa.timestamp};}return q[z];}function v(z){var aa=false;m.getThreadMessagesRange(z,0,1,function(ba){var ca=ba[0];if(!ca)return;var da=ca.timestamp;if(ca.action_id||ca.status==j.SUCCESS)da-=i.getServerTimeOffset();var ea=t.getSeenBy(z);if(r[z]){clearTimeout(r[z]);delete r[z];}var fa=da+s,ga=fa-Date.now();if(ga>0)r[z]=l(function(){delete r[z];w(z);},ga);q[z]=ca;var ha=t.getSeenBy(z);if(ea.length||ha.length)aa=true;});return aa;}function w(z){var aa={};aa[z]=true;x(aa);}function x(z){t.inform('state-changed',z);t.inform('change');}function y(event,z){var aa={};for(var ba in z)if(v(ba))aa[ba]=true;for(var ca in aa){x(aa);break;}}n.subscribe('change',function(z,aa){for(var ba in aa)!r[ba]&&w(ba);});o.subscribe('messages-received',y);o.subscribe('messages-reordered',y);o.subscribe('messages-updated',y);f.exports=t;},null);
__d('MercuryDeliveryReceipts',['ArbiterMixin','Map','MercuryDispatcher','MercurySingletonProvider','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m,n;m=babelHelpers.inherits(o,l(h));n=m&&m.prototype;function o(q){'use strict';n.constructor.call(this);this.$MercuryDeliveryReceipts1=q;this.$MercuryDeliveryReceipts2=new i();this.$MercuryDeliveryReceipts3=j.getForFBID(this.$MercuryDeliveryReceipts1);this.$MercuryDeliveryReceipts3.subscribe('update-delivery',(function(r,s){if(s.delivery_receipts)for(var t in s.delivery_receipts){var u=s.delivery_receipts[t],v=this.$MercuryDeliveryReceipts2.get(t)||0;if(u>v){this.$MercuryDeliveryReceipts2.set(t,u);this.informDeliveryStatusChanged(t);}}}).bind(this));}o.getForFBID=function(q){'use strict';return p.getForFBID(q);};o.get=function(){'use strict';return p.get();};o.prototype.informDeliveryStatusChanged=function(q){'use strict';var r=new i();r.set(q,true);this.inform('change',r);};o.prototype.getDeliveryTime=function(q){'use strict';return this.$MercuryDeliveryReceipts2.get(q)||0;};var p=new k(o);f.exports=o;},null);
__d('MercuryDeliveryState',['MercuryConfig','MercuryIDs','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInformer','PresencePrivacy','UserActivity','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=h.delivery_timeout||120000;r.getForFBID=function(t){return s.getForFBID(t);};r.get=function(){return s.get();};function r(t){this.$MercuryDeliveryState1=t;this.$MercuryDeliveryState2=j.getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState3=m.getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState4=l.getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState5=[];this.$MercuryDeliveryState6=[];this.$MercuryDeliveryState3.subscribe('messages-received',this.$MercuryDeliveryState7.bind(this));o.subscribe(p(this.$MercuryDeliveryState8,300,this));}r.prototype.$MercuryDeliveryState7=function(t,u){for(var v in u){var w=u[v];w.forEach((function(x){if(this.$MercuryDeliveryState9(x)){this.$MercuryDeliveryState5.push(x);this.$MercuryDeliveryState4.getServerIDFromClientID(v,(function(y){if(!this.$MercuryDeliveryState6[y])this.$MercuryDeliveryState6[y]=[];this.$MercuryDeliveryState6[y].push(x.message_id);}).bind(this));}}).bind(this));}if(o.isActive(q))this.$MercuryDeliveryState8();};r.prototype.$MercuryDeliveryState8=function(){if(this.$MercuryDeliveryState5.length===0&&this.$MercuryDeliveryState6.length===0)return;var t=this.$MercuryDeliveryState5.map(function(u){return u.message_id;});if(t)this.$MercuryDeliveryState2.sendDeliveryReceipts(t,this.$MercuryDeliveryState6);this.$MercuryDeliveryState6=[];this.$MercuryDeliveryState5=[];};r.prototype.$MercuryDeliveryState9=function(t){var u=t.author?i.getUserIDFromParticipantID(t.author):null;if(u===this.$MercuryDeliveryState1)return false;if(!t.is_unread)return false;if(!n.allows(u))return false;return true;};var s=new k(r);f.exports=r;},null);
__d('MercuryFilters',['MessagingTag','arrayContains'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=[h.UNREAD],k={ALL:'all',UNREAD:h.UNREAD,getSupportedFilters:function(){return j.concat();},isSupportedFilter:function(l){return i(j,l);}};f.exports=k;},null);
__d('MercuryOrderedThreadlist',['LogHistory','MercuryActionType','MercuryDispatcher','MercuryFilters','MercuryFolders','MercuryPayloadSource','MercurySingletonMixin','MercuryThreadIDMap','MessagingTag','PageMessageEnumTag','RangedCallbackManager','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){'use strict';if(c.__markCompiled)c.__markCompiled();var w=h.getInstance('ordered_threadlist_model'),x=k.getSupportedFilters().concat([k.ALL,p.GROUPS]),y=l.getSupportedFolders().concat([p.SPAM]);function z(ja,ka,la,ma){var na=[],oa=false,pa=false,qa=(ka||[]).filter(function(xa){var ya=xa.filter||k.ALL;return (xa.folder==la||!xa.folder&&la==p.INBOX)&&ya==ma;}),ra=ja._threadlistOrderMap[la][ma].getAllResources(),sa;qa.forEach(function(xa){na=na.concat(xa.thread_ids);if(xa.error){if(xa.end>ra.length)pa=xa.error;}else{var ya=xa.end-xa.start;if(xa.thread_ids.length<ya)oa=true;}if(!sa||xa.end>sa)sa=xa.end;});da(ja,na,la,ma);if(oa){ja._threadlistOrderMap[la][ma].setReachedEndOfArray();}else if(pa){ja._threadlistOrderMap[la][ma].setError(pa);}else{var ta=ja._threadlistOrderMap[la][ma].getCurrentArraySize();if(sa&&ta<sa){var ua={},va=ra.concat(na),wa=va.filter(function(xa){var ya=ua[xa];ua[xa]=true;return ya;});if(wa.length){w.warn('duplicate_threads',{folder:la,expected_final_size:sa,actual_final_size:ta,duplicate_thread_ids:wa});ja._serverRequests.fetchThreadlistInfo(sa,wa.length,la,ma==k.ALL?null:ma);}}}}function aa(ja,ka){y.forEach(function(la){x.forEach(function(ma){z(ja,ka,la,ma);});});}function ba(ja,ka){var la={};y.forEach(function(ma){la[ma]={};x.forEach(function(na){la[ma][na]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});ka.forEach(function(ma){if(ma.is_forward)return;var na=ma.thread_id,oa=ea(ja,na),pa=fa(ja,na);function qa(){pa.forEach(function(sa){if(!v(x,sa))return;la[oa][sa].to_add.push(na);if(!ja._threadlistOrderMap[oa][sa].hasReachedEndOfArray()&&!ja._threadlistOrderMap[oa][sa].hasResource(na))la[oa][sa].to_remove_if_last_after_add[na]=true;});}function ra(sa){if(v(x,sa))if(v(pa,sa)){la[oa][sa].to_add.push(na);}else la[oa][sa].to_remove.push(na);}if(!oa){if(ma.action_type===i.CHANGE_FOLDER||ma.action_type===i.CHANGE_ARCHIVED_STATUS)y.forEach(function(sa){if(sa!==oa)x.forEach(function(ta){ja._threadlistOrderMap[sa][ta].removeResources([na]);});});return;}switch(ma.action_type){case i.DELETE_THREAD:pa.forEach(function(sa){if(!v(x,sa))return;la[oa][sa].to_remove.push(na);});break;case i.CHANGE_ARCHIVED_STATUS:case i.CHANGE_FOLDER:qa();break;case i.CHANGE_READ_STATUS:ra(p.UNREAD);break;case i.USER_GENERATED_MESSAGE:case i.LOG_MESSAGE:pa.forEach(function(sa){if(!v(x,sa))return;if(ga(ja,na,oa,sa))la[oa][sa].to_add.push(na);});break;case i.CHANGE_FLAG:ra(q.FLAG);break;}});y.forEach(function(ma){x.forEach(function(na){var oa=ja._threadlistOrderMap[ma][na];da(ja,la[ma][na].to_add,ma,na);for(var pa=oa.getCurrentArraySize()-1;pa>=0;pa--){var qa=oa.getResourceAtIndex(pa);if(!la[ma][na].to_remove_if_last_after_add[qa])break;la[ma][na].to_remove.push(qa);}oa.removeResources(la[ma][na].to_remove);});});}function ca(ja,ka){var la={};y.forEach(function(ma){la[ma]={};x.forEach(function(na){la[ma][na]=[];});});ka.forEach(function(ma){var na=ea(ja,ma.thread_id),oa=fa(ja,ma.thread_id);if(na)oa.forEach(function(pa){if(ga(ja,ma.thread_id,na,pa))la[na][pa].push(ma.thread_id);});});y.forEach(function(ma){x.forEach(function(na){if(la[ma][na].length>0)da(ja,la[ma][na],ma,na);});});}function da(ja,ka,la,ma){ma=ma||k.ALL;ja._threadlistOrderMap[la][ma].addResources(ka);y.forEach(function(na){if(na!=la)ja._threadlistOrderMap[na][ma].removeResources(ka);});}function ea(ja,ka){var la=ja._threads.getThreadMetaNow(ka),ma=null;if(!la){ma='No thread metadata';}else if(!la.folder)ma='No thread folder';if(ma){var na={error:ma,tid:ka};w.warn('no_thread_folder',na);return null;}var oa=la.folder;if(la.is_archived)oa=p.ACTION_ARCHIVED;if(ja._threadlistOrderMap[oa]){return oa;}else return null;}function fa(ja,ka){var la=ja._threads.getThreadMetaNow(ka),ma=[k.ALL];if(!la){var na={error:'no_thread_metadata',tid:ka};w.warn('no_thread_metadata',na);return [];}if(la.unread_count)ma.push(p.UNREAD);if(!la.is_canonical)ma.push(p.GROUPS);var oa=la.page_thread_info;if(oa&&oa.flagged)ma.push(q.FLAG);return ma;}function ga(ja,ka,la,ma){var na=ja._threads.getThreadMetaNow(ka);return !!(na&&na.timestamp&&ea(ja,ka)==la&&v(fa(ja,ka),ma));}function ha(ja){this._fbid=ja;this._serverRequests=s.getForFBID(this._fbid);this._threadIDMap=o.getForFBID(this._fbid);this._threadInformer=t.getForFBID(this._fbid);this._threads=u.getForFBID(this._fbid);this._dispatcher=j.getForFBID(this._fbid);this._threadlistOrderMap={};y.forEach((function(ka){this._threadlistOrderMap[ka]={};x.forEach((function(la){this._threadlistOrderMap[ka][la]=new r((function(ma){return this._threads.getThreadMetaNow(ma).timestamp;}).bind(this),function(ma,na){return na-ma;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}).bind(this));}).bind(this));this._dispatcher.subscribe('update-threadlist',(function(ka,la){if(!ia(la))return;var ma=la.ordered_threadlists;if(ma&&ma.length){aa(this,ma);}else{var na=(la.actions||[]).filter(function(oa){return oa.thread_id;});ca(this,la.threads||[]);ba(this,na);}this._threadInformer.updatedThreadlist();}).bind(this));}Object.assign(ha.prototype,{getThreadlistOrderMap:function(ja,ka){if(!this._threadlistOrderMap[ja][ka]){x=x.concat([ka]);y.forEach((function(la){this._threadlistOrderMap[la][ka]=new r((function(ma){return this._threads.getThreadMetaNow(ma).timestamp;}).bind(this),function(ma,na){return na-ma;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}).bind(this));}return this._threadlistOrderMap[ja][ka];},getThreadlist:function(ja,ka,la,ma,na,oa){return this.getFilteredThreadlist(ja,ka,la,k.ALL,ma,na,oa);},getFilteredThreadlist:function(ja,ka,la,ma,na,oa,pa){var qa=this.getThreadlistOrderMap(la,ma),ra=qa.executeOrEnqueue(ja,ka,na,oa),sa=qa.getUnavailableResources(ra),ta=qa.getError(ja,ka,oa);if(sa.length||ta){if(qa.getCurrentArraySize()<ja){var ua={start:ja,limit:ka,filter:ma,resources_size:qa.getCurrentArraySize()};w.warn('range_with_gap',ua);}qa.setError(false);this._serverRequests.fetchThreadlistInfo(qa.getCurrentArraySize(),sa.length,la,ma==k.ALL?null:ma,pa);}return ra;},getThreadlistUntilTimestamp:function(ja,ka,la){la=la||k.ALL;return this.getThreadlistOrderMap(ka,la).getElementsUntil(ja);},getAvailableThreadlistNow:function(ja,ka){ka=ka||k.ALL;return this.getThreadlistOrderMap(ja,ka).getAllResources();},getThreadCount:function(ja,ka){ka=ka||k.ALL;return this.getThreadlistOrderMap(ja,ka).getCurrentArraySize();},hasLoadedThreadlist:function(ja,ka){ka=ka||k.ALL;return this.getThreadlistOrderMap(ja,ka).hasReachedEndOfArray();},unsubscribe:function(ja,ka,la){la=la||k.ALL;this.getThreadlistOrderMap(ka,la).unsubscribe(ja);}});Object.assign(ha,n);function ia(ja){switch(ja.payload_source){case m.CLIENT_CHANGE_ARCHIVED_STATUS:case m.CLIENT_CHANGE_READ_STATUS:case m.CLIENT_CHANGE_FOLDER:case m.CLIENT_CHANNEL_MESSAGE:case m.CLIENT_DELETE_MESSAGES:case m.CLIENT_DELETE_THREAD:case m.CLIENT_SEND_MESSAGE:case m.SERVER_SEND_MESSAGE:case m.SERVER_FETCH_THREADLIST_INFO:case m.SERVER_THREAD_SYNC:return true;case m.SERVER_INITIAL_DATA:return !!ja.ordered_threadlists;default:return false;}}f.exports=ha;},null);
__d('MercuryStateCheck',['Arbiter','ChannelConstants','LogHistory','MercuryAPIArgsSource','MercuryFolders','MercuryOrderedThreadlist','MercuryServerRequests','MercurySingletonMixin','MessagingTag','URI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=j.getInstance('mercury_state_check');function s(t){'use strict';this.$MercuryStateCheck1=t;this.$MercuryStateCheck2=n.getForFBID(this.$MercuryStateCheck1);this.$MercuryStateCheck3=m.getForFBID(this.$MercuryStateCheck1);h.subscribe(i.ON_INVALID_HISTORY,this.$MercuryStateCheck4.bind(this,i.ON_INVALID_HISTORY));e(['ChannelConnection'],(function(u){u.subscribe(u.CONNECTED,(function(v,w){if(!w.init)this.$MercuryStateCheck5(u.CONNECTED);}).bind(this));}).bind(this));}s.prototype.$MercuryStateCheck4=function(t){'use strict';var u;if(q.getRequestURI().getPath().search(/messages/)!==-1){u=l.getSupportedFolders();}else u=[p.INBOX];r.debug('check',{folders:u,source:t});this.$MercuryStateCheck2.fetchMissedMessages(u,k.MERCURYSYNC);};s.prototype.$MercuryStateCheck5=function(t){'use strict';var u=this.$MercuryStateCheck3.getAvailableThreadlistNow(p.INBOX)||[];u=u.slice(0,20);r.debug('full_check',{threads:u,source:t});this.$MercuryStateCheck2.fetchThreadData(u,k.MERCURYSYNC);this.$MercuryStateCheck4(t);};Object.assign(s,o);f.exports=s;},null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercurySingletonMixin','MercuryThreadInfo','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=o.MAX_UNSEEN_COUNT,x='unseen_thread_hash',y='unseen_thread_list',z=j.getInstance('mercury_unseen_state');function aa(pa){this._fbid=pa;this._serverRequests=r.getForFBID(this._fbid);this._threadIDMap=p.getForFBID(this._fbid);this._threads=t.getForFBID(this._fbid);this._threadInformer=s.getForFBID(this._fbid);this._dispatcher=l.getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._pendingServerUpdates=false;this._unseenResources=new i();this._dispatcher.subscribe('update-unseen',(function(qa,ra){ga(this,ra);}).bind(this));this._dispatcher.subscribe('update-thread-ids',(function(qa,ra){ma(this,ra);}).bind(this));}Object.assign(aa.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){z.error('unguarded_unseen_count_fetch',{});return 0;}return fa(this)||0;},exceedsMaxCount:function(){return this._maxCount||fa(this)>w;},markAsSeen:function(){var pa=fa(this);if(pa===null){this._pendingServerUpdates=true;}else if(pa>0||this._maxCount){this._serverRequests.markSeen();var qa=this._serverRequests.getLastActionTimestamp();ha(this,qa,[]);}}});Object.assign(aa,m);function ba(pa,qa,ra){var sa={};sa[qa]=0;ja(pa,sa,ra);}function ca(pa,qa){pa._unseenResources.setResource(x,qa);pa._unseenResources.setResource(y,Object.keys(qa));}function da(pa,qa){var ra=pa._unseenResources.executeOrEnqueue(x,qa),sa=pa._unseenResources.getUnavailableResources(ra);if(sa.length)pa._serverRequests.fetchUnseenThreadIDs();}function ea(pa){return pa._unseenResources.getResource(x);}function fa(pa){var qa=pa._unseenResources.getResource(y);if(qa){return qa.length;}else return pa._initialUnseenCount;}function ga(pa,qa){var ra=oa(qa);if(qa.unseen_thread_fbids){qa.unseen_thread_fbids.forEach(function(cb){if(cb.folder!=q.INBOX)return;var db=cb.thread_fbids||[];db=db.concat(cb.other_user_fbids||[]);var eb=la(pa,db),fb=pa._lastSeenTimestamp;if(ra&&ra.seen_timestamp)fb=ra.seen_timestamp;ha(pa,fb,eb);if(ra&&ra.unseen_count>w)pa._maxCount=true;});}else if(ra&&ra.seen_timestamp){pa._lastSeenTimestamp=ra.seen_timestamp;if(ra.unseen_count>w){pa._maxCount=true;ca(pa,{});}else{pa._initialUnseenCount=ra.unseen_count;if(pa._initialUnseenCount===0)ca(pa,{});}}else{if(pa._maxCount)return;var sa=qa.actions;if(!sa||!sa.length)return;var ta={},ua={};for(var va=0;va<sa.length;va++){var wa=sa[va];if(wa.is_forward)continue;var xa=wa.action_type,ya=wa.other_user_fbid?wa.other_user_fbid:wa.thread_fbid,za=wa.thread_id?wa.thread_id:ya;if(xa==k.MARK_THREAD_SEEN){ba(pa,za,wa.persistent);continue;}if(!na(pa,wa))continue;if(xa==k.USER_GENERATED_MESSAGE||xa==k.LOG_MESSAGE){var ab=ta[za]?wa.timestamp>ta[za]:false,bb=ab||!ta[za];if(wa.is_unread&&bb)pa._threads.getThreadMeta(za,function(cb){var db=false;if(cb&&cb.last_read_timestamp)if(cb.last_read_timestamp>=wa.timestamp)db=true;if(!n.isMuted(cb)&&!db)ta[za]=wa.timestamp;});}else if(xa==k.CHANGE_READ_STATUS&&wa.mark_as_read)ua[za]=wa.timestamp;}ia(pa,ta);ja(pa,ua);}if(pa._pendingServerUpdates){pa._pendingServerUpdates=false;pa.markAsSeen();}}function ha(pa,qa,ra){var sa=ea(pa);if(sa===undefined||qa>pa._lastSeenTimestamp||pa._maxCount){pa._lastSeenTimestamp=qa;ra=ra||[];if(ra.length<=w)pa._maxCount=false;var ta={},ua=ea(pa)||{};for(var va in ua)if(ua[va]!==true){var wa=ua[va];if(ka(pa,wa))ta[va]=wa;}var xa=Object.assign(u(ra,true),ta);ca(pa,xa);pa._threadInformer.updatedUnseenState();}}function ia(pa,qa){if(pa._maxCount)return;var ra={},sa=false;for(var ta in qa){var ua=qa[ta];if(ka(pa,ua)){ra[ta]=ua;sa=true;}}if(!sa)return;da(pa,function(va){for(var wa in ra){var xa=ra[wa];if(!va[wa]&&ka(pa,xa))va[wa]=ra[wa];}ca(pa,va);pa._threadInformer.updatedUnseenState();});}function ja(pa,qa,ra){var sa=false;if(!v(qa))sa=true;if(sa)da(pa,function(ta){var ua=false;for(var va in qa){var wa=qa[va],xa=wa>=ta[va];if(ta[va]&&(!wa||xa)){delete ta[va];ua=true;}}if(ua){ca(pa,ta);pa._threadInformer.updatedUnseenState();if(ra&&fa(pa)===0)pa._serverRequests.markSeen();}});}function ka(pa,qa){return qa>pa._lastSeenTimestamp;}function la(pa,qa){return qa.map(pa._threadIDMap.convertThreadIDIfAvailable,pa._threadIDMap);}function ma(pa,qa){var ra=ea(pa);if(!ra)return;for(var sa in qa){var ta=qa[sa];if(ra[sa]){ra[ta]=ra[sa];delete ra[sa];}}ca(pa,ra);}function na(pa,qa){var ra=qa.thread_id?pa._threads.getThreadMetaNow(qa.thread_id):null,sa=ra?h.getFromMeta(ra):qa.folder;return sa===q.INBOX||sa===undefined;}function oa(pa){var qa=pa.message_counts||[];for(var ra=0;ra<qa.length;ra++)if(qa[ra].folder==q.INBOX)return qa[ra];return null;}f.exports=aa;},null);
__d('MercurySyncDeliveryReceiptTransformer',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {delivery_receipts:[{other_user_fbid:i.threadKey.otherUserFbId?i.threadKey.otherUserFbId:'',thread_fbid:i.threadKey.threadFbId?i.threadKey.threadFbId:'',time:parseInt(i.deliveredWatermarkTimestampMs,10)}]};}f.exports={transform:h};},null);
__d('MercurySyncMarkReadTransformer',['MercuryActionType','MessagingTag'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k){return k.threadKeys.map(function(l){return {action_type:h.CHANGE_READ_STATUS,action_id:null,other_user_fbid:l.otherUserFbId,thread_fbid:l.threadFbId,mark_as_read:true,timestamp:parseInt(k.watermarkTimestamp,10),folder:i.INBOX};});}f.exports={transform:j};},null);
__d('MercuryTimestamp',['fbt','formatDate','MercuryTimePassed'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=86400000,l=6*k,m={getFormatedTimestamp:function(n){var o=n/1000;return m.getFormattedTimestampByBucket(o,this.getTimeBucket(n));},getFormattedTimestampByBucket:function(n,o){switch(o){case j.TODAY:return {absolute:h._("Today"),relative:i(n,'g:ia')};case j.WEEK_AGO:return {absolute:i(n,'l'),relative:i(n,'D')};case j.CURRENT_YEAR:return {absolute:i(n,'F j'),relative:i(n,'M j')};default:return {absolute:i(n,'F j, Y'),relative:i(n,'n/j/y')};}},getTimeBucket:function(n){var o=new Date(n),p=new Date(),q=new Date(p.getFullYear(),p.getMonth(),p.getDate());if(q<o){return j.TODAY;}else if(q-l<o){return j.WEEK_AGO;}else if(q.getFullYear()===o.getFullYear()){return j.CURRENT_YEAR;}else return j.OTHER_YEAR;},getPreciseTimestamp:function(n){return i(new Date(n),m.getPreciseFormat(n));},getPreciseFormat:function(n){var o=m.getTimeBucket(n);switch(o){case j.TODAY:return 'g:ia';case j.WEEK_AGO:return 'l g:ia';case j.CURRENT_YEAR:return 'F jS, g:ia';case j.OTHER_YEAR:default:return 'F j, Y g:i a';}}};f.exports=m;},null);
__d('MercurySyncNewMessageTransformer',['IrisProtocolMessageLifetime','MercuryActionType','MercuryIDs','MercuryTimestamp','MessagingTag'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();function m(n,o){var p=parseInt(o.messageMetadata.timestamp,10),q=k.getFormatedTimestamp(p),r=[];if(o.attachments)r=o.attachments.map(function(t){return t.mercury;});var s=o.messageMetadata.tags?o.messageMetadata.tags[0]:undefined;return {message_id:o.messageMetadata.messageId,threading_id:null,offline_threading_id:o.messageMetadata.offlineThreadingId,author:j.getParticipantIDFromUserID(o.messageMetadata.actorFbId),author_email:o.messageMetadata.actorFbId+'@facebook.com',ephemeral_ttl_mode:o.ttl?h[o.ttl]:0,timestamp:p,timestamp_absolute:q.absolute,timestamp_relative:q.relative,timestamp_datetime:q.relative,timestamp_time_passed:k.getTimeBucket(p),is_unread:n!==o.messageMetadata.actorFbId,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,forward_count:0,forward_message_ids:[],source:s,is_spoof_warning:false,folder:l.INBOX,thread_fbid:o.messageMetadata.threadKey.threadFbId,other_user_fbid:o.messageMetadata.threadKey.otherUserFbId,body:o.body!==undefined?o.body:'',html_body:null,subject:null,has_attachment:r.length>0,attachments:r,ranges:undefined,thread_id:null,action_id:null,action_type:i.USER_GENERATED_MESSAGE,is_from_iris:true};}f.exports={transform:m};},null);
__d('MercurySyncReadReceiptTransformer',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j=parseInt(i.actionTimestampMs,10),k=i.threadKey.otherUserFbId||i.actorFbId,l=i.threadKey.otherUserFbId||i.threadKey.threadFbId,m={roger:{}};m.roger[l]={};m.roger[l][k]=j;return m;}f.exports={transform:h};},null);
__d('MercurySyncParticipantLeftGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();function l(m,n){var o=k.transform(m,n);o.action_type=h.LOG_MESSAGE;o.log_message_body=n.messageMetadata.adminText;o.log_message_data={removed_participants:[i.getParticipantIDFromUserID(n.leftParticipantFbId)]};o.log_message_type=j.UNSUBSCRIBE;return o;}f.exports={transform:l};},null);
__d('MercurySyncParticipantsAddedToGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();function l(m,n){var o=k.transform(m,n);o.action_type=h.LOG_MESSAGE;o.log_message_body=n.messageMetadata.adminText;o.log_message_data={added_participants:n.addedParticipants.map(function(p){return (i.getParticipantIDFromUserID(p.userFbId));})};o.log_message_type=j.SUBSCRIBE;return o;}f.exports={transform:l};},null);
__d('MercurySyncThreadNameTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();function k(l,m){var n=j.transform(l,m);n.action_type=h.LOG_MESSAGE;n.log_message_body=m.messageMetadata.adminText;n.log_message_data={name:m.name};n.log_message_type=i.THREAD_NAME;return n;}f.exports={transform:k};},null);
__d('MercurySyncReplaceMessageTransformer',['MercuryActionType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k,l){l=Object.assign({},l.newMessage,l);return Object.assign(i.transform(k,l),{action_type:h.REPLACE_MESSAGE,replaced_message_id:l.replacedMessageId});}f.exports={transform:j};},null);
__d('MercurySyncDeltaTypes',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={DeliveryReceipt:'DeliveryReceipt',MarkRead:'MarkRead',NewMessage:'NewMessage',ParticipantLeftGroupThread:'ParticipantLeftGroupThread',ParticipantsAddedToGroupThread:'ParticipantsAddedToGroupThread',ReadReceipt:'ReadReceipt',ReplaceMessage:'ReplaceMessage',ThreadName:'ThreadName'};f.exports=h;},null);
__d('MercurySyncDispatcher',['Arbiter','Map','MercuryConfig','MercuryDelayedDispatcher','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySyncDeliveryReceiptTransformer','MercurySyncMarkReadTransformer','MercurySyncNewMessageTransformer','MercurySyncReadReceiptTransformer','MercurySyncParticipantLeftGroupThreadTransformer','MercurySyncParticipantsAddedToGroupThreadTransformer','MercurySyncThreadNameTransformer','MercurySyncReplaceMessageTransformer','MercurySyncDeltaTypes','MercurySingletonProvider'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){'use strict';if(c.__markCompiled)c.__markCompiled();x.getForFBID=function(z){return y.getForFBID(z);};x.get=function(){return y.get();};function x(z){this.$MercurySyncDispatcher1=z;this.$MercurySyncDispatcher2=k.getForFBID(this.$MercurySyncDispatcher1);this.$MercurySyncDispatcher3=m.getForFBID(this.$MercurySyncDispatcher1);h.subscribe('channel/message:delta',(function(aa,ba){var ca=ba&&ba.obj&&ba.obj.delta;if(!ca)return;this.process(ca);}).bind(this));}x.prototype.process=function(z){var aa;switch(z['class']){case v.NewMessage:if(!this.$MercurySyncDispatcher4(z))break;aa=p.transform(this.$MercurySyncDispatcher1,z);this.$MercurySyncDispatcher5(aa);break;case v.ReplaceMessage:if(!this.$MercurySyncDispatcher4(z))break;aa=u.transform(this.$MercurySyncDispatcher1,z);this.$MercurySyncDispatcher5(aa);break;case v.DeliveryReceipt:if(!j.WWWSyncDeliveryReceipt)break;aa=n.transform(z);this.$MercurySyncDispatcher3.handleUpdate(aa);break;case v.MarkRead:if(!j.WWWSyncMarkRead)break;aa=o.transform(z);this.$MercurySyncDispatcher6(aa);break;case v.ParticipantLeftGroupThread:if(!j.WWWSyncMsgLog)break;aa=r.transform(this.$MercurySyncDispatcher1,z);this.$MercurySyncDispatcher5(aa);break;case v.ParticipantsAddedToGroupThread:if(!j.WWWSyncMsgLog)break;aa=s.transform(this.$MercurySyncDispatcher1,z);this.$MercurySyncDispatcher5(aa);break;case v.ThreadName:if(!j.WWWSyncMsgLog)break;aa=t.transform(this.$MercurySyncDispatcher1,z);this.$MercurySyncDispatcher5(aa);break;case v.ReadReceipt:if(!j.WWWSyncReadReceipt)break;aa=q.transform(z);this.$MercurySyncDispatcher3.handleUpdate(aa);break;default:break;}};x.prototype.$MercurySyncDispatcher4=function(z){var aa=!!z.stickerId||z.attachments&&!!z.attachments.length;if(!aa&&!j.WWWSyncMsgText){return false;}else if(aa&&!j.WWWSyncMsgAttach)return false;return true;};x.prototype.$MercurySyncDispatcher5=function(z){var aa=z.other_user_fbid||z.thread_fbid;this.$MercurySyncDispatcher2.handleUpdateWaitForThread({actions:[z],payload_source:l.CLIENT_CHANNEL_MESSAGE},aa);};x.prototype.$MercurySyncDispatcher6=function(z){this.$MercurySyncDispatcher3.handleUpdate({actions:z,payload_source:l.CLIENT_CHANNEL_MESSAGE});};var y=new w(x);f.exports=x;},null);
__d('ChatBehavior',['Arbiter','AvailableList','AvailableListConstants','MercuryConstants'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryConstants').ChatNotificationConstants,l=false,m=i.getWebChatNotification&&i.getWebChatNotification(),n=l,o=true,p=Object.assign(new h(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return m!==k.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return n;},showsTabUnreadUI:function(){return o;}});function q(){p.inform(p.ON_CHANGED);}i.subscribe&&i.subscribe(j.ON_CHAT_NOTIFICATION_CHANGED,function(){var r=m,s=i.getWebChatNotification();m=s;if(r!=s)q();});h.subscribe('chat/set_does_page_occlude_tabs',function(r,s){n=!!s;q();});h.subscribe('chat/set_show_tab_unread_ui',function(r,s){o=!!s;q();});f.exports=p;},null);
__d('ChatDispatcher',['Dispatcher','LogHistory'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j,k;'use strict';var l=i.getInstance('chat_dispatcher');j=babelHelpers.inherits(m,h);k=j&&j.prototype;m.prototype.dispatch=function(n){l.debug('action',n);k.dispatch.call(this,n);};function m(){j.apply(this,arguments);}f.exports=new m();},null);
__d('ChatCookieInterface',['ChatConfig','InitialServerTime','LogHistory','PresenceState','PresenceUtil','areJSONRepresentationsEqual'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=j.getInstance('chat_cookie'),o=i.serverTime,p=h.get('tab_max_load_age')||3600000,q=o-p,r={store:function(v,w){if(v.uct2==w.lastChangeTime)return v;var x=u(v,w),y={};if(!x){y.old_tabs=v&&v.t2&&JSON.stringify(v.t2);y.old_promoted=v&&v.lm2;y.old_time=v&&v.uct2;y.old_reason=v&&v.tr;y.old_window=v&&v.tw;var z=[];w.tabs.forEach(function(aa){if(!aa.fragile){var ba={i:aa.id,si:aa.server_id};if(aa.raised)ba.r=1;z.push(ba);}});v.t2=z;v.lm2=w.promotedID;v.uct2=w.lastChangeTime;v.tr=w.lastChangeReason;v.tw=l.getSessionID();y.new_tabs=JSON.stringify(v.t2);y.new_promoted=v.lm2;y.new_time=v.uct2;y.new_reason=v.tr;y.new_window=v.tw;n.debug('store',y);}else{y.tabs=v&&v.t2&&JSON.stringify(v.t2);y.promoted=v&&v.lm2;y.time=v&&v.uct2;y.reason=v&&v.tr;y.window=v&&v.tw;y.last_change_time=w.lastChangeTime;y.last_change_reason=w.lastChangeReason;y.min_change_time=q;n.warn('store_bad_state',y);}return v;},load:function(v,w){if(!v){n.warn('load_bad_state');return false;}var x=u(v,w);if(!x||x===w.lastChangeTime)return false;var y={};y.old_tabs=JSON.stringify(w.tabs);y.old_promoted=w.promotedID;y.old_time=w.lastChangeTime;y.old_reason=w.lastChangeReason;y.window_id=l.getSessionID();y.cookie_tabs=v&&v.t2&&JSON.stringify(v.t2);y.cookie_promoted=v&&v.lm2;y.cookie_time=v&&v.uct2;y.cookie_reason=v&&v.tr;y.cookie_window=v&&v.tw;w.lastChangeTime=x;w.lastChangeReason='load';var z=s(w,v.t2,v.lm2||null);y.load_result=z;y.new_tabs=JSON.stringify(w.tabs);y.new_promoted=w.promotedID;y.new_time=w.lastChangeTime;y.new_reason=w.lastChangeReason;var event='load';if(!w.isInitialized)event+='_init';n.log(event,y);return z;}};function s(v,w,x){var y;if(!t(v,w,x))return false;var z=v.tabs.filter(function(ca){return !!ca.fragile;}),aa={};v.promotedID=null;v.tabs=w.map(function(ca){var da={id:ca.i,server_id:ca.si};if(da.id==x)v.promotedID=da.id;if(ca.r)da.raised=true;aa[da.id]=da;return da;});v.tabs=v.tabs.filter(function(ca){return !!ca;});if(v.localRaised)for(var ba in v.localRaised)if(!aa[ba]||!aa[ba].raised)delete v.localRaised[ba];z=z.filter(function(ca){return !aa[ca.id];});(y=v.tabs).push.apply(y,z);return true;}function t(v,w,x){if(x!=v.promotedID)return true;var y=v.tabs.filter(function(ba){return !ba.fragile;});if(w.length!=y.length)return true;for(var z=0,aa=w.length;z<aa;z++)if(!m(w[z],y[z]))return true;return false;}function u(v,w){var x=k.verifyNumber(v.uct2);if(!x||typeof x!=='number'){n.warn('bad_cookie_version',babelHelpers._extends({},v));return null;}if(x<w.lastChangeTime||x<q)return null;return x;}f.exports=r;},null);
__d('ChatTabActions',['ChatDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=i({CLOSE_TAB:null,CLOSE_ALL_TABS:null,CLOSE_FRAGILE_TABS:null,LOWER_TAB:null,OPEN_FRAGILE_TAB:null,OPEN_TAB:null,PERSIST_LOCAL_STATE:null,PROMOTE_TAB:null,RAISE_TAB:null}),k={Types:j,closeTab:function(l,m){h.dispatch({actionType:j.CLOSE_TAB,reason:m,threadID:l});},closeAllTabs:function(){h.dispatch({actionType:j.CLOSE_ALL_TABS});},closeFragileTabs:function(){h.dispatch({actionType:j.CLOSE_FRAGILE_TABS});},lowerTab:function(l){h.dispatch({actionType:j.LOWER_TAB,threadID:l});},openFragileTab:function(l){h.dispatch({actionType:j.OPEN_FRAGILE_TAB,threadID:l});},openTab:function(l){h.dispatch({actionType:j.OPEN_TAB,threadID:l});},persistLocalState:function(){h.dispatch({actionType:j.PERSIST_LOCAL_STATE});},promoteTab:function(l){h.dispatch({actionType:j.PROMOTE_TAB,threadID:l});},raiseTab:function(l,m,n){h.dispatch({actionType:j.RAISE_TAB,signatureID:n,threadID:l,userAction:m});}};f.exports=k;},null);
__d('MercuryTimestampTracker',['MercuryActionType','MercuryPayloadSource','MercurySingletonMixin','MercuryDispatcher'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(m){this._fbid=m;this._dispatcher=k.getForFBID(this._fbid);this._lastTimestamp=0;this._dispatcher.subscribe('update-messages',(function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==i.CLIENT_SEND_MESSAGE||o.payload_source==i.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==h.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}).bind(this));}Object.assign(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});Object.assign(l,j);f.exports=l;},null);
__d('ChatTabModel',['Arbiter','ChatBehavior','ChatDispatcher','ChatConfig','ChatCookieInterface','ChatTabActions','EventEmitter','InitialServerTime','LogHistory','JSLogger','MercuryAssert','MercuryIDs','MercuryLocalIDs','PresenceState','PresenceUtil','MercuryThreadIDMap','MercuryThreads','MercuryTimestampTracker'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=c('MercuryThreadIDMap').get(),x=c('MercuryThreads').get(),y=c('MercuryTimestampTracker').get(),z=o.serverTime,aa=k.get('tab_max_load_age')||3600000,ba=20,ca=new n(),da=p.getInstance('chat_tab_model'),ea={tabs:[],promotedID:null,lastChangeTime:0,lastChangeReason:null,isInitialized:false,localRaised:null};function fa(ab){var bb=l.load(ab,ea);bb&&ja();return bb;}function ga(ab,bb,cb){var db=fa(u.get());if(bb===undefined||bb>ea.lastChangeTime){if(ab()){db=true;ea.lastChangeReason=cb||null;ia(bb);}}else da.error('rejected',{change_time:bb,state_time:ea.lastChangeTime});db&&ha();}function ha(){if(ea.isInitialized)ca.emit('change');}function ia(ab){if(ab===undefined)ab=Math.max(y.getLastUserMessageTimestamp()||1,ea.lastChangeTime+1);ea.lastChangeTime=ab;u.doSync();}function ja(ab){var bb=ea.tabs.length-ba;if(bb>0)ea.tabs=ea.tabs.filter(function(cb){return cb.raised||cb.id==ab||bb--<=0;});if(bb>0)ea.tabs=ea.tabs.filter(function(cb){return (cb.id==ea.promotedID||cb.id==ab||bb--<=0);});}function ka(ab){for(var bb=0;bb<ea.tabs.length;bb++)if(ea.tabs[bb].id==ab)return bb;return -1;}function la(ab,bb){var cb=x.getThreadMetaNow(ab);if(!cb)return false;if(cb.is_canonical_user){return oa(ab,bb);}else{var db=na(ab);if(db)w.getServerIDFromClientID(ab,function(eb){if(ra(ab,eb)){ia();ha();}});return db;}}function ma(ab){r.isThreadID(ab);if(na(ab))ha();}function na(ab){if(ka(ab)===-1){ea.tabs.push({id:ab,fragile:true});da.log('open_fragile_tab',{tabs:JSON.stringify(ea.tabs),opened:ab,window_id:v.getSessionID()});return true;}return false;}function oa(ab,bb){var cb=ka(ab);if(cb!=-1)if(ea.tabs[cb].fragile){ea.tabs.splice(cb,1);}else{bb&&(ea.tabs[cb].signatureID=bb);return true;}for(var db=0;db<=ea.tabs.length;db++)if(db==ea.tabs.length||ea.tabs[db].fragile){ea.tabs.splice(db,0,{id:ab,signatureID:bb});ja(ab);da.log('open_tab',{tabs:JSON.stringify(ea.tabs),opened:ab,window_id:v.getSessionID()});return true;}}function pa(ab,bb,cb){r.isThreadID(ab);var db=false;if(ea.localRaised&&bb){ea.localRaised[ab]=true;db=true;}ga(function(){if(la(ab,cb))db=true;var eb=ka(ab);if(eb!=-1&&!ea.tabs[eb].raised){ea.tabs[eb].raised=true;db=true;da.log('raise_tab',{tabs:JSON.stringify(ea.tabs),raised:ab,window_id:v.getSessionID()});}return db;});}function qa(ab){if(ka(ab)!==-1&&ea.promotedID!==ab){ea.promotedID=ab;return true;}return false;}function ra(ab,bb){var cb=ka(ab);if(cb!=-1&&ea.tabs[cb].fragile){var db=ea.tabs[cb];db.fragile=s.isLocalThread(ab);db.server_id=bb;var eb=[];ea.tabs.forEach(function(fb){if(fb.id!=ab){if(db&&fb.fragile){eb.push(db);db=null;}eb.push(fb);}});if(db)eb.push(db);ea.tabs=eb;da.log('make_permanent',{tabs:JSON.stringify(ea.tabs),tab_id:ab,window_id:v.getSessionID()});return true;}return false;}function sa(ab,bb){r.isThreadID(ab);var cb=false;if(ea.localRaised){delete ea.localRaised[ab];cb=true;}ga(function(){if(ta(ab))cb=true;return cb;},undefined,bb);}function ta(ab){var bb=ka(ab);if(ab==ea.promotedID)ea.promotedID=null;if(bb!=-1){ea.tabs.splice(bb,1);da.log('close_tab',{tabs:JSON.stringify(ea.tabs),closed:ab,window_id:v.getSessionID()});return true;}return false;}function ua(){if(ea.tabs.length){da.log('close_all_tabs',{closed_tabs:JSON.stringify(ea.tabs),window_id:v.getSessionID()});ea.tabs=[];ea.promotedID=null;if(ea.localRaised)ea.localRaised={};ia();ha();}}function va(){var ab=[];for(var bb=0;bb<ea.tabs.length;bb++)if(ea.tabs[bb].fragile&&!x.isNewEmptyLocalThread(ea.tabs[bb].id)){ab.push(ea.tabs[bb]);ea.tabs.splice(bb);ha();break;}da.log('close_fragile_tabs',{tabs:JSON.stringify(ea.tabs),fragile_closed:ab,window_id:v.getSessionID()});}function wa(ab){r.isThreadID(ab);var bb=false;if(ea.localRaised){delete ea.localRaised[ab];bb=true;}ga(function(){var cb=ka(ab);if(cb!=-1&&ea.tabs[cb].raised){delete ea.tabs[cb].raised;da.log('lower_tab',{tabs:JSON.stringify(ea.tabs),lowered:ab,window_id:v.getSessionID()});bb=true;}return bb;});}function xa(){if(ea.localRaised){ga(function(){var ab=false;ea.tabs.forEach(function(bb){if(bb.raised!=ea.localRaised[bb.id]){ab=true;if(ea.localRaised[bb.id]){bb.raised=true;}else delete bb.raised;}});return ab;});da.log('persist_local_raise',{tabs:JSON.stringify(ea.tabs),window_id:v.getSessionID()});}}u.registerStateStorer(function(ab){return l.store(ab,ea);});u.registerStateLoader(function(ab){if(fa(ab))ha();});var ya={isTabPromoted:function(ab){if(ab)return ab==ea.promotedID;return false;},indexOf:function(ab){return ka(ab);},getTab:function(ab){r.isThreadID(ab);var bb=this.indexOf(ab);if(bb>-1){var cb=ea.tabs[bb];return babelHelpers._extends({},cb);}return null;},getEmptyTab:function(){var ab;for(var bb=0;bb<ea.tabs.length;bb++){ab=ea.tabs[bb].id;if(x.isNewEmptyLocalThread(ab))return ab;}ab=t.generateThreadID();x.createNewLocalThread(ab,[]);return ab;},get:function(){var ab=ea.tabs.map(function(bb){var cb=babelHelpers._extends({},bb);delete cb.fragile;if(ea.localRaised)cb.raised=ea.localRaised[cb.id];return cb;});return {tabs:ab,promoted:ea.promotedID};},promoteThreadInPlaceOfThread:function(ab,bb,cb,db){r.isThreadID(ab);r.isThreadID(bb);ga(function(){var eb=ka(ab),fb=ka(bb);if(db){ea.promotedID=ab;}else if(ea.promotedID===bb)return true;var gb=ea.tabs[eb];if(cb){r.isThreadID(cb);var hb=ka(cb),ib=ea.tabs[fb];ea.tabs[fb]=gb;ea.tabs.splice(eb,1);ea.tabs.splice(hb,0,ib);}else{ea.tabs[eb]=ea.tabs[fb];ea.tabs[fb]=gb;}return true;});},addListener:function(ab){return ca.addListener('change',ab);}};h.subscribe(q.DUMP_EVENT,function(ab,bb){bb.chat_tabs={promoted:ea.promotedID,tabs:ea.tabs.map(function(cb){return babelHelpers._extends({},cb);}),time:ea.lastChangeTime,max_load_age:aa};});function za(){var ab=i.ignoresRemoteTabRaise();if(ab&&!ea.localRaised){da.log('start_ignore_remote_raise');ea.localRaised={};ha();}else if(!ab&&ea.localRaised){da.log('stop_ignore_remote_raise');ea.localRaised=null;ha();}}j.register(function(ab){switch(ab.actionType){case m.Types.CLOSE_TAB:sa(ab.threadID,ab.reason);break;case m.Types.CLOSE_ALL_TABS:ua();break;case m.Types.CLOSE_FRAGILE_TABS:va();break;case m.Types.LOWER_TAB:wa(ab.threadID);break;case m.Types.OPEN_FRAGILE_TAB:ma(ab.threadID);break;case m.Types.OPEN_TAB:r.isThreadID(ab.threadID);ga(function(){return la(ab.threadID);});break;case m.Types.PERSIST_LOCAL_STATE:xa();break;case m.Types.PROMOTE_TAB:r.isThreadID(ab.threadID);ga(qa.bind(null,ab.threadID));break;case m.Types.RAISE_TAB:pa(ab.threadID,ab.userAction,ab.signatureID);break;}});i.subscribe(i.ON_CHANGED,za);za();fa(u.getInitial(),true);if(ea.lastChangeTime===0)ea.lastChangeTime=z-600000;ea.isInitialized=true;f.exports=ya;},null);
__d('ChatTabPresence',['AvailableList','ChatTabModel','MercuryIDs'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={};function l(m){var n=j.getUserIDFromThreadID(m);if(n)h.updateForID(n);}i.addListener(function(){var m=i.get();m.tabs.forEach(function(n){if(n.raised&&!k[n.id])l(n.id);});k={};m.tabs.forEach(function(n){if(n.raised)k[n.id]=true;});});f.exports={};},null);
__d('ChatTypeaheadBehavior',['BanzaiLogger','ChatOpenTab','ChatTypeaheadEvent','CSS','MercuryTypeaheadConstants','Parent','Rect','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(r,s){var t=m.byClass(r,"_4oes");if(t)k.conditionClass(t,"_5q83",s);}function q(r){'use strict';this._typeahead=r;this._loggedQuery=false;}q.prototype.enable=function(){'use strict';var r=this._typeahead;this._subscriptions=[r.subscribe('focus',(function(){this._loggedQuery=false;r.getData().refreshData();p(r.getElement(),true);}).bind(this)),r.subscribe('blur',(function(s){if(this._loggedQuery)h.log('ChatTypeaheadLoggerConfig',{event:j.ABANDONED_QUERY,max_results:r.getData().getMaxResults(),num_friend_results:r.getView().results.filter(function(t){return t.render_type===l.FRIEND_TYPE;}).length,query:r.getCore().value});r.getCore().reset();p(r.getElement(),false);this._loggedQuery=false;}).bind(this)),r.subscribe('respond',(function(s,t){if(!this._loggedQuery&&r.getCore().getValue().length>0){h.log('ChatTypeaheadLoggerConfig',{event:j.NEW_QUERY});this._loggedQuery=true;}if(t.value&&t.value===r.getCore().getValue()){if(!t.results.length){var u=t.value.toLowerCase(),v=r.getData().getQueryCache();if(!t.isAsync&&!v.hasOwnProperty(u))return;r.getView().showNoResults();}k.addClass(r.getElement(),'hasValue');}}).bind(this)),r.subscribe('reset',function(){k.removeClass(r.getElement(),'hasValue');}),r.subscribe('select',(function(s,t){var u=t.selected.uid;if(t.selected.mercury_thread&&!t.selected.mercury_thread.is_canonical)u=t.selected.mercury_thread.thread_fbid;r.getView().hide();h.log('ChatTypeaheadLoggerConfig',{event:j.RESULT_SELECTED,max_results:r.getData().getMaxResults(),result_type:t.selected.render_type,query:r.getCore().value});this._loggedQuery=false;i.openTabByType(u,t.selected.type,'typeahead');}).bind(this)),r.subscribe('highlight',function(s,t){if(t.index>=0){var u=r.getView().getItems()[t.index];if(u){var v=new n(u),w=u.offsetParent,x=v.boundWithin(new n(w)).getPositionVector();v.getPositionVector().sub(x).scrollElementBy(w);}}})];};q.prototype.disable=function(){'use strict';this._subscriptions.forEach(function(r){this._typeahead.unsubscribe(r);},this);this._subscriptions=null;};Object.assign(q.prototype,{_subscriptions:null});f.exports=q;},null);
__d('ChatActivity',['Event','Arbiter','AvailableList','AvailableListConstants','JSLogger','MercuryConfig','PresenceState','UserActivity'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=m.activity_limit||60000,q=m.idle_limit||1800000,r=m.idle_poll_interval||300000,s=l.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&aa-t<p);}var x=Object.assign(new i(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);n.doSync();}x.inform('activity');}j.subscribe(k.ON_AVAILABILITY_CHANGED,function(){if(!j.isUserIdle())u=Date.now();});h.listen(window,'focus',function(){v=true;y();});h.listen(window,'blur',function(){v=false;});o.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&n.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(n.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);n.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});i.subscribe(l.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});f.exports=x;},null);
__d('ChatMentionsNotifications',['fbt','CurrentUser','MercuryParticipants'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={notifyIfMessageToMe:function(l){var m='fbid:'+i.getID(),n=l.body;j.get(m,function(o){var p=new RegExp(o.short_name,"i");if(p.test(n))k._notify(l);});},_notify:function(l){var m=48,n=l.body;if(n.length>m)n=n.substr(0,m-3)+"...";new Notification(h._("You were tagged in a message!"),{body:n,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};f.exports=k;},null);
__d('ChatTabViewInstances',['Map'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('ChatSidebarActionTypes',['keyMirror'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=h({INIT:null,LOADED:null,SET_ENABLED:null,SHOW:null,TOGGLE:null});},null);
__d('ChatSidebarStore',['ChatDispatcher','ChatOptionsInitialData','ChatSidebarActionTypes','FluxStore','SidebarType','performanceAbsoluteNow'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o;'use strict';n=babelHelpers.inherits(p,k);o=n&&n.prototype;function p(){o.constructor.call(this,h);this.$ChatSidebarStore1={initialized:false,initTime:m(),loaded:false,enabled:!!i.sidebar_mode,visible:null};this.$ChatSidebarStore2={};}p.prototype.__onDispatch=function(q){var r=q.type;this.$ChatSidebarStore2=babelHelpers._extends({},this.$ChatSidebarStore1);switch(r){case j.INIT:if(!this.$ChatSidebarStore2.initialized)this.$ChatSidebarStore1.initTime=m();this.$ChatSidebarStore1.initialized=true;break;case j.LOADED:this.$ChatSidebarStore1.loaded=true;break;case j.SHOW:this.$ChatSidebarStore1.visible=q.sidebarType;break;case j.SET_ENABLED:this.$ChatSidebarStore1.enabled=q.enabled;this.$ChatSidebarStore1.visible=q.sidebarType;break;case j.TOGGLE:this.$ChatSidebarStore1.enabled=!this.$ChatSidebarStore1.enabled;this.$ChatSidebarStore1.visible=this.$ChatSidebarStore1.enabled?q.visible:l.BUDDYLIST;break;}for(var s in this.$ChatSidebarStore1)if(this.$ChatSidebarStore1.hasOwnProperty(s))if(this.$ChatSidebarStore1[s]!==this.$ChatSidebarStore2[s]){this.__emitChange();break;}};p.prototype.getPrevState=function(){return this.$ChatSidebarStore2;};p.prototype.getState=function(){return this.$ChatSidebarStore1;};p.prototype.isInitialized=function(){return this.$ChatSidebarStore1.initialized;};p.prototype.isLoaded=function(){return this.$ChatSidebarStore1.loaded;};p.prototype.isEnabled=function(){return this.$ChatSidebarStore1.enabled;};p.prototype.getInitTime=function(){return this.$ChatSidebarStore1.initTime;};p.prototype.getVisibleType=function(){return this.$ChatSidebarStore1.visible;};f.exports=new p();},null);
__d('OrderedFriendsList',['AvailableListConstants','PresenceStatus','SearchableEntry','ShortProfiles','WorkModeConfig','createArrayFromMixed','isValidUniqueID','InitialChatFriendsList'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=[],p=[],q={},r=[],s={},t=[],u={contains:function(v){return v in q;},getList:function(){if(l.is_work_user)return m(o);u.reRank();var v=m(o);v=v.filter(function(w){var x=k.getNowUnsafe(w);return !x||x.type=='friend'||x.is_nonfriend_messenger_contact;});return v;},getSearchableEntries:function(v,w){var x=u.getList();k.getMulti(x.slice(0,v),function(y){var z=[];for(var aa in y)z.push(u.normalizeProfileEntry(y[aa],aa));var ba=u.getGroups().map(u.normalizeThreadEntry);w(z.concat(ba).filter(function(ca){return !!ca;}).sort(function(ca,da){return ca.getOrder()-da.getOrder();}));});},normalizeProfileEntry:function(v,w){var x=v.searchTokens||[];return new j({uniqueID:v.id||w,keywordString:x.join(' '),order:u.getRank(v.id||w),photo:v.thumbSrc,title:v.name,type:v.type,uri:v.uri,auxiliaryData:{isMessengerUser:v.is_messenger_user}});},normalizeThreadEntry:function(v,w){var x=v.mercury_thread,y=v.participants_to_render,z=v.text,aa=null;if(!z)z=x.name;var ba=y.map(function(da){return da.name;}).join(', ');if(!z){z=ba;}else aa=ba;var ca=v.uid;if(!z||!n(ca))return null;return new j({uniqueID:ca,order:w,photo:x.image_src,title:z,subtitle:aa,type:'thread',auxiliaryData:{participantsToRender:y,thread:x}});},getRank:function(v){return v in q?q[v]:o.length;},getActiveList:function(){if(r.length>0)return r;return u.getList();},getActiveRank:function(v){return v in s?s[v]:u.getRank(v);},reRank:function(){o=[];var v=0;t.forEach(function(w){var x=w.slice(0,-2),y=w.slice(-1);if(i.get(x)==y){o[v]=x;q[x]=v++;}});},rankActive:function(){var v=0;t.forEach(function(w){var x=w.slice(0,-2),y=w.slice(-1);if(y==h.ACTIVE){r[v]=x;s[x]=v++;}});},getGroups:function(){return p;}};(function(){var v=c('InitialChatFriendsList');o=v.list.length?v.list:[];p=v.groups||[];if(!l.is_work_user){t=o.slice();u.rankActive();u.reRank();}else o.forEach(function(w,x){q[w]=x;});})();f.exports=b.OrderedFriendsList||u;},null);
__d('ChatSidebarVisibility',['ChatConfig','ChatSidebarStore','DOMDimensions','OrderedFriendsList'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=h.get('sidebar.min_friends'),m=h.get('sidebar.minimum_width'),n=h.get('minisidebar.minimum_width'),o={getViewport:function(){return j.getViewportWithoutScrollbarDimensions();},hasLowFriendCount:function(){return k.getActiveList().length<=l;},isViewportCapable:function(){var p=o.getViewport();return p.width>m;},isViewportCapableForMiniSidebar:function(){var p=o.getViewport();return p.width>n&&p.width<=m;},shouldShowSidebar:function(){return o.shouldShowSidebarIgnoreEnabled()&&i.isEnabled();},shouldShowMiniSidebar:function(){return o.shouldShowMiniSidebarIgnoreEnabled()&&i.isEnabled();},shouldShowSidebarIgnoreEnabled:function(){return o.isViewportCapable()&&!o.hasLowFriendCount();},shouldShowMiniSidebarIgnoreEnabled:function(){return !h.get('divebar_new_design',false)&&o.isViewportCapableForMiniSidebar()&&!o.hasLowFriendCount();}};f.exports=o;},null);
__d('ChatSidebarActions',['ChatDispatcher','ChatSidebarActionTypes','ChatSidebarVisibility','SidebarType'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();function l(){if(j.shouldShowSidebar()){return k.SIDEBAR;}else if(j.shouldShowMiniSidebar())return k.MINI_SIDEBAR;return k.BUDDYLIST;}function m(){if(j.shouldShowSidebarIgnoreEnabled()){return k.SIDEBAR;}else if(j.shouldShowMiniSidebarIgnoreEnabled())return k.MINI_SIDEBAR;return k.BUDDYLIST;}var n={init:function(){h.dispatch({type:i.INIT});},loaded:function(){h.dispatch({type:i.LOADED});},disable:function(){h.dispatch({type:i.SET_ENABLED,enabled:false,sidebarType:k.BUDDYLIST});},enable:function(){h.dispatch({type:i.SET_ENABLED,enabled:true,sidebarType:m()});},show:function(){h.dispatch({type:i.SHOW,sidebarType:l()});},toggle:function(){h.dispatch({type:i.TOGGLE,sidebarType:l()});}};f.exports=n;},null);
__d('FBRTCStore',['FBRTCDispatcher','FluxStore'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j,k;'use strict';j=babelHelpers.inherits(l,i);k=j&&j.prototype;function l(){k.constructor.call(this,h);}l.prototype.__emitChange=function(){this.__emitter.emit(this.__changeEvent);};f.exports=l;},null);
__d('FBRTCCallBlockingStore',['Arbiter','AsyncRequest','BanzaiLogger','ChannelConstants','FBRTCDispatcher','FBRTCStore','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o,p;'use strict';var q=false,r=0,s=null,t='call_block_setting_changed';o=babelHelpers.inherits(u,m);p=o&&o.prototype;u.prototype.init=function(v){this.$FBRTCCallBlockingStore1(v);h.subscribe(k.getArbiterType('videocall_block_setting'),this.$FBRTCCallBlockingStore2.bind(this));};u.prototype.__onDispatch=function(v){if(v.type!==t)return;this.$FBRTCCallBlockingStore1(v.data);};u.prototype.$FBRTCCallBlockingStore1=function(v){switch(v){case 0:q=false;this.$FBRTCCallBlockingStore3();break;case -1:q=true;this.$FBRTCCallBlockingStore3();break;default:q=true;this.$FBRTCCallBlockingStore4(v);}this.__emitChange();};u.prototype.$FBRTCCallBlockingStore4=function(v){if(s===null)s=n(this.turnOnVideoCalling.bind(this),v*1000);};u.prototype.getBlockingStatus=function(){return q;};u.prototype.turnOnVideoCalling=function(){new i('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore5.bind(this)).setData({call_blocked_until:0}).send();};u.prototype.turnOffVideoCalling=function(v){r=v;new i('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore6.bind(this)).setData({call_blocked_until:v}).send();};u.prototype.$FBRTCCallBlockingStore3=function(){if(s){clearTimeout(s);s=null;}};u.prototype.$FBRTCCallBlockingStore5=function(){l.dispatch({type:t,data:0});j.log('VideoCallLoggerConfig',{event:t,message:'enable'});};u.prototype.$FBRTCCallBlockingStore6=function(){l.dispatch({type:t,data:r});j.log('VideoCallLoggerConfig',{event:t,message:'disable_'+r});};u.prototype.$FBRTCCallBlockingStore2=function(v,w){l.dispatch({type:t,data:w.obj.value});};function u(){o.apply(this,arguments);}f.exports=new u();},null);
__d('ChatOptions',['Arbiter','ChannelConstants','ChatSidebarActions','FBRTCCallBlockingStore','JSLogger','PresenceUtil','ChatOptionsInitialData'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=l.create('chat_options'),o={};(function(){var q=c('ChatOptionsInitialData');for(var r in q){var s=q[r];if(r==='call_blocked_until'){k.init(s);}else o[r]=!!s;}})();var p=Object.assign(new h(),{getSetting:function(q){return o[q];},setSetting:function(q,r,s){if(q==='sidebar_mode'){r?j.enable():j.disable();return;}if(this.getSetting(q)==r)return;if(s){s='from_'+s;n.log(s,{name:q,new_value:r,old_value:this.getSetting(q)});}o[q]=!!r;h.inform('chat/option-changed',{name:q,value:r});}});h.subscribe(i.getArbiterType('setting'),function(q,r){var s=r.obj;if(s.window_id===m.getSessionID())return;p.setSetting(s.setting,!!s.value,'channel');});h.subscribe(l.DUMP_EVENT,function(q,r){r.chat_options=o;});f.exports=p;},null);
__d('MercuryNotificationRenderer',['MercuryAssert','MercuryParticipants','MercuryViewer','fbt','MercuryMessages','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=c('MercuryMessages').get(),m=c('MercuryThreads').get();function n(o,p){h.isThreadID(o);m.getThreadMeta(o,function(q){l.getThreadMessagesRange(o,0,1,function(r){var s=r.length&&r[r.length-1];if(s&&s.author!=j.getID()){i.get(s.author,function(t){if(q.name){p(k._("{senderName} messaged {groupName}",[k.param('senderName',t.short_name),k.param('groupName',q.name)]));}else p(k._("{name} messaged you",[k.param('name',t.short_name)]));});}else p(k._("New message!"));});});}f.exports={renderDocumentTitle:n};},null);
__d('ChatTitleBarBlinker',['ChatActivity','ChatConfig','DocumentTitle','JSLogger','MercuryNotificationRenderer','PresenceState','MercuryThreadInformer','MercuryTimestampTracker'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=c('MercuryThreadInformer').get(),o=c('MercuryTimestampTracker').get(),p=k.create('chat_title'),q=null,r=0,s=false;function t(){if(q){q.stop();q=null;return true;}return false;}function u(z){var aa=z||o.getLastUserMessageTimestamp();if(r<=aa){r=aa;if(t()||s)m.doSync();}}var v={blink:function(z,aa){if(!q&&r<aa)l.renderDocumentTitle(z,function(ba){if(!q)q=j.blink(ba);});},stopBlinking:function(){u();},blinkingElsewhere:function(){s=true;}};function w(z){var aa=m.verifyNumber(z.sb2);if(!aa||aa<=r)return null;return aa;}function x(z){var aa=z&&w(z);if(aa){r=aa;p.debug('load',r);t();s=false;}}function y(z){var aa=w(z);if(!aa){p.debug('store',r);z.sb2=r;s=false;}return z;}m.registerStateStorer(y);m.registerStateLoader(x);n.subscribe('thread-read-changed',function(z,aa){var ba=o.getLastUserMessageTimestamp(),ca=0;for(var da in aa)if(aa[da].mark_as_read&&aa[da].timestamp>=ba&&aa[da].timestamp>ca)ca=aa[da].timestamp;ca&&u(ca);});h.subscribe('activity',function(){u();});(function(){var z=m.getInitial();if(z)r=w(z)||0;})();f.exports=v;},null);
__d('MercuryGroupThreadMentions',['CurrentUser','ShortProfiles'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={messageMentionsViewer:function(k,l){i.get(h.getID(),function(m){l(new RegExp('@'+m.firstName,'i').test(k.body));});}};f.exports=j;},null);
__d('Sound',['SoundInitialData','SoundPlayer','SoundRPC','SoundSynchronizer','URI','UserAgent_DEPRECATED','isFacebookURI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=null,p={init:function(t){if(!o)i.init(t);},play:function(t,u,v){if(o){j.playRemote(o.contentWindow,t,u,false);}else j.playLocal(t,u,v);},stop:function(t){if(!o)i.stop(t);}},q=new l(location.href);if(q.getSubdomain()&&q.getSubdomain()!=='www')q.setSubdomain('www');var r=q.getDomain();function s(){if(m.ie()<9)return false;if(h.RPC_DISABLED)return false;return k.isSupported()&&j.supportsRPC();}if(n(q)&&location.host!==r&&s()){o=document.createElement('iframe');o.setAttribute('src','//'+r+'/sound_iframe.php');o.style.display='none';document.body.appendChild(o);}f.exports=p;},null);
__d('MercuryBrowserAlerts',['ArbiterMixin','ChatActivity','ChatConfig','ChatOptions','ChatTitleBarBlinker','MercuryConfig','MercuryGroupThreadMentions','MercuryThreadInfo','MercuryViewer','MessagingTag','Sound','MercuryBlockedParticipants','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=c('MercuryBlockedParticipants').get(),t=c('MercuryThreads').get();r.init(['audio/ogg','audio/mpeg']);function u(w){if(k.getSetting('sound'))r.play([j.get('sound.notif_ogg_url'),j.get('sound.notif_mp3_url')],w,false);}var v={messageReceived:function(w){if(p.isViewer(w.author)||!w.is_unread||w.folder!=q.INBOX&&w.folder!=q.ARCHIVED)return;var x=w.thread_id,y=i.isActive();if(y){var z=false;v.inform('before-alert',{threadID:x,cancelAlert:function(){z=true;}});}t.getThreadMeta(x,function(aa){var ba=o.isMuted(aa);n.messageMentionsViewer(w,function(ca){if(ba&&(!m.GroupChatMentionsGK||!ca))return;if(s.isPresentInGroupThread(aa))return;var da=w.timestamp;if(y){!z&&u(da);}else{l.blink(x,da);u(da);}l.blinkingElsewhere();});});}};f.exports=Object.assign(v,h);},null);
__d('ChatNewMessageHandler',['ChatActivity','ChatMentionsNotifications','ChatTabModel','ChatTabViewInstances','JSLogger','MercuryAssert','MercuryBrowserAlerts','UserActivity','MercuryConfig','MercuryThreadlistConstants'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=l.create('chat_new_message'),s={_notify:function(t,u,v){if(p.DesktopNotificationsGK)i.notifyIfMessageToMe(u);var w=k.get(t);v.view_is_visible=w&&w.isVisible();v.view_is_focused=w&&w.isFocused();if(!v.view_is_visible)r.log('message_to_hidden');v.is_active=h.isActive();n.messageReceived(u);},newMessage:function(t,u){m.isThreadID(t);var v=j.getTab(t),w={thread_id:t,message_id:u.message_id,to_new_tab:!v,to_raised_tab:v?!!v.raised:true};this._notify(t,u,w);r.log('message',w);}};n.subscribe('before-alert',function(t,event){var u=event.threadID,v=k.get(u),w=j.getTab(u),x=q.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;if(w&&w.raised&&v&&v.isVisible()&&v.isFocused()&&o.isActive(x)){v.tryMarkAsRead();event.cancelAlert();}});f.exports=s;},null);
__d('ChatTabLRUManager',['ChatTabViewInstances','ChatTabModel','InitialServerTime','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryThreads').get(),l={getLRUVisibleTab:function(m){if(m.hasRoomForRaisedTab())return undefined;var n=Object.keys(m.getTabsToShow()||{}),o=1*60,p=null,q=Infinity;for(var r=0;r<n.length;r++){var s=n[r],t=k.getThreadMetaNow(s);if(i.isTabPromoted(s))continue;if(!h.get(s).hasEmptyInput()||!t)continue;var u=(j.serverTime-t.timestamp)/1000;if(!t.timestamp||t.timestamp&&t.timestamp<q&&u>o){p=t.thread_id;q=t.timestamp;}}return p;}};f.exports=l;},null);
__d('ChatTabPolicy',['ChatBehavior','JSLogger','MercuryActionType','MercuryLogMessageType','MercuryAssert','MercuryConfig','MercuryGroupThreadMentions','MercuryIDs','MercuryParticipantTypes','MercurySourceType','MercuryThreadInfo','MercuryViewer','MessagingTag','PresencePrivacy','ShortProfiles','WorkModeConfig','MercuryBlockedParticipants','MercuryThreadActions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();var x=c('MercuryBlockedParticipants').get(),y=c('MercuryThreadActions').get(),z=i.create('tab_policy');f.exports={messageIsAllowed:function(aa,ba,ca){var da=aa.thread_id,ea=ba.message_id;l.isThreadID(da);l.isParticipantID(ba.author);var fa;if(r.isMuted(aa)){fa={thread_id:da,message_id:ea,mute_settings:aa.mute_settings};z.log('message_thread_muted',fa);if(m.GroupChatMentionsGK)n.messageMentionsViewer(ba,function(ia){if(ia)ca();});return;}if(aa.read_only){fa={thread_id:da,message_id:ea,mode:aa.mode};z.log('message_read_only',fa);return;}if(ba.source==q.EMAIL||ba.source==q.TITAN_EMAIL_REPLY){fa={thread_id:da,message_id:ea,source:ba.source};z.log('message_source_not_allowed',fa);return;}var ga=o.getUserIDFromParticipantID(ba.author);if(!ga){z.log('message_bad_author',{thread_id:da,message_id:ea,user:ga});return;}if(ba.action_type!=j.USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(ba,aa)){fa={thread_id:da,message_id:ea,type:ba.action_type};z.log('message_non_user_generated',fa);return;}if(aa.is_canonical_user&&!h.notifiesUserMessages()){z.log('message_jabber',{thread_id:da,message_id:ea});y.markSeen(da,true);return;}if(aa.is_canonical&&!aa.other_user_fbid){z.log('message_canonical_contact',{thread_id:da,message_id:ea});return;}if(aa.folder!=t.INBOX){z.log('message_folder',{thread_id:da,message_id:ea,folder:aa.folder});return;}if(x.isPresentInGroupThread(aa)){fa={thread_id:da,message_id:ea};z.log('message_blocked_participants',fa);return;}var ha=o.getUserIDFromParticipantID(s.getID());v.getMulti([ga,ha],function(ia){if(!u.allows(ga)){z.log('message_privacy',{thread_id:da,message_id:ea,user:ga});return;}var ja=ia[ga].employee&&ia[ha].employee,ka=w.is_work_user;if(!ja&&!ka&&!ia[ga].isCommercePage&&ia[ga].type!==p.FRIEND){z.log('message_non_friend',{thread_id:da,message_id:ea,user:ga});return;}ca();});},_messageIsNewlyCreatedGroup:function(aa,ba){return aa.action_type===j.LOG_MESSAGE&&aa.log_message_type===k.THREAD_NAME&&ba.message_count===1;}};},null);
__d('ChatTabViewEvents',['Arbiter'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('MercuryParticipantListRenderer',['fbt'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(){this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=false;this.$MercuryParticipantListRenderer4=(function(s){return this.$MercuryParticipantListRenderer2?s.short_name:s.name;}).bind(this);}i.prototype.renderParticipantList=function(s){var t=s.map(this.$MercuryParticipantListRenderer4);switch(t.length){case 0:return j(this.$MercuryParticipantListRenderer1);case 1:return k(t);case 2:return this.$MercuryParticipantListRenderer3?m(t):l(t);case 3:return this.$MercuryParticipantListRenderer3?o(t):n(t);default:return this.$MercuryParticipantListRenderer3?q(t):p(t);}};i.prototype.setIsNewThread=function(s){this.$MercuryParticipantListRenderer1=s;return this;};i.prototype.setNameRenderer=function(s){this.$MercuryParticipantListRenderer4=s;return this;};i.prototype.setUseShortName=function(s){this.$MercuryParticipantListRenderer2=s;return this;};i.prototype.setUseAndSeparator=function(s){this.$MercuryParticipantListRenderer3=s;return this;};function j(s){if(s){return h._("New message");}else return h._("No Participants");}function k(s){return s[0];}function l(s){return h._("{participant1}, {participant2}",[h.param('participant1',s[0]),h.param('participant2',s[1])]);}function m(s){return h._("{participant1} and {participant2}",[h.param('participant1',s[0]),h.param('participant2',s[1])]);}function n(s){return h._("{participant1}, {participant2}, {participant3}",[h.param('participant1',s[0]),h.param('participant2',s[1]),h.param('participant3',s[2])]);}function o(s){return h._("{participant1}, {participant2}  and {participant3}",[h.param('participant1',s[0]),h.param('participant2',s[1]),h.param('participant3',s[2])]);}function p(s){return h._("{participant1}, {participant2}, {participant3}, {others_link}",[h.param('participant1',s[0]),h.param('participant2',s[1]),h.param('participant3',s[2]),h.param('others_link',r(s.length-3))]);}function q(s){return h._("{participant1}, {participant2} and {others_link}",[h.param('participant1',s[0]),h.param('participant2',s[1]),h.param('others_link',r(s.length-2))]);}function r(s){if(s>1){return h._({"*":"{others_count} others"},[h.param('others_count',s,[0])]);}else return h._("1 other");}f.exports=i;},null);
__d('MercuryThreadTitle.react',['MercuryIDs','MercuryParticipantListRenderer','MercuryParticipants','React','TextWithEmoticons.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=k.PropTypes,o=k.createClass({displayName:'MercuryThreadTitle',propTypes:{isNewThread:n.bool,thread:n.object.isRequired,viewer:n.string.isRequired,showUnreadCount:n.bool,useShortName:n.bool,useAndSeparator:n.bool},getDefaultProps:function(){return {isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(p){this._renderParticipantsList(p);},render:function(){return (k.createElement('span',{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames,this.props.children));},getTitle:function(){return this.state.participantNames;},_renderThreadTitle:function(){var p=this.props.thread,q=k.createElement(l,{renderEmoticons:true,renderEmoji:true,text:p.name});if(!p.unread_count||!this.props.showUnreadCount)return q;return this._renderTitleWithUnreadCount(q,p.unread_count);},_renderParticipantsList:function(p){if(p.thread.name)return;var q=h.getParticipantIDFromUserID(p.viewer),r=p.thread.participants;if(r.length>1)r=r.filter(function(s){return s!=q;});j.getMulti(r,(function(s){if(!this.isMounted())return;var t=r.map(function(w){return s[w];}),u=new i().setUseShortName(this.props.useShortName).setUseAndSeparator(this.props.useAndSeparator).setIsNewThread(this.props.isNewThread).renderParticipantList(t),v=p.showUnreadCount&&p.thread.unread_count?this._renderTitleWithUnreadCount(u,p.thread.unread_count):u;this.setState({participantNames:v});}).bind(this));},_renderTitleWithUnreadCount:function(p,q){return m._("{conversation-title} ({unread-count})",[m.param('conversation-title',p),m.param('unread-count',q)]);}});f.exports=o;},null);
__d('NubController',['ArbiterMixin','Dock'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(){}Object.assign(j.prototype,h,{init:function(k){this.el=k;i.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){i.hide(this.el);},show:function(){i.show(this.el);}});f.exports=j;},null);
__d('ChatTabViewSelector',['Arbiter','ArbiterMixin','CSS','ChatTabActions','CurrentUser','DOM','DataStore','Event','MenuDeprecated','MercuryThreadTitle.react','NubController','React','ReactDOM','ChatTabTemplates','Toggler','MercuryThreadInformer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=c('MercuryThreadInformer').get(),x=c('MercuryThreads').get();function y(z){var aa=u[':fb:chat:tab:selector'].build(),ba=aa.getRoot(),ca=aa.getNode('menu'),da=m.find(ca,'.uiMenuInner'),ea={},fa=new r().init(ba);j.hide(ba);m.insertBefore(z,ba);function ga(ja){var ka=0;for(var la in ea){var ma=ea[la],na=x.getThreadMetaNow(la),oa=ma.getNode('unreadCount'),pa=na&&na.unread_count||0;ka+=pa;if(pa>9)pa='+';j.conditionClass(oa,'invisible_elem',!pa);m.setContent(oa,pa);}var qa=aa.getNode('numMessages');j.conditionShow(qa,ka);m.setContent(qa,ka);}this.setTabData=function(ja){var ka=ea;ea={};if(ja.length<1){j.hide(ba);return;}j.show(ba);m.empty(da);ja.forEach(function(na){var oa=u[':fb:chat:tab:selector:item'].build(),pa=oa.getNode('content');ea[na.id]=oa;x.getThreadMeta(na.id,function(ra){t.render(s.createElement(q,{thread:ra,useAndSeparator:true,viewer:l.getID()}),pa);});m.prependContent(da,oa.getRoot());n.set(oa.getRoot(),'threadID',na.id);var qa=oa.getNode('closeButton');o.listen(qa,'click',function(event){k.closeTab(na.id,'selector/close-tab');event.kill();});});for(var la in ka)if(ka.hasOwnProperty(la)){var ma=ka[la].getNode('content');ma&&t.unmountComponentAtNode(ma);}fa.flyoutContentChanged();m.setContent(aa.getNode('numTabs'),ja.length);ga();};function ha(event,ja){if(ja.menu!=ca)return;var ka=n.get(ja.item,'threadID');y.inform('selected',ka);v.hide(ba);}function ia(event,ja){p.register(ca);}p.subscribe('select',ha.bind(this));v.listen('show',ba,function(){h.inform('layer_shown',{type:'ChatTabSelector'});ia();});v.listen('hide',ba,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});w.subscribe('threads-updated',ga);}Object.assign(y,i);f.exports=y;},null);
__d('ChatTabController',['Arbiter','BanzaiLogger','ChatActivity','ChatConfig','ChatNewMessageHandler','ChatTabActions','ChatTabLRUManager','ChatTabModel','ChatTabPolicy','ChatTabViewEvents','ChatTabViewInstances','ChatTabViewSelector','FBRTCCore','JSLogger','MercuryViewer','Style','UserAgent_DEPRECATED','ChatTabPresence','ChatTypeaheadBehavior','MercuryThreadInformer','MercuryThreadActions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();c('ChatTabPresence');c('ChatTypeaheadBehavior');var y=c('MercuryThreadInformer').get(),z=c('MercuryThreadActions').get(),aa=c('MercuryThreads').get(),ba=k.get('tab_auto_close_timeout')||7200000,ca=u.create('tab_controller');function da(oa,pa,qa){var ra=o.get().tabs,sa=ra[oa],ta,ua;if(ra.length<2)return false;var va=ra.slice(oa+1),wa=ra.slice(0,oa),xa=va.concat(wa);if(!pa)xa.reverse();if(sa)xa.push(sa);for(var ya=0;ya<xa.length;ya++){ta=xa[ya];ua=r.get(ta.id);if(ua&&ua.isVisible()&&(!qa||ta.raised)){ua.focus();return true;}}return false;}function ea(oa,pa){var qa=pa&&pa.getRightmostHiddenTab();if(qa===oa)return null;return qa;}function fa(){return Math.floor(Math.random()*2147483648).toString(16);}function ga(oa,pa,qa,ra){m.raiseTab(oa,true,qa);var sa=pa&&pa.getLeftmostVisibleTab(),ta=pa&&pa.getTabsToShow();if(ta&&!ta[oa]&&sa){o.promoteThreadInPlaceOfThread(oa,sa,ea(oa,pa),true);}else m.promoteTab(oa);h.inform('chat/open-tab',oa);if(ra)return;var ua=r.get(oa);ua&&ua.focus();}function ha(oa,pa){if(!o.getTab(oa))m.raiseTab(oa,false);var qa=pa&&n.getLRUVisibleTab(pa),ra=pa&&pa.getTabsToShow();if(ra&&!ra[oa]&&qa)o.promoteThreadInPlaceOfThread(oa,qa,ea(oa,pa));}function ia(oa){s.subscribe('selected',function(ra,sa){ga(sa,oa);});h.subscribe('page_transition',function(ra,sa){m.closeFragileTabs();});h.subscribe('chat-visibility/go-offline',function(){m.closeAllTabs();});j.subscribe('idle',function(ra,sa){if(sa>ba){var ta=o.get().tabs;ta.forEach(function(ua){var va=ua.id;aa.getThreadMeta(va,function(wa){if(!wa.unread_count){ca.log('autoclose_idle_seen',{thread_id:va,idleness:sa});m.closeTab(va,'autoclose_idle_seen');}});});}});q.subscribe('nub-activated',function(ra,sa){ga(sa,oa);});q.subscribe('focus-tab',function(ra,sa){var ta=o.getTab(sa);if(ta&&ta.raised)ga(sa,oa,ta.signatureID,false);});function pa(ra,sa){i.log('VideoCallLoggerConfig',{event:'chat_tab_call_click'});t.startOutgoingCall(sa.userID,sa.clickSource,sa.audioOnly);}q.subscribe('video-call-clicked',pa);function qa(ra,sa){t.startMultiwayCall(sa.threadID,sa.usersToCall,sa.clickSource,sa.audioOnly);}q.subscribe('group-call-clicked',qa);q.subscribe('interaction-with-tab',function(ra,sa){var ta=o.getTab(sa);ta&&ta.raised&&z.markSeen(sa);});q.subscribe('esc-pressed',function(ra,sa){ca.log('close_esc',{thread_id:sa});var ta=o.indexOf(sa);m.closeTab(sa,'close_esc');setTimeout(function(){da(ta-1,true,true);},0);});y.subscribe('messages-received',function(ra,sa){for(var ta in sa){var ua=sa[ta];for(var va=0;va<ua.length;va++){var wa=ua[va];if(wa.author!=v.getID()){if(!wa.is_unread){ca.log('message_already_read',{action_id:wa.action_id,thread_id:wa.thread_id});continue;}aa.getThreadMeta(ta,function(xa){p.messageIsAllowed(xa,wa,function(){ha(ta,oa);l.newMessage(ta,wa);});});}}}});y.subscribe('thread-read-changed',function(ra,sa){for(var ta in sa)if(!sa[ta].mark_as_read){ca.log('autoclose_marked_unread',{thread_id:ta});m.closeTab(ta,'autoclose_marked_unread');}});q.subscribe('tab-pressed',function(ra,sa){return !da(o.indexOf(sa.id),sa.shiftPressed);});h.subscribe(u.DUMP_EVENT,function(ra,sa){sa.chat_controller={auto_close_timeout:ba};});this.openTab=function(ra,sa,ta,ua){ga(ra,sa,fa(),ua);if(ta)ta(r.get(ra));};}if(x.firefox()){var ja=function(){return w.get(document.body,'overflowX')+' '+w.get(document.body,'overflowY');},ka=ja(),la=function(){var oa=ja();if(oa!==ka){ka=oa;h.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var ma=new MutationObserver(la),na={attributes:true,attributeFilter:['class','style']};ma.observe(document.documentElement,na);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))la();},false);}f.exports=ia;},null);
__d('ChatTabViewPlaceholder',['DOM','ErrorUtils','React','ReactDOM','cx'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();function m(n,o,p,q,r,s){this.$ChatTabViewPlaceholder1={threadID:o,serverThreadID:p,signatureID:q,root:r,prevTab:s};this.$ChatTabViewPlaceholder2={visible:true,raised:true};n.then((function(t){try{var v=new t(this.$ChatTabViewPlaceholder1.threadID,this.$ChatTabViewPlaceholder1.serverThreadID,this.$ChatTabViewPlaceholder1.signatureID,this.$ChatTabViewPlaceholder1.root,this);v.setVisibleState(this.$ChatTabViewPlaceholder2.visible,this.$ChatTabViewPlaceholder2.raised);this.destroy();this.$ChatTabViewPlaceholder3=v.getTabElem();if(this.$ChatTabViewPlaceholder4)this.$ChatTabViewPlaceholder4(this.$ChatTabViewPlaceholder1.threadID,v);}catch(u){i.reportError(u,false);}}).bind(this));this.render(this.$ChatTabViewPlaceholder1.root,this.$ChatTabViewPlaceholder1.prevTab);}m.prototype.getTabElem=function(){return this.$ChatTabViewPlaceholder3;};m.prototype.onBeingReplaced=function(n){this.$ChatTabViewPlaceholder4=n;};m.prototype.updateSignatureID=function(n){this.$ChatTabViewPlaceholder1.signatureID=n;};m.prototype.getScrollTop=function(){return 0;};m.prototype.appendTo=function(n){h.appendContent(n,this.$ChatTabViewPlaceholder3);};m.prototype.insertBefore=function(n){h.insertBefore(n.getTabElem(),this.$ChatTabViewPlaceholder3);};m.prototype.isFocused=function(){return false;};m.prototype.hasEmptyInput=function(){return true;};m.prototype.destroy=function(){k.unmountComponentAtNode(this.$ChatTabViewPlaceholder3);h.remove(this.$ChatTabViewPlaceholder3);};m.prototype.nextTabIs=function(n){var o=n&&n.getTabElem();return !!(this.$ChatTabViewPlaceholder3&&this.$ChatTabViewPlaceholder3.nextSibling===o);};m.prototype.setVisibleState=function(n,o){this.$ChatTabViewPlaceholder2={visible:n,raised:!!o};this.render(this.$ChatTabViewPlaceholder1.root,this.$ChatTabViewPlaceholder1.prevTab);};m.prototype.render=function(n,o){var p=!this.$ChatTabViewPlaceholder2.visible,q=this.$ChatTabViewPlaceholder2.raised,r="fbNub"+(' '+"_50-v")+(p?' '+"hidden_elem":'')+(q?' '+"opened":'')+(' '+"placeholder")+(' '+"_50mz");if(!this.$ChatTabViewPlaceholder3){var s=h.create('div',{className:r});this.$ChatTabViewPlaceholder3=s;k.render(j.createElement('div',null,j.createElement('span',{className:"fbNubButton"}),'opened ? (',j.createElement('div',{className:"fbNubFlyout fbDockChatTabFlyout _16bz"},j.createElement('div',{className:"fbNubFlyoutTitlebar"}),j.createElement('div',{className:"fbNubFlyoutBody"})),')'),s);if(o&&o.getTabElem()){this.insertBefore(o);}else this.appendTo(n);}else this.$ChatTabViewPlaceholder3.className=r;};f.exports=m;},null);
__d('ChatTabViewLoader',['Bootloader','ChatTabViewPlaceholder','Promise','Run','requireWeak'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m;l('ChatTabView',function(p){return m=p;});var n=new j(function(p){k.onAfterLoad(function(){if(!m){h.loadModules(["ChatTabView"],function(q){m=q;p(q);});}else p(m);});}),o={make:function(p,q,r,s,t){if(m){return new m(p,q,r,s,t);}else return new i(n,p,q,r,s,t);}};f.exports=o;},null);
__d('ChatTabViewCoordinator',['Arbiter','ChatTabModel','ChatTabViewLoader','ChatTabViewSelector','CSS','JSLogger','FBRTCSupport'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=m.create('chat_tab_coordinator');function p(q,r){var s=new k(q),t={},u=false;function v(){var z=i.get(),aa={};z.tabs.forEach(function(ca){aa[ca.id]=1;});o.log('process_tab_changed',{model_tabs:Object.keys(aa),view_tabs:Object.keys(t)});for(var ba in t)if(!aa[ba]){o.log('remove_tab',{tab_id:ba});t[ba].destroy();delete t[ba];}w(z);x(z);if(z.tabNeedsFocus&&!z.tabNeedsFocus.isFocused())z.tabNeedsFocus.focus();}function w(z){var aa=null;z.tabs.forEach(function(ba){var ca=ba.id,da=false;if(!t[ca]){o.log('add_tab',{tab_id:ca});t[ca]=j.make(ca,ba.server_id,ba.signatureID,q,aa);da=true;if(t[ca].onBeingReplaced)t[ca].onBeingReplaced(function(fa,ga){t[fa]=ga;});}else t[ca].updateSignatureID(ba.signatureID);if(t[ca].isFocused())z.tabNeedsFocus=t[ca];if(!da&&!t[ca].nextTabIs(aa)){var ea=t[ca].getScrollTop();if(aa){t[ca].insertBefore(aa);}else t[ca].appendTo(q);if(ea)t[ca].setScrollTop(ea);}aa=t[ca];});}function x(z){var aa=r.getTabsToShow(z),ba=[],ca=false;z.tabs.forEach(function(da){if(!aa[da.id]){t[da.id].setVisibleState(false,da.raised);ba.push(da);}});z.tabs.forEach(function(da){if(aa[da.id]){t[da.id].setVisibleState(true,da.raised);ca|=da.raised;}});s.setTabData(ba);y(ca);}function y(z){if(!z&&u){h.inform('layer_hidden',{type:'ChatTab'});u=false;}else if(z&&!u){h.inform('layer_shown',{type:'ChatTab'});u=true;}}if(n.isSendWebrtcSupported())l.addClass(q,'videoCallEnabled');r.subscribe('tabs-changed',v);v();}f.exports=p;},null);
__d('TabsViewport',['Arbiter','ArbiterMixin','ChatTabModel','Dock','DOM','DOMDimensions','Event','Parent','Vector','ViewportBounds','areJSONRepresentationsEqual','csx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=175,u=269,v=0;function w(){return t;}function x(){return u;}function y(z){this._root=z;var aa=this._recalculateWidth.bind(this);n.listen(window,'resize',aa);k.subscribe('resize',aa);h.subscribeOnce('sidebar/initialized',aa,h.SUBSCRIBE_NEW);j.addListener((function(){return this._recalculateTabs(true);}).bind(this));this._recalculateWidth();this._initialized=true;}Object.assign(y.prototype,i,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var z=y._getAvailableDockWidth(this._root),aa=Math.max(1,Math.floor(z/x())),ba=aa!=this._maxShown;if(!this._viewState||ba||z<=this._viewState.usedWidth||z>this._viewState.widthToShowNext){this._availableWidth=z;this._maxShown=aa;this._viewState=null;this._recalculateTabs(ba);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(z){var aa=y._getTabsToShow(j.get(),this._availableWidth);if(z||!r(this._viewState,aa)){this._viewState=aa;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>x();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var z=j.get(),aa=this._viewState.tabsToShow;return z.tabs.filter(function(ba){return aa[ba.id];});},getRightmostHiddenTab:function(){var z=j.get(),aa=this._viewState.tabsToShow,ba=z.tabs.filter(function(da){return !aa[da.id];}),ca=ba.shift();return ca?ca.id:null;},getLeftmostVisibleTab:function(){var z=this.getShowingTabsOrder(),aa=z.pop();return aa?aa.id:null;},getRaisedVisibleTabs:function(){var z=[],aa=this.getShowingTabsOrder(),ba=aa.length;for(var ca=0;ca<ba;ca++)if(j.getTab(aa[ca].id).raised)z.push(aa[ca].id);return z;},shouldPromoteOnRaise:function(z){if(!this._viewState.tabsToShow[z])return true;if(this._viewState.nextToHide!=z)return false;var aa=j.getTab(z),ba=aa&&aa.raised;return !ba&&this._availableWidth-this._viewState.usedWidth<x()-w();}});Object.assign(y,{_getAvailableDockWidth:function(z){var aa=m.getViewportWithoutScrollbarDimensions().width;aa-=q.getLeft()+q.getRight();aa-=50;var ba=o.byClass(z,'fbDock'),ca=l.find(ba,"._56ox"),da=ca?p.getElementDimensions(ca).x:0;aa-=da;var ea=l.scry(ba,"._56oy");da+=p.getElementDimensions(ea.pop()).x;var fa=p.getElementDimensions(ba),ga=fa.x-da;if(ga>v)v=ga;aa-=v;aa-=15;return Math.max(aa,0);},_getTabsToShow:function(z,aa){aa=Math.max(aa,x()+1);function ba(ra,sa){return ra.raised||!sa?x():w();}var ca=JSON.parse(JSON.stringify(z.tabs)),da=-1,ea=null;if(z.promoted)ca.forEach(function(ra,sa){if(ra.id===z.promoted){da=sa;ea=ra;}});var fa=0,ga=false,ha=0,ia=!ea;ca.forEach(function(ra,sa){var ta=ba(ra,ga);ga=ga||!ra.raised;ra.leftmostOffset=fa+ta;fa+=ta;if(ra.leftmostOffset<aa)ha++;ia|=sa==da;ra.alreadyPlacedPromoted=ia;});function ja(ra,sa,ta){var ua={};for(var va=0;va<sa;va++){var wa=ra[va];if(!wa.alreadyPlacedPromoted&&va==sa-1){ua[ta]=true;}else ua[wa.id]=true;}return ua;}var ka=ja(ca,ha,z.promoted),la=ja(ca,ha-1,z.promoted),ma=null;for(var na in ka)if(!la[na])ma=na;var oa=ca[ha-1],pa=oa?oa.leftmostOffset:0,qa=Infinity;if(ha<ca.length)qa=ca[ha].leftmostOffset;return {nextToHide:ma,tabsToShow:ka,usedWidth:pa,widthToShowNext:qa};}});f.exports=y;},null);
__d('MessengerDispatcher',['Dispatcher'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('MNCommerceActionTypes',['keyMirrorRecursive'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=h({RECEIPT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},SHIPMENT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},DIALOG:{SHOW:null,HIDE:null},RETAIL_ITEM:{LOADED:null,LOAD_ERROR:null,RELOAD:null}});f.exports=i;},null);
__d('MNCommerceDialogStateStore',['FluxStore','MessengerDispatcher','MNCommerceActionTypes'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';k=babelHelpers.inherits(m,h);l=k&&k.prototype;function m(){l.constructor.call(this,i);this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;}m.prototype.__onDispatch=function(n){var o=n.type;switch(o){case j.DIALOG.SHOW:this.$MNCommerceDialogStateStore1=n.dialogContainer;this.$MNCommerceDialogStateStore2=n.state;this.__emitChange();break;case j.DIALOG.HIDE:this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;this.__emitChange();break;}};m.prototype.getDialogContainer=function(){return this.$MNCommerceDialogStateStore1;};m.prototype.getState=function(){return this.$MNCommerceDialogStateStore2;};f.exports=new m();},null);
__d('MNCommerceDialogContainer.react',['MNCommerceDialogStateStore','PureStoreBasedStateMixin','React'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=j.createClass({displayName:'MNCommerceDialogContainer',mixins:[i(h)],statics:{calculateState:function(){var l=h.getDialogContainer();return {dialogContainer:l};}},render:function(){var l=this.state.dialogContainer;if(!l)return null;return j.createElement(l,null);}});f.exports=k;},null);
__d('P2PActionConstants',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={CREDIT_CARDS_UPDATED:'credit_cards_updated',CHANNEL_EVENTS_ALLOWED:'channel_events_allowed',CHANNEL_EVENTS_IGNORED:'channel_events_ignored',CREDIT_CARD_SAVING:'credit_card_saving',CREDIT_CARD_ADDED:'credit_card_added',CREDIT_CARD_ADDED_ERROR:'credit_card_added_error',CREDIT_CARD_ADDED_ERROR_CLEARED:'credit_card_added_error_cleared',CREDIT_CARD_DELETED:'credit_card_deleted',CREDIT_CARD_DELETED_ERROR:'credit_card_deleted_error',CREDIT_CARD_UPDATED:'credit_card_updated',CREDIT_CARD_UPDATED_ERROR:'credit_card_updated_error',PRESET_CREDIT_CARD_UPDATED:'preset_credit_card_updated',PRESET_CREDIT_CARD_UPDATED_ERROR:'preset_credit_card_updated_error',CREDIT_CARD_VERIFIED:'credit_card_verified',CREDIT_CARD_VERIFIED_ERROR:'credit_card_verified_error',TRANSFERS_UPDATED:'transfers_updated',TRANSFERS_UPDATED_ERROR:'transfers_updated_error',NUX_TRANSFERS_UPDATED:'nux_transfers_updated',TRANSFER_ADDED:'transfer_added',TRANSFER_ADDED_ERROR:'transfer_added_error',TRANSFER_UPDATED:'transfer_updated',TRANSFER_UPDATED_ERROR:'transfer_updated_error',TRANSFER_ACCEPTED:'transfer_accepted',TRANSFER_DECLINED:'transfer_declined',CHAT_SEND_VIEW_OPENED:'chat_send_view_opened',CHAT_SEND_VIEW_CLOSED:'chat_send_view_closed',BIN_NUMBER_VALIDATED:'bin_number_validated',BIN_NUMBER_VALIDATED_ERROR:'bin_number_validated_error',USER_ELIGIBILITY_UDPATED:'user_eligibility_updated',FRIENDS_LIST_UPDATED:'friends_list_updated',DIALOG_SHOWN:'dialog_shown',DIALOG_CLOSED:'dialog_closed',BANNER_STATES_UPDATED:'banner_states_updated',BANNER_DISMISSED:'banner_dismissed',BANNER_VIEWED:'banner_viewed',BANNER_COMPLETED:'banner_completed',MONEYPENNY_TRANSFER_CREATED:'moneypenny_transfer_created',MONEYPENNY_TRANSFER_CREATED_ERROR:'moneypenny_transfer_created_error',PLATFORM_CONTEXT_ADDED:'platform_context_added',PLATFORM_CONTEXT_ADDED_ERROR:'platform_context_added_error',PLATFORM_CONTEXT_SAVE_ERRORS_CLEARED:'platform_context_save_errors_cleared',PLATFORM_CONTEXT_BANNER_DISMISSED:'platform_context_banner_dismissed',PLATFORM_CONTEXT_PRODUCT_ITEM_SOLD:'platform_context_product_item_sold',PLATFORM_CONTEXT_CHANGED:'platform_context_changed',EXTENSIVE_TRANSFER_DETAILS_UPDATED:'extensive_transfer_details_updated',ADDRESS_SAVING:'address_saving',ADDRESSES_UPDATED:'addresses_updated',ADDRESS_ADDED:'address_added',ADDRESS_ADDED_ERROR:'address_added_error',ADDRESS_ADDED_ERROR_CLEARED:'address_added_error_cleared',CHECKOUT_CART_INITATED:'checkout_cart_initiated',CHECKOUT_CART_CREATED:'checkout_cart_created',CHECKOUT_SHIPPING_OPTION_SELECTED:'checkout_shipping_option_selected',CHECKOUT_ADDRESS_SELECTED:'checkout_address_selected',CHECKOUT_CREDIT_CARD_SELECTED:'checkout_credit_card_selected',CHECKOUT_ADDRESS_FORM_TOGGLED:'checkout_address_form_toggled',CHECKOUT_CREDIT_CARD_FORM_TOGGLED:'checkout_credit_card_form_toggled',CHECKOUT_ADDRESS_EDIT_OPTIONS_TOGGLED:'checkout_address_options_toggled',CHECKOUT_CREDIT_CARD_EDIT_OPTIONS_TOGGLED:'checkout_credit_card_edit_options_toggled',CHECKOUT_ADDRESS_FORM_VALIDATED:'checkout_address_form_validated',CHECKOUT_CREDIT_CARD_FORM_VALIDATED:'checkout_credit_card_form_validated',CHECKOUT_EDIT_COMPLETED:'checkout_completed',CHECKOUT_PROCESSING:'checkout_processing',CHECKOUT_BUYER_PROFILE_UPDATED:'checkout_buyer_profile_updated'};f.exports=h;},null);
__d('P2PDispatcher',['Dispatcher'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new h();},null);
__d('P2PDialogStore',['EventEmitter','P2PActionConstants','P2PDispatcher'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';var m,n={};k=babelHelpers.inherits(o,h);l=k&&k.prototype;function o(){l.constructor.call(this);m=j.register(this.onEventDispatched.bind(this));n={dialogClass:null,dialogProps:null};}o.prototype.getState=function(){return n;};o.prototype.onEventDispatched=function(p){var q=p.type,r=p.data;switch(q){case i.DIALOG_SHOWN:n.dialogClass=r.dialogClass;n.dialogProps=r.dialogProps;this.emit('change');break;case i.DIALOG_CLOSED:n.dialogClass=null;n.dialogProps=null;this.emit('change');break;}};f.exports=new o();},null);
__d('P2PDialogContainer.react',['P2PDialogStore','React','ReactLayeredComponentMixin'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=i.createClass({displayName:'P2PDialogContainer',mixins:[j],getInitialState:function(){return h.getState();},componentDidMount:function(){this.dialogStoreSub=h.addListener('change',this.onDialogStoreChange);},componentWillUnmount:function(){if(this.dialogStoreSub){this.dialogStoreSub.remove();this.dialogStoreSub=null;}},onDialogStoreChange:function(){this.setState(h.getState());},renderLayers:function(){if(!this.state.dialogClass)return {};var l=this.state.dialogClass;return {dialog:i.createElement(l,this.state.dialogProps)};},render:function(){return null;}});f.exports=k;},null);
__d("FBRTCCallSummaryUploader",["Bootloader"],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={init:function(){h.loadModules(["Banzai","FBRTCCallSummary","FBRTCCallSummaryStore"],function(j,k,l){var m=l.getInstance();j.subscribe(j.SEND,function(){k.logSavedSummaries(m);});});}};f.exports=i;},null);
__d('FBRTCMessageHandler',['Bootloader','FBRTCCallSummaryUploader','FBRTCMessageListener','RTCConfig','FBRTCSupport'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=null,n=false,o=null,p={init:function(){if(!n&&l.isReceiveWebrtcSupported()){n=true;i.init();j.init(false);j.once('messageReceived',function(t){if(q(t))r();});j.once('multiwayMessageReceived',function(t){s();});}}};function q(t){if(k.CollaborationScreenSharingGK){var u=JSON.parse(t.payload);if(u.attributes&&u.attributes.isDirectScreenShareFromRecipient)return false;}return true;}function r(){if(!m)h.loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(t,u,v,w){m=new t(u,w,new v());j.setMessageHandler(m.onMessageReceived,m);});}function s(){if(!o)h.loadModules(["FBRTCGroupCallIncomingController"],function(t){o=new t();j.setMultiwayMessageHandler(o.onMessageReceived,o);});}f.exports=p;},null);
__d('HotLikeSound',['MercuryConfig','SoundPlayer','StickerConstants'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();i.init(['audio/ogg','audio/mpeg']);var k=[h['sound.hot_like_grow_mp3_url'],h['sound.hot_like_grow_ogg_url']],l=[h['sound.hot_like_pop_mp3_url'],h['sound.hot_like_pop_ogg_url']],m=[h['sound.hot_like_outgoing_small_mp3_url'],h['sound.hot_like_outgoing_small_ogg_url']],n=[h['sound.hot_like_outgoing_medium_mp3_url'],h['sound.hot_like_outgoing_medium_ogg_url']],o=[h['sound.hot_like_outgoing_large_mp3_url'],h['sound.hot_like_outgoing_large_ogg_url']],p=function(){return false;},q={setCheckSoundEnabledFunc:function(r){p=r;},start:function(){this._play(k);},stop:function(){i.stop(k);},pop:function(){this.stop();this._play(l);},snap:function(r){this.stop();if(r===j.HOT_LIKE_SMALL_STICKER_ID)this._play(m);if(r===j.HOT_LIKE_MEDIUM_STICKER_ID)this._play(n);if(r===j.HOT_LIKE_LARGE_STICKER_ID)this._play(o);},_play:function(r){if(p())i.play(r);}};f.exports=q;},null);
__d('ChatApp',['CSS','ChatPerfInstrumentation','DOM','JSLogger','Promise','React','ReactDOM','csx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p={init:function(v,w,x){if(this._isInitialized){k.create('chat_app').error('repeated_init');return;}this._rootElem=v;l.resolve().then(function(){return i.init();}).then(function(){return q();}).then(function(){return r(x);}).then(function(){return s(w,v);}).then(function(){return t();}).then((function(){this._isInitialized=this._isLoaded=true;i.logTTI();}).bind(this)).done(function(){return u(x);});},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !this._isInitialized||this._isHidden;},hide:function(){if(this.isHidden())return;h.hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){h.show(this._rootElem);this.tabsViewport.checkWidth();e(['Dock'],function(v){v.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){e(['UIPagelet'],function(v){v.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');v.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};function q(){return new l(function(v){e(['MercuryBlockedParticipants','MercuryChannelHandler','MercuryDelayedRoger','MercuryDeliveryReceipts','MercuryDeliveryState','MercuryParticipants','MercuryStateCheck','MercuryThreads','MercuryUnreadState','MercuryUnseenState','MercurySyncDispatcher'],function(w,x,y,z,aa,ba,ca,da,ea,fa,ga){w.get();x.get().turnOn();y;z.get();aa.get();ba;da.get();fa.get();ea.get();ca.get();ga.get();v();});});}function r(v){return new l(function(w){e(['MercuryServerPayloadPreprocessor'],function(x){x.get().handleUpdate(v);w();});});}function s(v,w){return new l(function(x){e(['ChatTabController','ChatTabViewCoordinator','TabsViewport','MNCommerceDialogContainer.react','P2PDialogContainer.react','FBRTCMessageHandler','ChatOpenTabImpl'],function(y,z,aa,ba,ca,da,ea){p.tabsViewport=new aa(v);p.tabViewCoordinator=new z(v,p.tabsViewport);p.tabController=new y(p.tabsViewport);da.init();var fa=j.find(w,"._26-x");n.render(m.createElement(ba,null),fa);var ga=j.find(w,"._26-y");n.render(m.createElement(ca,null),ga);p.chatOpenTabImpl=ea;x();});});}function t(){return new l(function(v){e(['HotLikeSound','ChatOptions'],function(w,x){w.setCheckSoundEnabledFunc(function(){return x.getSetting('sound');});v();});});}function u(v){if(!v.threads_to_auto_open||!p.tabsViewport.hasRoomForRaisedTab())return;e(['ChatOpenTab'],function(w){w.openThread(v.threads_to_auto_open.thread_fbid,'autoOpenTab','',null,true);});}f.exports=p;},null);
__d('ChatSidebarComposeLink.react',['ChatOpenTab','Link.react','React','Tooltip','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m,n;'use strict';m=babelHelpers.inherits(o,j.Component);n=m&&m.prototype;function o(p){n.constructor.call(this,p);}o.prototype.render=function(){var p=l._("New Message");return (j.createElement(i,babelHelpers._extends({className:this.props.className,href:'#',onClick:this.$ChatSidebarComposeLink1},k.propsFor(p))));};o.prototype.$ChatSidebarComposeLink1=function(p){h.openEmptyTab(null,'sidebar');p.preventDefault();};f.exports=o;},null);
__d('SidebarFitWindowHeight',['Arbiter','ArbiterMixin','Event','Style','SubscriptionsHandler','UITinyViewportAction','Vector','mixin','queryThenMutateDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q,r;q=babelHelpers.inherits(s,o(i));r=q&&q.prototype;function s(t){'use strict';r.constructor.call(this);this.$SidebarFitWindowHeight1=t;this.onViewportUpdate();m.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){'use strict';if(m.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$SidebarFitWindowHeight2=new l();this.$SidebarFitWindowHeight2.addSubscriptions(j.listen(window,'scroll',t),h.subscribe('dom-scroll',t));}else{if(this.$SidebarFitWindowHeight3!==0){k.set(this.$SidebarFitWindowHeight1,'margin-top','0');this.$SidebarFitWindowHeight3=0;}this.$SidebarFitWindowHeight2&&this.$SidebarFitWindowHeight2.release();}};s.prototype.onScroll=function(){'use strict';p(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'SidebarFitWindowHeight/scroll');};s.prototype.updateScrollPosition=function(){'use strict';this.$SidebarFitWindowHeight4=n.getScrollPosition().y;this.$SidebarFitWindowHeight5||(this.$SidebarFitWindowHeight5=this.$SidebarFitWindowHeight1.offsetHeight);};s.prototype.resizeSidebar=function(){'use strict';var t=-Math.max(Math.min(this.$SidebarFitWindowHeight4,this.$SidebarFitWindowHeight5),0);k.set(this.$SidebarFitWindowHeight1,'margin-top',t+'px');if(t!=this.$SidebarFitWindowHeight3){this.$SidebarFitWindowHeight3=t;this.inform('resized',t);}};s.prototype.getOffset=function(){'use strict';return this.$SidebarFitWindowHeight3;};f.exports=s;},null);
__d('ChatSidebar',['Arbiter','AsyncRequest','BanzaiODS','Bootloader','ChatConfig','ChatImpressionLogger','ChatSidebarActions','ChatSidebarComposeLink.react','ChatSidebarStore','ChatSidebarVisibility','CSS','DOM','DOMDimensions','Event','JSLogger','KeyEventController','LitestandClassicPlaceHolders','MercuryConfig','Parent','PresencePrivacy','PresenceUtil','React','ReactDOM','ReactComponentRenderer','Run','SidebarType','ScrollableArea','SidebarFitWindowHeight','Style','ViewportBounds','createArrayFromMixed','csx','cx','debounce','emptyFunction','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa){if(c.__markCompiled)c.__markCompiled();var ra='chat_sidebar_visibility',sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb=null,db,eb=v.create('chat_sidebar');j.setEntitySample(ra,.0001);function fb(){return p.getVisibleType()===ga.SIDEBAR;}function gb(){return p.getVisibleType()===ga.MINI_SIDEBAR;}function hb(ub,vb){if(!fb())return;if(vb){za.hide();}else{za.show();kb();}}function ib(){if(!fb()&&!gb()||!ya)return 0;if(cb===null){cb=ya.offsetWidth;if(gb())cb=206;}return cb;}function jb(){r.removeClass(document.documentElement,'sidebarMode');if(!p.isInitialized()){h.inform('reflow');ka.inform('change');return;}cb=null;za.hide();bb.getCore().reset();r.hide(ya);r.hide(wa);r.hide(xa);r.removeClass(document.documentElement,'miniSidebar');r.removeClass(ya,"_51xq");va&&va.setProps({shown:false},function(){return pb(false);});eb.log('minisidebar_hide');h.inform('sidebar/hide',tb);h.inform('reflow');ka.inform('change');}function kb(){n.show();ob();}function lb(){if(bb&&fb())bb.getCore().getElement().focus();}function mb(ub){var vb=q.getViewport().height;ub.forEach(function(wb){if(wb&&wb!==sa)vb-=t.getElementDimensions(wb).height;});if(db)vb-=db.getOffset();if(ab)vb-=t.getElementDimensions(ab).height;return Math.max(0,vb);}function nb(){r.hide(wa);r.show(xa);r.removeClass(document.documentElement,'miniSidebar');r.removeClass(ya,"_51xq");va&&va.setProps({shown:false},function(){return pb(false);});cb=null;r.show(ya);r.addClass(document.documentElement,'sidebarMode');za.show();eb.log('sidebar_show');h.inform('sidebar/show',tb);x.destroy('sidebar');ka.inform('change');}function ob(){if(p.getVisibleType()!==ga.SIDEBAR)return;var ub=mb(la(xa.childNodes)),vb=za.getItemHeight(),wb=8,xb=Math.floor((ub-wb)/vb);ja.set(sa,'height',ub+'px');za.setNumTopFriends(xb);if(y.ScrollableSidebarTypeaheadGK){bb.getView().setMaxHeight(ub);}else{var yb=Math.floor((ub-wb)/vb);yb=Math.max(yb-2,1);bb.getData().setMaxResults(yb);}h.inform('sidebar/resized',tb);h.inform('reflow');}function pb(ub){if(ya===null)return;r.conditionClass(ya,"_2e4g",ub);}function qb(){r.hide(xa);r.show(wa);r.show(ya);r.addClass(document.documentElement,'sidebarMode');r.addClass(document.documentElement,'miniSidebar');r.addClass(ya,"_51xq");var ub=mb([]);if(!va){k.loadModules(["ChatMiniSidebar.react","ChatSearchSource"],function(vb,wb){if(!ua)ua=new wb({queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});va=new ea(vb,wa);va.setProps({dataSource:ua,height:ub,maxEntries:50,onClickSearch:pb,onToggleSidebar:n.disable,shown:true});});}else va.setProps({height:ub,shown:true});x.destroy('sidebar');eb.log('minisidebar_show');h.inform('minisidebar/show',tb);h.inform('reflow');ka.inform('change');}function rb(){new i('/ajax/chat/settings.php').setHandler(pa).setErrorHandler(pa).setData({sidebar_mode:p.isEnabled(),window_id:ba.getSessionID()}).setAllowCrossPageTransition(true).send();}function sb(){var ub=true;if(!p.isEnabled()){eb.log('state_not_enabled');ub=false;}if(!q.isViewportCapable())if(!q.isViewportCapableForMiniSidebar()){eb.log('state_not_shown_viewport_mini');ub=false;}if(ub)j.bumpEntityKey(ra,'state_viewport_can_show');if(q.hasLowFriendCount()){eb.log('state_not_shown_num_friends');ub=false;}var vb=ub?'state_shown':'state_not_shown';eb.log(vb);j.bumpEntityKey(ra,vb);}var tb={init:function(ub,vb,wb){tb.init=pa;n.loaded();ya=ub;za=vb;bb=wb;sa=s.find(ub,'div.fbChatSidebarBody');wa=s.find(ub,"._51x-");xa=s.find(ub,"._51x_");ab=s.find(ub,"._5qqe");var xb=s.find(ub,"._x1u");if(xb)da.render(ca.createElement(o,{className:"_3a-4 _5q85"}),xb);var yb=s.find(ub,"._1ltf");if(yb)fa.onAfterLoad(function(){k.loadModules(["ChatSidebarDropdown.react","SidebarType"],function(ac,bc){da.render(ca.createElement(ac,{sidebarType:bc.SIDEBAR,onToggleSidebar:n.disable}),yb);});});u.listen(window,'resize',kb);w.registerKey('q',function(event){if(p.getVisibleType()!==ga.SIDEBAR)return;if(!ta)ta=s.scry(ub,'.inputsearch')[0];if(ta){ta.focus();event.prevent();}});var zb=s.find(ub,'div.fbChatSidebarMessage div.message');if(zb)fa.onAfterLoad(function(){k.loadModules(["ChatSidebarSheet.react"],function(ac){da.render(ca.createElement(ac,{root:ub,onUpdate:ob}),zb,ob);});});za.setScrollContainer(z.byClass(za.getRoot(),'uiScrollableAreaWrap'));za.subscribe(['render','show','hide'],oa(function(ac){var bc=ha.getInstance(za.getRoot());bc&&bc.adjustGripper();}));h.subscribe('chat/option-changed',function(ac,bc){if(bc.name==='hide_groups')ob();});h.subscribe(['AppsDivebar/show-apps','AppsDivebar/hide-apps','Ticker/resized'],ob);wb.getCore().subscribe('sidebar/typeahead/active',hb);wb.subscribe('reset',function(){if(!wb.getCore().getValue()&&!za.isVisible())hb(null,false);});aa.subscribe('privacy-user-presence-changed',kb);p.addListener(function(){var ac=p.getState(),bc=p.getPrevState();if(ac.visible!==bc.visible)switch(ac.visible){case ga.SIDEBAR:nb();break;case ga.MINI_SIDEBAR:qb();break;case ga.BUDDYLIST:jb();break;}if(ac.enabled!==bc.enabled){if(ac.enabled)setTimeout(lb,0);rb();}});kb();m.init(za);ka.addPersistentRight(ib);h.inform('sidebar/initialized',tb,h.BEHAVIOR_PERSISTENT);db=new ia(ab);db.subscribe('resized',kb);n.init();sb();},ensureLoaded:function(){if(!p.isEnabled())return;if(p.isLoaded())return;if(qa('pagelet_sidebar'))return;e(['UIPagelet'],function(ub){var vb=s.create('div',{id:'pagelet_sidebar'});s.appendContent(document.body,vb);ub.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});n.loaded();},hide:function(){if(!p.isEnabled())return;n.disable();},unhide:function(){if(p.isEnabled())return;n.enable();}};f.exports=tb;},null);