/*!CK:2746410085!*//*1445760401,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["VZetn"]); }

__d("PhotosUploadWaterfallErrorCodes",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SECURITY:1,FILE_IO:2,IMAGE_IO:3,UPLOAD_IO:4,INVALID_SERVER_RESULT:5,RESIZE_FAILURE:6,ENCODE_FAILURE:7,INVALID_DOMAIN:8,BAD_JPEG_MARKERS:9,BAD_SERVER_RESPONSE:10,EXTERNAL_INTERFACE_UNAVAILABLE:11,JS_CALL_FAILED:12,UNCAUGHT_ERROR:13,UPLOAD_SWF_FAILED_LOAD:14,FILE_IO_TIMEOUT:15,IMAGE_SECURITY:16,BAD_IMAGE_FILE:17,IMAGE_IO_TIMEOUT:18,BLACK_PHOTO:19,EMPTY_FILE_LOADED:20,FILE_READ_DISABLED:21,BAD_NETWORK:22,FLASH_LOAD_TIMEOUT:23,FLASH_LOAD_FAILURE:24,FLASH_UPGRADE_REQUIRED:25};},null,{});
__d('ImageResizer',['ArbiterMixin','BlobFactory','DOM','UserAgent_DEPRECATED'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=function(m,n,o,p,q){this._input=m;this._image=null;this._canvas=null;this._rotation=0;this._maxWidth=n;this._maxHeight=o;this._outputMime=p||'image/jpeg';this._outputQuality=q===undefined?.87:q;};l.isSupported=function(){if(window.File&&window.FileReader){var m=j.create('canvas');if(m.toBlob||m.toDataURL&&window.ArrayBuffer&&window.Uint8Array&&i.isSupported())return true;}return false;};Object.assign(l.prototype,h);Object.assign(l.prototype,{setOrientation:function(m){this._rotation=({1:0,3:180,6:90,8:270})[m]||0;},resize:function(){if(this._input instanceof HTMLCanvasElement||this._input instanceof HTMLImageElement){this._image=this._input;this._handleImage();}else if(typeof this._input=="string"){this._loadImage(this._input);}else if(this._input instanceof window.File)this._loadFile(this._input);},_rotatedToSide:function(){return this._rotation%180==90;},_prepareError:function(m){return (function(){this.inform.bind(this,"error",m);}).bind(this);},_loadFile:function(m){this._fileLoadTime=Date.now();var n=new FileReader();n.onload=this._handleFile.bind(this);n.onerror=this._prepareError("Could not read tile.");n.readAsDataURL(m);},_handleFile:function(event){this._fileLoadTime=Date.now()-this._fileLoadTime;var m=event.target.result;this._loadImage(m);},_loadImage:function(m){this._imageLoadTime=Date.now();this._image=j.create('img');this._image.onload=this._handleImage.bind(this);this._image.onerror=this._prepareError("Could not load image.");this._image.src=m;},_handleImage:function(){if(this._imageLoadTime)this._imageLoadTime=Date.now()-this._imageLoadTime;if(this._input instanceof window.File){var m=this._calculateRatio();if(m>=1){this._skippedResizing=true;return this._handleBlob(this._input);}}this._skippedResizing=false;this._drawTransformed();this._extractBlob();},_drawTransformed:function(){var m=Date.now(),n=this._calculateRatio(),o=0;if(k.chrome())if(n<.25){o=2;}else if(n<.5)o=1;var p=this._drawResizedCanvas(this._image,n*Math.pow(2,o));for(var q=0;q<o;q++)p=this._drawResizedCanvas(p,.5);if(this._rotation)p=this._drawRotatedCanvas(p);this._canvas=p;this._drawTime=Date.now()-m;},_drawResizedCanvas:function(m,n){var o=j.create('canvas');o.width=m.width*n;o.height=m.height*n;var p=o.getContext("2d");p.scale(n,n);p.drawImage(m,0,0);return o;},_drawRotatedCanvas:function(m){var n=j.create('canvas');if(this._rotatedToSide()){n.width=m.height;n.height=m.width;}else{n.width=m.width;n.height=m.height;}var o=n.getContext("2d");o.translate(n.width*.5,n.height*.5);o.rotate(Math.PI*(this._rotation/180));o.translate(m.width*-.5,m.height*-.5);o.drawImage(m,0,0,m.width,m.height);return n;},_calculateRatio:function(){var m=1,n=this._rotatedToSide()?this._maxHeight:this._maxWidth,o=this._rotatedToSide()?this._maxWidth:this._maxHeight,p=n/this._image.width,q=o/this._image.height;if(p<m&&p>0)m=p;if(q<m&&q>0)m=q;return m;},_extractBlob:function(){this._extractionStart=Date.now();if(this._canvas.toBlob){this._canvas.toBlob(this._handleBlob.bind(this),this._outputMime,this._outputQuality);return;}var m=this._canvas.toDataURL(this._outputMime,this._outputQuality),n=m.match(/^data:(.*?);base64,/);if(!n){this._prepareError("Couldn't get base64 encoded data from canvas.")();return;}var o=n[1],p=m.substr(n[0].length),q=window.atob(p),r=new ArrayBuffer(q.length),s=new Uint8Array(r);for(var t=0;t<q.length;t++)s[t]=q.charCodeAt(t);var u=i.getBlob([r],{type:o});this._handleBlob(u);},_handleBlob:function(m){this._canvas=this._canvas||j.create('canvas');m.performanceData={blockingDraw:+true,blockingExtraction:+!this._canvas.toBlob,imageLoadTime:this._imageLoadTime,fileLoadTime:this._fileLoadTime,skippedResizing:+this._skippedResizing};if(!this._skippedResizing)Object.assign(m.performanceData,{extractionTime:Date.now()-this._extractionStart,drawTime:this._drawTime});this.inform('resized',m);}});f.exports=l;},null);
__d('FlashArbiterEvents',['Arbiter','Run'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k){'use strict';this._flashID=k;this._subscriptions=[];i.onLeave(this.unsubscribeAll.bind(this));}j.prototype.subscribe=function(k,l){'use strict';var m=this._flashID;this._subscriptions.push(h.subscribe(k,function(n,o){if(m===o.divID)l(o);}));return this;};j.prototype.unsubscribeAll=function(){'use strict';while(this._subscriptions.length)h.unsubscribe(this._subscriptions.pop());};f.exports=j;},null);
__d('compareFlashVersions',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(j){return j.replace(/\d+/g,function(k){return '000'.substring(k.length)+k;});}function i(j,k){j=h(j);k=h(k);if(j>k){return 1;}else if(j<k)return -1;return 0;}f.exports=i;},null);
__d('FlashLoadEvent',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports={READY:'flash/ready',FAILED:'flash/failed',MOUSE_CANCELED:'UploadEvent/SELECT_CANCELED',MOUSE_DOWN:'UploadEvent/SELECT_DOWN',MOUSE_OUT:'UploadEvent/SELECT_OUT',MOUSE_OVER:'UploadEvent/SELECT_OVER',MOUSE_UP:'UploadEvent/SELECT_UP',ERROR_FLASH_LOAD_TIMEOUT:1,ERROR_FLASH_LOAD_FAILURE:2,ERROR_FLASH_UPGRADE_REQUIRED:3};},null);
__d('UploadEvent',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={UPLOAD_START:'UploadEvent/UPLOAD_START',UPLOAD_HIRES_RESTART:'UploadEvent/UPLOAD_HIRES_RESTART',START:'UploadEvent/START',DONE:'UploadEvent/DONE',ERROR:'UploadEvent/ERROR',FINISHED_UPLOADING:'UploadEvent/FINISHED_UPLOADING',LOADED:'UploadEvent/LOADED',READY:'UploadEvent/READY',UPLOAD_FAILED:'UploadEvent/UPLOAD_FAILED',UPLOAD_PROGRESS:'UploadEvent/UPLOAD_PROGRESS',COMPRESS_PROGRESS:'UploadEvent/COMPRESS_PROGRESS',HI_RES_ATTACH_START:'UploadEvent/HI_RES_ATTACH_START',IMAGE_COMPRESS_ERROR:'UploadEvent/IMAGE_COMPRESS_ERROR',IMAGE_COMPRESS_BEGIN:'UploadEvent/IMAGE_COMPRESS_BEGIN',IMAGE_COMPRESSED:'UploadEvent/IMAGE_COMPRESSED',IMAGE_UPLOAD_ERROR:'UploadEvent/IMAGE_UPLOAD_ERROR',IMAGE_UPLOADED:'UploadEvent/IMAGE_UPLOADED',SELECT_START:'UploadEvent/SELECT_START',SELECT_CANCELED:'UploadEvent/SELECT_CANCELED',IMAGES_SELECTED:'UploadEvent/IMAGES_SELECTED',HEARTBEAT:'UploadEvent/HEARTBEAT',CANCELED_PROCESSING_PHOTO:'UploadEvent/CANCELED_PROCESSING_PHOTO',CANCELED_PHOTO_UPLOADED_ANYWAY:'UploadEvent/CANCELED_PHOTO_UPLOADED_ANYWAY'};f.exports=h;},null);
__d('FlashFilePicker',['Arbiter','ArbiterMixin','AsyncUploadBase','BrowserSupport','compareFlashVersions','ImageResizer','CSS','FilePickerEvent','Flash','FlashArbiterEvents','FlashLoadEvent','FlashUploaderConfig','HTML','Parent','PhotosUploadWaterfall','PhotosUploadWaterfallErrorCodes','PhotosUploadWaterfallMixin','PhotosUploadWaterfallXMixin','PUWApplications','UploadEvent','URI','PUWSteps','$'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){if(c.__markCompiled)c.__markCompiled();function ea(ia){for(var ja=0;ja<ia.length;++ja)if(p.checkMinVersion(ia[ja].toString()))return true;return false;}function fa(ia){var ja=u.byClass(ia,'addPhotosDisabled');if(ja){n.removeClass(ja,'addPhotosDisabled');n.addClass(ja,'addPhotosEnabled');}}function ga(ia,ja){ja.style.width=ia.offsetWidth+'px';ja.style.height=ia.offsetHeight+'px';}function ha(ia,ja,ka){this._swfID=ia;this._button=ja;this._waterfallID=ka.qn;this._ref=ka.ref;this._beginInformed=false;this._isReady=false;this._fallbackHref=ka.fallbackHref;if(!ea(s.flashVersionInfo.minimumVersion)){this.logWaterfallStep(v.UPGRADE_REQUIRED);this._flashError(w.FLASH_UPGRADE_REQUIRED||25);return;}if(ka.flashObjectsPerVersion)this._constructAndAppendFlashObject(ka.flashObjectsPerVersion);this._flashEvents=new q(this._swfID).subscribe(r.READY,this._handleReady.bind(this)).subscribe(r.FAILED,this._handleFailed.bind(this)).subscribe(r.MOUSE_OVER,this._handleMouseIn.bind(this)).subscribe(r.MOUSE_OUT,this._handleMouseOut.bind(this)).subscribe(aa.SELECT_START||'UploadEvent/SELECT_START',this._handleSelectStart.bind(this)).subscribe(aa.IMAGES_SELECTED,this._handleSelected.bind(this)).subscribe(aa.SELECT_CANCELED,this._handleCancelSelected.bind(this));this._timeout=setTimeout((function(){if(!this._isReady)this._flashError(w.FLASH_LOAD_TIMEOUT||23);}).bind(this),s.flashLoadTimeout);ka.logDetailed&&this.logDetailed();}Object.assign(ha.prototype,i,x,y,{_constructAndAppendFlashObject:function(ia){var ja=ia['default'];delete ia['default'];var ka=Object.keys(ia).sort(function(pa,qa){return l(qa,pa);}),la=ja;for(var ma=0;ma<ka.length;ma++){var na=ka[ma];if(p.checkMinVersion(na)){la=ia[na];break;}}var oa=t.replaceJSONWrapper(la).getRootNode();this._button.parentNode.appendChild(oa);},getUploaderApp:function(){return v.APP_FLASH;},getWaterfallID:function(){return this._waterfallID;},getWaterfallAppName:function(){return z.WEB_FLASH;},getWaterfallSource:function(){return this._ref;},getSwfID:function(){return this._swfID;},logDetailed:function(){this.logWaterfallStep(v.VERSION,{version:p.getVersionString()});if(j.isSupported()){this.logWaterfallStep(v.ASYNC_AVAILABLE);if(m.isSupported()){this.logWaterfallStep(v.RESIZER_AVAILABLE);}else this.logStep(ca.CLIENT_PROCESS_UNAVAILABLE,{error:'no_resizer'});}else this.logStep(ca.CLIENT_PROCESS_UNAVAILABLE,{error:'no_async_upload'});},_handleReady:function(ia){setTimeout((function(){return ga(this._button,da(this._swfID));}).bind(this));fa(this._button);this._isReady=true;clearTimeout(this._timeout);h.inform(aa.READY,{divID:this._swfID},h.BEHAVIOR_PERSISTENT);},_handleFailed:function(ia){this._flashError(w.FLASH_LOAD_FAILURE||24);},_flashError:function(ia){if(k.hasFileAPI()){var ja=new ba(this._button.getAttribute('ajaxify'));this._button.setAttribute('ajaxify',ja.addQueryData({application:v.APP_HTML5,xapplication:z.WEB_HTML5}).toString());fa(this._button);this.logWaterfallStep(v.FALLBACK_TO_HTML5||130);return;}if(this._fallbackHref){var ka=new ba(this._fallbackHref).addQueryData({error:ia}).toString();this._button.removeAttribute('rel');this._button.removeAttribute('ajaxify');this._button.setAttribute('href',ka);fa(this._button);}this.logWaterfallStep(v.CLIENT_ERROR,{code:ia,scuba_tags:{fallback_simple:true}});this.logStep(ca.CLIENT_FLOW_FATAL,{error_code:ia,fallback_simple:true});},_handleMouseIn:function(ia){n.addClass(this._button,'selectOver');},_handleMouseOut:function(ia){n.removeClass(this._button,'selectOver');},_handleSelectStart:function(ia){if(!this._beginInformed){this._beginInformed=true;this.inform(o.BEGIN||'FilePickerEvent/BEGIN');}this.inform(o.SELECT_START);},_handleSelected:function(ia){var ja;if(ia.files){ja=ia.files;}else{ja=[{uploadID:ia.divID+'.'}];ja.length=ia.count;}this.inform(o.SELECTED,{sender:this,files:ja},h.BEHAVIOR_PERSISTENT);if(ia.albumLimitExceeded)this.inform(o.ALBUM_LIMIT_EXCEEDED,{},h.BEHAVIOR_PERSISTENT);if(ia.sessionLimitExceeded)this.inform(o.SESSION_LIMIT_EXCEEDED,{},h.BEHAVIOR_PERSISTENT);},_handleCancelSelected:function(ia){this.inform(o.SELECT_CANCELED);}});f.exports=ha;},null);